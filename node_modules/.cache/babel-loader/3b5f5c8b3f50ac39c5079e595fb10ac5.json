{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.compileGeneralSelector = void 0;\n\nvar attributes_js_1 = require(\"./attributes.js\");\n\nvar index_js_1 = require(\"./pseudo-selectors/index.js\");\n\nvar css_what_1 = require(\"css-what\");\n\nfunction getElementParent(node, adapter) {\n  var parent = adapter.getParent(node);\n\n  if (parent && adapter.isTag(parent)) {\n    return parent;\n  }\n\n  return null;\n}\n/*\n * All available rules\n */\n\n\nfunction compileGeneralSelector(next, selector, options, context, compileToken) {\n  var adapter = options.adapter,\n      equals = options.equals;\n\n  switch (selector.type) {\n    case css_what_1.SelectorType.PseudoElement:\n      {\n        throw new Error(\"Pseudo-elements are not supported by css-select\");\n      }\n\n    case css_what_1.SelectorType.ColumnCombinator:\n      {\n        throw new Error(\"Column combinators are not yet supported by css-select\");\n      }\n\n    case css_what_1.SelectorType.Attribute:\n      {\n        if (selector.namespace != null) {\n          throw new Error(\"Namespaced attributes are not yet supported by css-select\");\n        }\n\n        if (!options.xmlMode || options.lowerCaseAttributeNames) {\n          selector.name = selector.name.toLowerCase();\n        }\n\n        return attributes_js_1.attributeRules[selector.action](next, selector, options);\n      }\n\n    case css_what_1.SelectorType.Pseudo:\n      {\n        return (0, index_js_1.compilePseudoSelector)(next, selector, options, context, compileToken);\n      }\n    // Tags\n\n    case css_what_1.SelectorType.Tag:\n      {\n        if (selector.namespace != null) {\n          throw new Error(\"Namespaced tag names are not yet supported by css-select\");\n        }\n\n        var name_1 = selector.name;\n\n        if (!options.xmlMode || options.lowerCaseTags) {\n          name_1 = name_1.toLowerCase();\n        }\n\n        return function tag(elem) {\n          return adapter.getName(elem) === name_1 && next(elem);\n        };\n      }\n    // Traversal\n\n    case css_what_1.SelectorType.Descendant:\n      {\n        if (options.cacheResults === false || typeof WeakSet === \"undefined\") {\n          return function descendant(elem) {\n            var current = elem;\n\n            while (current = getElementParent(current, adapter)) {\n              if (next(current)) {\n                return true;\n              }\n            }\n\n            return false;\n          };\n        } // @ts-expect-error `ElementNode` is not extending object\n\n\n        var isFalseCache_1 = new WeakSet();\n        return function cachedDescendant(elem) {\n          var current = elem;\n\n          while (current = getElementParent(current, adapter)) {\n            if (!isFalseCache_1.has(current)) {\n              if (adapter.isTag(current) && next(current)) {\n                return true;\n              }\n\n              isFalseCache_1.add(current);\n            }\n          }\n\n          return false;\n        };\n      }\n\n    case \"_flexibleDescendant\":\n      {\n        // Include element itself, only used while querying an array\n        return function flexibleDescendant(elem) {\n          var current = elem;\n\n          do {\n            if (next(current)) return true;\n          } while (current = getElementParent(current, adapter));\n\n          return false;\n        };\n      }\n\n    case css_what_1.SelectorType.Parent:\n      {\n        return function parent(elem) {\n          return adapter.getChildren(elem).some(function (elem) {\n            return adapter.isTag(elem) && next(elem);\n          });\n        };\n      }\n\n    case css_what_1.SelectorType.Child:\n      {\n        return function child(elem) {\n          var parent = adapter.getParent(elem);\n          return parent != null && adapter.isTag(parent) && next(parent);\n        };\n      }\n\n    case css_what_1.SelectorType.Sibling:\n      {\n        return function sibling(elem) {\n          var siblings = adapter.getSiblings(elem);\n\n          for (var i = 0; i < siblings.length; i++) {\n            var currentSibling = siblings[i];\n            if (equals(elem, currentSibling)) break;\n\n            if (adapter.isTag(currentSibling) && next(currentSibling)) {\n              return true;\n            }\n          }\n\n          return false;\n        };\n      }\n\n    case css_what_1.SelectorType.Adjacent:\n      {\n        if (adapter.prevElementSibling) {\n          return function adjacent(elem) {\n            var previous = adapter.prevElementSibling(elem);\n            return previous != null && next(previous);\n          };\n        }\n\n        return function adjacent(elem) {\n          var siblings = adapter.getSiblings(elem);\n          var lastElement;\n\n          for (var i = 0; i < siblings.length; i++) {\n            var currentSibling = siblings[i];\n            if (equals(elem, currentSibling)) break;\n\n            if (adapter.isTag(currentSibling)) {\n              lastElement = currentSibling;\n            }\n          }\n\n          return !!lastElement && next(lastElement);\n        };\n      }\n\n    case css_what_1.SelectorType.Universal:\n      {\n        if (selector.namespace != null && selector.namespace !== \"*\") {\n          throw new Error(\"Namespaced universal selectors are not yet supported by css-select\");\n        }\n\n        return next;\n      }\n  }\n}\n\nexports.compileGeneralSelector = compileGeneralSelector;","map":{"version":3,"mappings":"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","names":["getElementParent","node","adapter","parent","getParent","isTag","compileGeneralSelector","next","selector","options","context","compileToken","equals","type","css_what_1","PseudoElement","Error","ColumnCombinator","Attribute","namespace","xmlMode","lowerCaseAttributeNames","name","toLowerCase","attributes_js_1","action","Pseudo","Tag","lowerCaseTags","name_1","tag","elem","getName","Descendant","cacheResults","WeakSet","descendant","current","isFalseCache_1","cachedDescendant","has","add","flexibleDescendant","Parent","getChildren","some","Child","child","Sibling","sibling","siblings","getSiblings","i","length","currentSibling","Adjacent","prevElementSibling","adjacent","previous","lastElement","Universal","exports"],"sources":["general.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}
{"ast":null,"code":"\"use strict\";\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.subselects = exports.getNextSiblings = exports.ensureIsTag = exports.PLACEHOLDER_ELEMENT = void 0;\n\nvar boolbase_1 = __importDefault(require(\"boolbase\"));\n\nvar sort_js_1 = require(\"../sort.js\");\n/** Used as a placeholder for :has. Will be replaced with the actual element. */\n\n\nexports.PLACEHOLDER_ELEMENT = {};\n\nfunction ensureIsTag(next, adapter) {\n  if (next === boolbase_1.default.falseFunc) return boolbase_1.default.falseFunc;\n  return function (elem) {\n    return adapter.isTag(elem) && next(elem);\n  };\n}\n\nexports.ensureIsTag = ensureIsTag;\n\nfunction getNextSiblings(elem, adapter) {\n  var siblings = adapter.getSiblings(elem);\n  if (siblings.length <= 1) return [];\n  var elemIndex = siblings.indexOf(elem);\n  if (elemIndex < 0 || elemIndex === siblings.length - 1) return [];\n  return siblings.slice(elemIndex + 1).filter(adapter.isTag);\n}\n\nexports.getNextSiblings = getNextSiblings;\n\nfunction copyOptions(options) {\n  // Not copied: context, rootFunc\n  return {\n    xmlMode: !!options.xmlMode,\n    lowerCaseAttributeNames: !!options.lowerCaseAttributeNames,\n    lowerCaseTags: !!options.lowerCaseTags,\n    quirksMode: !!options.quirksMode,\n    cacheResults: !!options.cacheResults,\n    pseudos: options.pseudos,\n    adapter: options.adapter,\n    equals: options.equals\n  };\n}\n\nvar is = function (next, token, options, context, compileToken) {\n  var func = compileToken(token, copyOptions(options), context);\n  return func === boolbase_1.default.trueFunc ? next : func === boolbase_1.default.falseFunc ? boolbase_1.default.falseFunc : function (elem) {\n    return func(elem) && next(elem);\n  };\n};\n/*\n * :not, :has, :is, :matches and :where have to compile selectors\n * doing this in src/pseudos.ts would lead to circular dependencies,\n * so we add them here\n */\n\n\nexports.subselects = {\n  is: is,\n\n  /**\n   * `:matches` and `:where` are aliases for `:is`.\n   */\n  matches: is,\n  where: is,\n  not: function (next, token, options, context, compileToken) {\n    var func = compileToken(token, copyOptions(options), context);\n    return func === boolbase_1.default.falseFunc ? next : func === boolbase_1.default.trueFunc ? boolbase_1.default.falseFunc : function (elem) {\n      return !func(elem) && next(elem);\n    };\n  },\n  has: function (next, subselect, options, _context, compileToken) {\n    var adapter = options.adapter;\n    var opts = copyOptions(options);\n    opts.relativeSelector = true;\n    var context = subselect.some(function (s) {\n      return s.some(sort_js_1.isTraversal);\n    }) ? // Used as a placeholder. Will be replaced with the actual element.\n    [exports.PLACEHOLDER_ELEMENT] : undefined;\n    var compiled = compileToken(subselect, opts, context);\n    if (compiled === boolbase_1.default.falseFunc) return boolbase_1.default.falseFunc;\n    var hasElement = ensureIsTag(compiled, adapter); // If `compiled` is `trueFunc`, we can skip this.\n\n    if (context && compiled !== boolbase_1.default.trueFunc) {\n      /*\n       * `shouldTestNextSiblings` will only be true if the query starts with\n       * a traversal (sibling or adjacent). That means we will always have a context.\n       */\n      var _a = compiled.shouldTestNextSiblings,\n          shouldTestNextSiblings_1 = _a === void 0 ? false : _a;\n      return function (elem) {\n        if (!next(elem)) return false;\n        context[0] = elem;\n        var childs = adapter.getChildren(elem);\n        var nextElements = shouldTestNextSiblings_1 ? __spreadArray(__spreadArray([], childs, true), getNextSiblings(elem, adapter), true) : childs;\n        return adapter.existsOne(hasElement, nextElements);\n      };\n    }\n\n    return function (elem) {\n      return next(elem) && adapter.existsOne(hasElement, adapter.getChildren(elem));\n    };\n  }\n};","map":{"version":3,"mappings":"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","names":["exports","ensureIsTag","next","adapter","boolbase_1","falseFunc","elem","isTag","getNextSiblings","siblings","getSiblings","length","elemIndex","indexOf","slice","filter","copyOptions","options","xmlMode","lowerCaseAttributeNames","lowerCaseTags","quirksMode","cacheResults","pseudos","equals","is","token","context","compileToken","func","trueFunc","matches","where","not","has","subselect","_context","opts","relativeSelector","some","s","sort_js_1","undefined","compiled","hasElement","_a","childs","getChildren","nextElements","shouldTestNextSiblings_1","__spreadArray","existsOne"],"sources":["pseudo-selectors/subselects.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}
{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.compileToken = exports.compileUnsafe = exports.compile = void 0;\n\nvar css_what_1 = require(\"css-what\");\n\nvar boolbase_1 = __importDefault(require(\"boolbase\"));\n\nvar sort_js_1 = __importStar(require(\"./sort.js\"));\n\nvar general_js_1 = require(\"./general.js\");\n\nvar subselects_js_1 = require(\"./pseudo-selectors/subselects.js\");\n/**\n * Compiles a selector to an executable function.\n *\n * @param selector Selector to compile.\n * @param options Compilation options.\n * @param context Optional context for the selector.\n */\n\n\nfunction compile(selector, options, context) {\n  var next = compileUnsafe(selector, options, context);\n  return (0, subselects_js_1.ensureIsTag)(next, options.adapter);\n}\n\nexports.compile = compile;\n\nfunction compileUnsafe(selector, options, context) {\n  var token = typeof selector === \"string\" ? (0, css_what_1.parse)(selector) : selector;\n  return compileToken(token, options, context);\n}\n\nexports.compileUnsafe = compileUnsafe;\n\nfunction includesScopePseudo(t) {\n  return t.type === css_what_1.SelectorType.Pseudo && (t.name === \"scope\" || Array.isArray(t.data) && t.data.some(function (data) {\n    return data.some(includesScopePseudo);\n  }));\n}\n\nvar DESCENDANT_TOKEN = {\n  type: css_what_1.SelectorType.Descendant\n};\nvar FLEXIBLE_DESCENDANT_TOKEN = {\n  type: \"_flexibleDescendant\"\n};\nvar SCOPE_TOKEN = {\n  type: css_what_1.SelectorType.Pseudo,\n  name: \"scope\",\n  data: null\n};\n/*\n * CSS 4 Spec (Draft): 3.4.1. Absolutizing a Relative Selector\n * http://www.w3.org/TR/selectors4/#absolutizing\n */\n\nfunction absolutize(token, _a, context) {\n  var adapter = _a.adapter; // TODO Use better check if the context is a document\n\n  var hasContext = !!(context === null || context === void 0 ? void 0 : context.every(function (e) {\n    var parent = adapter.isTag(e) && adapter.getParent(e);\n    return e === subselects_js_1.PLACEHOLDER_ELEMENT || parent && adapter.isTag(parent);\n  }));\n\n  for (var _i = 0, token_1 = token; _i < token_1.length; _i++) {\n    var t = token_1[_i];\n\n    if (t.length > 0 && (0, sort_js_1.isTraversal)(t[0]) && t[0].type !== css_what_1.SelectorType.Descendant) {// Don't continue in else branch\n    } else if (hasContext && !t.some(includesScopePseudo)) {\n      t.unshift(DESCENDANT_TOKEN);\n    } else {\n      continue;\n    }\n\n    t.unshift(SCOPE_TOKEN);\n  }\n}\n\nfunction compileToken(token, options, context) {\n  var _a;\n\n  token.forEach(sort_js_1.default);\n  context = (_a = options.context) !== null && _a !== void 0 ? _a : context;\n  var isArrayContext = Array.isArray(context);\n  var finalContext = context && (Array.isArray(context) ? context : [context]); // Check if the selector is relative\n\n  if (options.relativeSelector !== false) {\n    absolutize(token, options, finalContext);\n  } else if (token.some(function (t) {\n    return t.length > 0 && (0, sort_js_1.isTraversal)(t[0]);\n  })) {\n    throw new Error(\"Relative selectors are not allowed when the `relativeSelector` option is disabled\");\n  }\n\n  var shouldTestNextSiblings = false;\n  var query = token.map(function (rules) {\n    if (rules.length >= 2) {\n      var first = rules[0],\n          second = rules[1];\n\n      if (first.type !== css_what_1.SelectorType.Pseudo || first.name !== \"scope\") {// Ignore\n      } else if (isArrayContext && second.type === css_what_1.SelectorType.Descendant) {\n        rules[1] = FLEXIBLE_DESCENDANT_TOKEN;\n      } else if (second.type === css_what_1.SelectorType.Adjacent || second.type === css_what_1.SelectorType.Sibling) {\n        shouldTestNextSiblings = true;\n      }\n    }\n\n    return compileRules(rules, options, finalContext);\n  }).reduce(reduceRules, boolbase_1.default.falseFunc);\n  query.shouldTestNextSiblings = shouldTestNextSiblings;\n  return query;\n}\n\nexports.compileToken = compileToken;\n\nfunction compileRules(rules, options, context) {\n  var _a;\n\n  return rules.reduce(function (previous, rule) {\n    return previous === boolbase_1.default.falseFunc ? boolbase_1.default.falseFunc : (0, general_js_1.compileGeneralSelector)(previous, rule, options, context, compileToken);\n  }, (_a = options.rootFunc) !== null && _a !== void 0 ? _a : boolbase_1.default.trueFunc);\n}\n\nfunction reduceRules(a, b) {\n  if (b === boolbase_1.default.falseFunc || a === boolbase_1.default.trueFunc) {\n    return a;\n  }\n\n  if (a === boolbase_1.default.falseFunc || b === boolbase_1.default.trueFunc) {\n    return b;\n  }\n\n  return function combine(elem) {\n    return a(elem) || b(elem);\n  };\n}","map":{"version":3,"mappings":"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","names":["compile","selector","options","context","next","compileUnsafe","adapter","exports","token","compileToken","includesScopePseudo","t","type","css_what_1","Pseudo","name","Array","isArray","data","some","DESCENDANT_TOKEN","Descendant","FLEXIBLE_DESCENDANT_TOKEN","SCOPE_TOKEN","absolutize","_a","hasContext","every","e","parent","isTag","getParent","subselects_js_1","_i","length","unshift","forEach","sort_js_1","isArrayContext","finalContext","relativeSelector","Error","shouldTestNextSiblings","query","map","rules","second","first","Adjacent","Sibling","compileRules","reduce","reduceRules","boolbase_1","falseFunc","previous","rule","rootFunc","trueFunc","a","b","combine","elem"],"sources":["compile.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}
{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Parser = void 0;\n\nconst index_js_1 = require(\"../tokenizer/index.js\");\n\nconst open_element_stack_js_1 = require(\"./open-element-stack.js\");\n\nconst formatting_element_list_js_1 = require(\"./formatting-element-list.js\");\n\nconst default_js_1 = require(\"../tree-adapters/default.js\");\n\nconst doctype = require(\"../common/doctype.js\");\n\nconst foreignContent = require(\"../common/foreign-content.js\");\n\nconst error_codes_js_1 = require(\"../common/error-codes.js\");\n\nconst unicode = require(\"../common/unicode.js\");\n\nconst html_js_1 = require(\"../common/html.js\");\n\nconst token_js_1 = require(\"../common/token.js\"); //Misc constants\n\n\nconst HIDDEN_INPUT_TYPE = 'hidden'; //Adoption agency loops iteration count\n\nconst AA_OUTER_LOOP_ITER = 8;\nconst AA_INNER_LOOP_ITER = 3; //Insertion modes\n\nvar InsertionMode;\n\n(function (InsertionMode) {\n  InsertionMode[InsertionMode[\"INITIAL\"] = 0] = \"INITIAL\";\n  InsertionMode[InsertionMode[\"BEFORE_HTML\"] = 1] = \"BEFORE_HTML\";\n  InsertionMode[InsertionMode[\"BEFORE_HEAD\"] = 2] = \"BEFORE_HEAD\";\n  InsertionMode[InsertionMode[\"IN_HEAD\"] = 3] = \"IN_HEAD\";\n  InsertionMode[InsertionMode[\"IN_HEAD_NO_SCRIPT\"] = 4] = \"IN_HEAD_NO_SCRIPT\";\n  InsertionMode[InsertionMode[\"AFTER_HEAD\"] = 5] = \"AFTER_HEAD\";\n  InsertionMode[InsertionMode[\"IN_BODY\"] = 6] = \"IN_BODY\";\n  InsertionMode[InsertionMode[\"TEXT\"] = 7] = \"TEXT\";\n  InsertionMode[InsertionMode[\"IN_TABLE\"] = 8] = \"IN_TABLE\";\n  InsertionMode[InsertionMode[\"IN_TABLE_TEXT\"] = 9] = \"IN_TABLE_TEXT\";\n  InsertionMode[InsertionMode[\"IN_CAPTION\"] = 10] = \"IN_CAPTION\";\n  InsertionMode[InsertionMode[\"IN_COLUMN_GROUP\"] = 11] = \"IN_COLUMN_GROUP\";\n  InsertionMode[InsertionMode[\"IN_TABLE_BODY\"] = 12] = \"IN_TABLE_BODY\";\n  InsertionMode[InsertionMode[\"IN_ROW\"] = 13] = \"IN_ROW\";\n  InsertionMode[InsertionMode[\"IN_CELL\"] = 14] = \"IN_CELL\";\n  InsertionMode[InsertionMode[\"IN_SELECT\"] = 15] = \"IN_SELECT\";\n  InsertionMode[InsertionMode[\"IN_SELECT_IN_TABLE\"] = 16] = \"IN_SELECT_IN_TABLE\";\n  InsertionMode[InsertionMode[\"IN_TEMPLATE\"] = 17] = \"IN_TEMPLATE\";\n  InsertionMode[InsertionMode[\"AFTER_BODY\"] = 18] = \"AFTER_BODY\";\n  InsertionMode[InsertionMode[\"IN_FRAMESET\"] = 19] = \"IN_FRAMESET\";\n  InsertionMode[InsertionMode[\"AFTER_FRAMESET\"] = 20] = \"AFTER_FRAMESET\";\n  InsertionMode[InsertionMode[\"AFTER_AFTER_BODY\"] = 21] = \"AFTER_AFTER_BODY\";\n  InsertionMode[InsertionMode[\"AFTER_AFTER_FRAMESET\"] = 22] = \"AFTER_AFTER_FRAMESET\";\n})(InsertionMode || (InsertionMode = {}));\n\nconst BASE_LOC = {\n  startLine: -1,\n  startCol: -1,\n  startOffset: -1,\n  endLine: -1,\n  endCol: -1,\n  endOffset: -1\n};\nconst TABLE_STRUCTURE_TAGS = new Set([html_js_1.TAG_ID.TABLE, html_js_1.TAG_ID.TBODY, html_js_1.TAG_ID.TFOOT, html_js_1.TAG_ID.THEAD, html_js_1.TAG_ID.TR]);\nconst defaultParserOptions = {\n  scriptingEnabled: true,\n  sourceCodeLocationInfo: false,\n  treeAdapter: default_js_1.defaultTreeAdapter,\n  onParseError: null\n}; //Parser\n\nclass Parser {\n  constructor(options, document) {\n    let fragmentContext = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    let scriptHandler = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n    this.fragmentContext = fragmentContext;\n    this.scriptHandler = scriptHandler;\n    this.currentToken = null;\n    this.stopped = false;\n    this.insertionMode = InsertionMode.INITIAL;\n    this.originalInsertionMode = InsertionMode.INITIAL;\n    this.headElement = null;\n    this.formElement = null;\n    /** Indicates that the current node is not an element in the HTML namespace */\n\n    this.currentNotInHTML = false;\n    /**\n     * The template insertion mode stack is maintained from the left.\n     * Ie. the topmost element will always have index 0.\n     */\n\n    this.tmplInsertionModeStack = [];\n    this.pendingCharacterTokens = [];\n    this.hasNonWhitespacePendingCharacterToken = false;\n    this.framesetOk = true;\n    this.skipNextNewLine = false;\n    this.fosterParentingEnabled = false;\n    this.options = Object.assign(Object.assign({}, defaultParserOptions), options);\n    this.treeAdapter = this.options.treeAdapter;\n    this.onParseError = this.options.onParseError; // Always enable location info if we report parse errors.\n\n    if (this.onParseError) {\n      this.options.sourceCodeLocationInfo = true;\n    }\n\n    this.document = document !== null && document !== void 0 ? document : this.treeAdapter.createDocument();\n    this.tokenizer = new index_js_1.Tokenizer(this.options, this);\n    this.activeFormattingElements = new formatting_element_list_js_1.FormattingElementList(this.treeAdapter);\n    this.fragmentContextID = fragmentContext ? (0, html_js_1.getTagID)(this.treeAdapter.getTagName(fragmentContext)) : html_js_1.TAG_ID.UNKNOWN;\n\n    this._setContextModes(fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : this.document, this.fragmentContextID);\n\n    this.openElements = new open_element_stack_js_1.OpenElementStack(this.document, this.treeAdapter, this);\n  } // API\n\n\n  static parse(html, options) {\n    const parser = new this(options);\n    parser.tokenizer.write(html, true);\n    return parser.document;\n  }\n\n  static getFragmentParser(fragmentContext, options) {\n    const opts = Object.assign(Object.assign({}, defaultParserOptions), options); //NOTE: use a <template> element as the fragment context if no context element was provided,\n    //so we will parse in a \"forgiving\" manner\n\n    fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : fragmentContext = opts.treeAdapter.createElement(html_js_1.TAG_NAMES.TEMPLATE, html_js_1.NS.HTML, []); //NOTE: create a fake element which will be used as the `document` for fragment parsing.\n    //This is important for jsdom, where a new `document` cannot be created. This led to\n    //fragment parsing messing with the main `document`.\n\n    const documentMock = opts.treeAdapter.createElement('documentmock', html_js_1.NS.HTML, []);\n    const parser = new this(opts, documentMock, fragmentContext);\n\n    if (parser.fragmentContextID === html_js_1.TAG_ID.TEMPLATE) {\n      parser.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n    }\n\n    parser._initTokenizerForFragmentParsing();\n\n    parser._insertFakeRootElement();\n\n    parser._resetInsertionMode();\n\n    parser._findFormInFragmentContext();\n\n    return parser;\n  }\n\n  getFragment() {\n    const rootElement = this.treeAdapter.getFirstChild(this.document);\n    const fragment = this.treeAdapter.createDocumentFragment();\n\n    this._adoptNodes(rootElement, fragment);\n\n    return fragment;\n  } //Errors\n\n\n  _err(token, code, beforeToken) {\n    var _a;\n\n    if (!this.onParseError) return;\n    const loc = (_a = token.location) !== null && _a !== void 0 ? _a : BASE_LOC;\n    const err = {\n      code,\n      startLine: loc.startLine,\n      startCol: loc.startCol,\n      startOffset: loc.startOffset,\n      endLine: beforeToken ? loc.startLine : loc.endLine,\n      endCol: beforeToken ? loc.startCol : loc.endCol,\n      endOffset: beforeToken ? loc.startOffset : loc.endOffset\n    };\n    this.onParseError(err);\n  } //Stack events\n\n\n  onItemPush(node, tid, isTop) {\n    var _a, _b;\n\n    (_b = (_a = this.treeAdapter).onItemPush) === null || _b === void 0 ? void 0 : _b.call(_a, node);\n    if (isTop && this.openElements.stackTop > 0) this._setContextModes(node, tid);\n  }\n\n  onItemPop(node, isTop) {\n    var _a, _b;\n\n    if (this.options.sourceCodeLocationInfo) {\n      this._setEndLocation(node, this.currentToken);\n    }\n\n    (_b = (_a = this.treeAdapter).onItemPop) === null || _b === void 0 ? void 0 : _b.call(_a, node, this.openElements.current);\n\n    if (isTop) {\n      let current;\n      let currentTagId;\n\n      if (this.openElements.stackTop === 0 && this.fragmentContext) {\n        current = this.fragmentContext;\n        currentTagId = this.fragmentContextID;\n      } else {\n        ({\n          current,\n          currentTagId\n        } = this.openElements);\n      }\n\n      this._setContextModes(current, currentTagId);\n    }\n  }\n\n  _setContextModes(current, tid) {\n    const isHTML = current === this.document || this.treeAdapter.getNamespaceURI(current) === html_js_1.NS.HTML;\n    this.currentNotInHTML = !isHTML;\n    this.tokenizer.inForeignNode = !isHTML && !this._isIntegrationPoint(tid, current);\n  }\n\n  _switchToTextParsing(currentToken, nextTokenizerState) {\n    this._insertElement(currentToken, html_js_1.NS.HTML);\n\n    this.tokenizer.state = nextTokenizerState;\n    this.originalInsertionMode = this.insertionMode;\n    this.insertionMode = InsertionMode.TEXT;\n  }\n\n  switchToPlaintextParsing() {\n    this.insertionMode = InsertionMode.TEXT;\n    this.originalInsertionMode = InsertionMode.IN_BODY;\n    this.tokenizer.state = index_js_1.TokenizerMode.PLAINTEXT;\n  } //Fragment parsing\n\n\n  _getAdjustedCurrentElement() {\n    return this.openElements.stackTop === 0 && this.fragmentContext ? this.fragmentContext : this.openElements.current;\n  }\n\n  _findFormInFragmentContext() {\n    let node = this.fragmentContext;\n\n    while (node) {\n      if (this.treeAdapter.getTagName(node) === html_js_1.TAG_NAMES.FORM) {\n        this.formElement = node;\n        break;\n      }\n\n      node = this.treeAdapter.getParentNode(node);\n    }\n  }\n\n  _initTokenizerForFragmentParsing() {\n    if (!this.fragmentContext || this.treeAdapter.getNamespaceURI(this.fragmentContext) !== html_js_1.NS.HTML) {\n      return;\n    }\n\n    switch (this.fragmentContextID) {\n      case html_js_1.TAG_ID.TITLE:\n      case html_js_1.TAG_ID.TEXTAREA:\n        {\n          this.tokenizer.state = index_js_1.TokenizerMode.RCDATA;\n          break;\n        }\n\n      case html_js_1.TAG_ID.STYLE:\n      case html_js_1.TAG_ID.XMP:\n      case html_js_1.TAG_ID.IFRAME:\n      case html_js_1.TAG_ID.NOEMBED:\n      case html_js_1.TAG_ID.NOFRAMES:\n      case html_js_1.TAG_ID.NOSCRIPT:\n        {\n          this.tokenizer.state = index_js_1.TokenizerMode.RAWTEXT;\n          break;\n        }\n\n      case html_js_1.TAG_ID.SCRIPT:\n        {\n          this.tokenizer.state = index_js_1.TokenizerMode.SCRIPT_DATA;\n          break;\n        }\n\n      case html_js_1.TAG_ID.PLAINTEXT:\n        {\n          this.tokenizer.state = index_js_1.TokenizerMode.PLAINTEXT;\n          break;\n        }\n\n      default: // Do nothing\n\n    }\n  } //Tree mutation\n\n\n  _setDocumentType(token) {\n    const name = token.name || '';\n    const publicId = token.publicId || '';\n    const systemId = token.systemId || '';\n    this.treeAdapter.setDocumentType(this.document, name, publicId, systemId);\n\n    if (token.location) {\n      const documentChildren = this.treeAdapter.getChildNodes(this.document);\n      const docTypeNode = documentChildren.find(node => this.treeAdapter.isDocumentTypeNode(node));\n\n      if (docTypeNode) {\n        this.treeAdapter.setNodeSourceCodeLocation(docTypeNode, token.location);\n      }\n    }\n  }\n\n  _attachElementToTree(element, location) {\n    if (this.options.sourceCodeLocationInfo) {\n      const loc = location && Object.assign(Object.assign({}, location), {\n        startTag: location\n      });\n      this.treeAdapter.setNodeSourceCodeLocation(element, loc);\n    }\n\n    if (this._shouldFosterParentOnInsertion()) {\n      this._fosterParentElement(element);\n    } else {\n      const parent = this.openElements.currentTmplContentOrNode;\n      this.treeAdapter.appendChild(parent, element);\n    }\n  }\n\n  _appendElement(token, namespaceURI) {\n    const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n    this._attachElementToTree(element, token.location);\n  }\n\n  _insertElement(token, namespaceURI) {\n    const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n\n    this._attachElementToTree(element, token.location);\n\n    this.openElements.push(element, token.tagID);\n  }\n\n  _insertFakeElement(tagName, tagID) {\n    const element = this.treeAdapter.createElement(tagName, html_js_1.NS.HTML, []);\n\n    this._attachElementToTree(element, null);\n\n    this.openElements.push(element, tagID);\n  }\n\n  _insertTemplate(token) {\n    const tmpl = this.treeAdapter.createElement(token.tagName, html_js_1.NS.HTML, token.attrs);\n    const content = this.treeAdapter.createDocumentFragment();\n    this.treeAdapter.setTemplateContent(tmpl, content);\n\n    this._attachElementToTree(tmpl, token.location);\n\n    this.openElements.push(tmpl, token.tagID);\n    if (this.options.sourceCodeLocationInfo) this.treeAdapter.setNodeSourceCodeLocation(content, null);\n  }\n\n  _insertFakeRootElement() {\n    const element = this.treeAdapter.createElement(html_js_1.TAG_NAMES.HTML, html_js_1.NS.HTML, []);\n    if (this.options.sourceCodeLocationInfo) this.treeAdapter.setNodeSourceCodeLocation(element, null);\n    this.treeAdapter.appendChild(this.openElements.current, element);\n    this.openElements.push(element, html_js_1.TAG_ID.HTML);\n  }\n\n  _appendCommentNode(token, parent) {\n    const commentNode = this.treeAdapter.createCommentNode(token.data);\n    this.treeAdapter.appendChild(parent, commentNode);\n\n    if (this.options.sourceCodeLocationInfo) {\n      this.treeAdapter.setNodeSourceCodeLocation(commentNode, token.location);\n    }\n  }\n\n  _insertCharacters(token) {\n    let parent;\n    let beforeElement;\n\n    if (this._shouldFosterParentOnInsertion()) {\n      ({\n        parent,\n        beforeElement\n      } = this._findFosterParentingLocation());\n\n      if (beforeElement) {\n        this.treeAdapter.insertTextBefore(parent, token.chars, beforeElement);\n      } else {\n        this.treeAdapter.insertText(parent, token.chars);\n      }\n    } else {\n      parent = this.openElements.currentTmplContentOrNode;\n      this.treeAdapter.insertText(parent, token.chars);\n    }\n\n    if (!token.location) return;\n    const siblings = this.treeAdapter.getChildNodes(parent);\n    const textNodeIdx = beforeElement ? siblings.lastIndexOf(beforeElement) : siblings.length;\n    const textNode = siblings[textNodeIdx - 1]; //NOTE: if we have a location assigned by another token, then just update the end position\n\n    const tnLoc = this.treeAdapter.getNodeSourceCodeLocation(textNode);\n\n    if (tnLoc) {\n      const {\n        endLine,\n        endCol,\n        endOffset\n      } = token.location;\n      this.treeAdapter.updateNodeSourceCodeLocation(textNode, {\n        endLine,\n        endCol,\n        endOffset\n      });\n    } else if (this.options.sourceCodeLocationInfo) {\n      this.treeAdapter.setNodeSourceCodeLocation(textNode, token.location);\n    }\n  }\n\n  _adoptNodes(donor, recipient) {\n    for (let child = this.treeAdapter.getFirstChild(donor); child; child = this.treeAdapter.getFirstChild(donor)) {\n      this.treeAdapter.detachNode(child);\n      this.treeAdapter.appendChild(recipient, child);\n    }\n  }\n\n  _setEndLocation(element, closingToken) {\n    if (this.treeAdapter.getNodeSourceCodeLocation(element) && closingToken.location) {\n      const ctLoc = closingToken.location;\n      const tn = this.treeAdapter.getTagName(element);\n      const endLoc = // NOTE: For cases like <p> <p> </p> - First 'p' closes without a closing\n      // tag and for cases like <td> <p> </td> - 'p' closes without a closing tag.\n      closingToken.type === token_js_1.TokenType.END_TAG && tn === closingToken.tagName ? {\n        endTag: Object.assign({}, ctLoc),\n        endLine: ctLoc.endLine,\n        endCol: ctLoc.endCol,\n        endOffset: ctLoc.endOffset\n      } : {\n        endLine: ctLoc.startLine,\n        endCol: ctLoc.startCol,\n        endOffset: ctLoc.startOffset\n      };\n      this.treeAdapter.updateNodeSourceCodeLocation(element, endLoc);\n    }\n  } //Token processing\n\n\n  shouldProcessStartTagTokenInForeignContent(token) {\n    // Check that neither current === document, or ns === NS.HTML\n    if (!this.currentNotInHTML) return false;\n    let current;\n    let currentTagId;\n\n    if (this.openElements.stackTop === 0 && this.fragmentContext) {\n      current = this.fragmentContext;\n      currentTagId = this.fragmentContextID;\n    } else {\n      ({\n        current,\n        currentTagId\n      } = this.openElements);\n    }\n\n    if (token.tagID === html_js_1.TAG_ID.SVG && this.treeAdapter.getTagName(current) === html_js_1.TAG_NAMES.ANNOTATION_XML && this.treeAdapter.getNamespaceURI(current) === html_js_1.NS.MATHML) {\n      return false;\n    }\n\n    return (// Check that `current` is not an integration point for HTML or MathML elements.\n      this.tokenizer.inForeignNode || // If it _is_ an integration point, then we might have to check that it is not an HTML\n      // integration point.\n      (token.tagID === html_js_1.TAG_ID.MGLYPH || token.tagID === html_js_1.TAG_ID.MALIGNMARK) && !this._isIntegrationPoint(currentTagId, current, html_js_1.NS.HTML)\n    );\n  }\n\n  _processToken(token) {\n    switch (token.type) {\n      case token_js_1.TokenType.CHARACTER:\n        {\n          this.onCharacter(token);\n          break;\n        }\n\n      case token_js_1.TokenType.NULL_CHARACTER:\n        {\n          this.onNullCharacter(token);\n          break;\n        }\n\n      case token_js_1.TokenType.COMMENT:\n        {\n          this.onComment(token);\n          break;\n        }\n\n      case token_js_1.TokenType.DOCTYPE:\n        {\n          this.onDoctype(token);\n          break;\n        }\n\n      case token_js_1.TokenType.START_TAG:\n        {\n          this._processStartTag(token);\n\n          break;\n        }\n\n      case token_js_1.TokenType.END_TAG:\n        {\n          this.onEndTag(token);\n          break;\n        }\n\n      case token_js_1.TokenType.EOF:\n        {\n          this.onEof(token);\n          break;\n        }\n\n      case token_js_1.TokenType.WHITESPACE_CHARACTER:\n        {\n          this.onWhitespaceCharacter(token);\n          break;\n        }\n    }\n  } //Integration points\n\n\n  _isIntegrationPoint(tid, element, foreignNS) {\n    const ns = this.treeAdapter.getNamespaceURI(element);\n    const attrs = this.treeAdapter.getAttrList(element);\n    return foreignContent.isIntegrationPoint(tid, ns, attrs, foreignNS);\n  } //Active formatting elements reconstruction\n\n\n  _reconstructActiveFormattingElements() {\n    const listLength = this.activeFormattingElements.entries.length;\n\n    if (listLength) {\n      const endIndex = this.activeFormattingElements.entries.findIndex(entry => entry.type === formatting_element_list_js_1.EntryType.Marker || this.openElements.contains(entry.element));\n      const unopenIdx = endIndex < 0 ? listLength - 1 : endIndex - 1;\n\n      for (let i = unopenIdx; i >= 0; i--) {\n        const entry = this.activeFormattingElements.entries[i];\n\n        this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n\n        entry.element = this.openElements.current;\n      }\n    }\n  } //Close elements\n\n\n  _closeTableCell() {\n    this.openElements.generateImpliedEndTags();\n    this.openElements.popUntilTableCellPopped();\n    this.activeFormattingElements.clearToLastMarker();\n    this.insertionMode = InsertionMode.IN_ROW;\n  }\n\n  _closePElement() {\n    this.openElements.generateImpliedEndTagsWithExclusion(html_js_1.TAG_ID.P);\n    this.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.P);\n  } //Insertion modes\n\n\n  _resetInsertionMode() {\n    for (let i = this.openElements.stackTop; i >= 0; i--) {\n      //Insertion mode reset map\n      switch (i === 0 && this.fragmentContext ? this.fragmentContextID : this.openElements.tagIDs[i]) {\n        case html_js_1.TAG_ID.TR:\n          this.insertionMode = InsertionMode.IN_ROW;\n          return;\n\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.THEAD:\n        case html_js_1.TAG_ID.TFOOT:\n          this.insertionMode = InsertionMode.IN_TABLE_BODY;\n          return;\n\n        case html_js_1.TAG_ID.CAPTION:\n          this.insertionMode = InsertionMode.IN_CAPTION;\n          return;\n\n        case html_js_1.TAG_ID.COLGROUP:\n          this.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n          return;\n\n        case html_js_1.TAG_ID.TABLE:\n          this.insertionMode = InsertionMode.IN_TABLE;\n          return;\n\n        case html_js_1.TAG_ID.BODY:\n          this.insertionMode = InsertionMode.IN_BODY;\n          return;\n\n        case html_js_1.TAG_ID.FRAMESET:\n          this.insertionMode = InsertionMode.IN_FRAMESET;\n          return;\n\n        case html_js_1.TAG_ID.SELECT:\n          this._resetInsertionModeForSelect(i);\n\n          return;\n\n        case html_js_1.TAG_ID.TEMPLATE:\n          this.insertionMode = this.tmplInsertionModeStack[0];\n          return;\n\n        case html_js_1.TAG_ID.HTML:\n          this.insertionMode = this.headElement ? InsertionMode.AFTER_HEAD : InsertionMode.BEFORE_HEAD;\n          return;\n\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TH:\n          if (i > 0) {\n            this.insertionMode = InsertionMode.IN_CELL;\n            return;\n          }\n\n          break;\n\n        case html_js_1.TAG_ID.HEAD:\n          if (i > 0) {\n            this.insertionMode = InsertionMode.IN_HEAD;\n            return;\n          }\n\n          break;\n      }\n    }\n\n    this.insertionMode = InsertionMode.IN_BODY;\n  }\n\n  _resetInsertionModeForSelect(selectIdx) {\n    if (selectIdx > 0) {\n      for (let i = selectIdx - 1; i > 0; i--) {\n        const tn = this.openElements.tagIDs[i];\n\n        if (tn === html_js_1.TAG_ID.TEMPLATE) {\n          break;\n        } else if (tn === html_js_1.TAG_ID.TABLE) {\n          this.insertionMode = InsertionMode.IN_SELECT_IN_TABLE;\n          return;\n        }\n      }\n    }\n\n    this.insertionMode = InsertionMode.IN_SELECT;\n  } //Foster parenting\n\n\n  _isElementCausesFosterParenting(tn) {\n    return TABLE_STRUCTURE_TAGS.has(tn);\n  }\n\n  _shouldFosterParentOnInsertion() {\n    return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.currentTagId);\n  }\n\n  _findFosterParentingLocation() {\n    for (let i = this.openElements.stackTop; i >= 0; i--) {\n      const openElement = this.openElements.items[i];\n\n      switch (this.openElements.tagIDs[i]) {\n        case html_js_1.TAG_ID.TEMPLATE:\n          if (this.treeAdapter.getNamespaceURI(openElement) === html_js_1.NS.HTML) {\n            return {\n              parent: this.treeAdapter.getTemplateContent(openElement),\n              beforeElement: null\n            };\n          }\n\n          break;\n\n        case html_js_1.TAG_ID.TABLE:\n          {\n            const parent = this.treeAdapter.getParentNode(openElement);\n\n            if (parent) {\n              return {\n                parent,\n                beforeElement: openElement\n              };\n            }\n\n            return {\n              parent: this.openElements.items[i - 1],\n              beforeElement: null\n            };\n          }\n\n        default: // Do nothing\n\n      }\n    }\n\n    return {\n      parent: this.openElements.items[0],\n      beforeElement: null\n    };\n  }\n\n  _fosterParentElement(element) {\n    const location = this._findFosterParentingLocation();\n\n    if (location.beforeElement) {\n      this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\n    } else {\n      this.treeAdapter.appendChild(location.parent, element);\n    }\n  } //Special elements\n\n\n  _isSpecialElement(element, id) {\n    const ns = this.treeAdapter.getNamespaceURI(element);\n    return html_js_1.SPECIAL_ELEMENTS[ns].has(id);\n  }\n\n  onCharacter(token) {\n    this.skipNextNewLine = false;\n\n    if (this.tokenizer.inForeignNode) {\n      characterInForeignContent(this, token);\n      return;\n    }\n\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        tokenBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        tokenBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        tokenInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        tokenInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        tokenAfterHead(this, token);\n        break;\n\n      case InsertionMode.IN_BODY:\n      case InsertionMode.IN_CAPTION:\n      case InsertionMode.IN_CELL:\n      case InsertionMode.IN_TEMPLATE:\n        characterInBody(this, token);\n        break;\n\n      case InsertionMode.TEXT:\n      case InsertionMode.IN_SELECT:\n      case InsertionMode.IN_SELECT_IN_TABLE:\n        this._insertCharacters(token);\n\n        break;\n\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n        characterInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        characterInTableText(this, token);\n        break;\n\n      case InsertionMode.IN_COLUMN_GROUP:\n        tokenInColumnGroup(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        tokenAfterBody(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n        tokenAfterAfterBody(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onNullCharacter(token) {\n    this.skipNextNewLine = false;\n\n    if (this.tokenizer.inForeignNode) {\n      nullCharacterInForeignContent(this, token);\n      return;\n    }\n\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        tokenBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        tokenBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        tokenInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        tokenInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        tokenAfterHead(this, token);\n        break;\n\n      case InsertionMode.TEXT:\n        this._insertCharacters(token);\n\n        break;\n\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n        characterInTable(this, token);\n        break;\n\n      case InsertionMode.IN_COLUMN_GROUP:\n        tokenInColumnGroup(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        tokenAfterBody(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n        tokenAfterAfterBody(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onComment(token) {\n    this.skipNextNewLine = false;\n\n    if (this.currentNotInHTML) {\n      appendComment(this, token);\n      return;\n    }\n\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n      case InsertionMode.BEFORE_HTML:\n      case InsertionMode.BEFORE_HEAD:\n      case InsertionMode.IN_HEAD:\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n      case InsertionMode.AFTER_HEAD:\n      case InsertionMode.IN_BODY:\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_CAPTION:\n      case InsertionMode.IN_COLUMN_GROUP:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n      case InsertionMode.IN_CELL:\n      case InsertionMode.IN_SELECT:\n      case InsertionMode.IN_SELECT_IN_TABLE:\n      case InsertionMode.IN_TEMPLATE:\n      case InsertionMode.IN_FRAMESET:\n      case InsertionMode.AFTER_FRAMESET:\n        appendComment(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        appendCommentToRootHtmlElement(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n      case InsertionMode.AFTER_AFTER_FRAMESET:\n        appendCommentToDocument(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onDoctype(token) {\n    this.skipNextNewLine = false;\n\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        doctypeInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n      case InsertionMode.IN_HEAD:\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n      case InsertionMode.AFTER_HEAD:\n        this._err(token, error_codes_js_1.ERR.misplacedDoctype);\n\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onStartTag(token) {\n    this.skipNextNewLine = false;\n    this.currentToken = token;\n\n    this._processStartTag(token);\n\n    if (token.selfClosing && !token.ackSelfClosing) {\n      this._err(token, error_codes_js_1.ERR.nonVoidHtmlElementStartTagWithTrailingSolidus);\n    }\n  }\n  /**\n   * Processes a given start tag.\n   *\n   * `onStartTag` checks if a self-closing tag was recognized. When a token\n   * is moved inbetween multiple insertion modes, this check for self-closing\n   * could lead to false positives. To avoid this, `_processStartTag` is used\n   * for nested calls.\n   *\n   * @param token The token to process.\n   */\n\n\n  _processStartTag(token) {\n    if (this.shouldProcessStartTagTokenInForeignContent(token)) {\n      startTagInForeignContent(this, token);\n    } else {\n      this._startTagOutsideForeignContent(token);\n    }\n  }\n\n  _startTagOutsideForeignContent(token) {\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        startTagBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        startTagBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        startTagInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        startTagInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        startTagAfterHead(this, token);\n        break;\n\n      case InsertionMode.IN_BODY:\n        startTagInBody(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE:\n        startTagInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      case InsertionMode.IN_CAPTION:\n        startTagInCaption(this, token);\n        break;\n\n      case InsertionMode.IN_COLUMN_GROUP:\n        startTagInColumnGroup(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_BODY:\n        startTagInTableBody(this, token);\n        break;\n\n      case InsertionMode.IN_ROW:\n        startTagInRow(this, token);\n        break;\n\n      case InsertionMode.IN_CELL:\n        startTagInCell(this, token);\n        break;\n\n      case InsertionMode.IN_SELECT:\n        startTagInSelect(this, token);\n        break;\n\n      case InsertionMode.IN_SELECT_IN_TABLE:\n        startTagInSelectInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TEMPLATE:\n        startTagInTemplate(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        startTagAfterBody(this, token);\n        break;\n\n      case InsertionMode.IN_FRAMESET:\n        startTagInFrameset(this, token);\n        break;\n\n      case InsertionMode.AFTER_FRAMESET:\n        startTagAfterFrameset(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n        startTagAfterAfterBody(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_FRAMESET:\n        startTagAfterAfterFrameset(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onEndTag(token) {\n    this.skipNextNewLine = false;\n    this.currentToken = token;\n\n    if (this.currentNotInHTML) {\n      endTagInForeignContent(this, token);\n    } else {\n      this._endTagOutsideForeignContent(token);\n    }\n  }\n\n  _endTagOutsideForeignContent(token) {\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        endTagBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        endTagBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        endTagInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        endTagInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        endTagAfterHead(this, token);\n        break;\n\n      case InsertionMode.IN_BODY:\n        endTagInBody(this, token);\n        break;\n\n      case InsertionMode.TEXT:\n        endTagInText(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE:\n        endTagInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      case InsertionMode.IN_CAPTION:\n        endTagInCaption(this, token);\n        break;\n\n      case InsertionMode.IN_COLUMN_GROUP:\n        endTagInColumnGroup(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_BODY:\n        endTagInTableBody(this, token);\n        break;\n\n      case InsertionMode.IN_ROW:\n        endTagInRow(this, token);\n        break;\n\n      case InsertionMode.IN_CELL:\n        endTagInCell(this, token);\n        break;\n\n      case InsertionMode.IN_SELECT:\n        endTagInSelect(this, token);\n        break;\n\n      case InsertionMode.IN_SELECT_IN_TABLE:\n        endTagInSelectInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TEMPLATE:\n        endTagInTemplate(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n        endTagAfterBody(this, token);\n        break;\n\n      case InsertionMode.IN_FRAMESET:\n        endTagInFrameset(this, token);\n        break;\n\n      case InsertionMode.AFTER_FRAMESET:\n        endTagAfterFrameset(this, token);\n        break;\n\n      case InsertionMode.AFTER_AFTER_BODY:\n        tokenAfterAfterBody(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onEof(token) {\n    switch (this.insertionMode) {\n      case InsertionMode.INITIAL:\n        tokenInInitialMode(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HTML:\n        tokenBeforeHtml(this, token);\n        break;\n\n      case InsertionMode.BEFORE_HEAD:\n        tokenBeforeHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD:\n        tokenInHead(this, token);\n        break;\n\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n        tokenInHeadNoScript(this, token);\n        break;\n\n      case InsertionMode.AFTER_HEAD:\n        tokenAfterHead(this, token);\n        break;\n\n      case InsertionMode.IN_BODY:\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_CAPTION:\n      case InsertionMode.IN_COLUMN_GROUP:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n      case InsertionMode.IN_CELL:\n      case InsertionMode.IN_SELECT:\n      case InsertionMode.IN_SELECT_IN_TABLE:\n        eofInBody(this, token);\n        break;\n\n      case InsertionMode.TEXT:\n        eofInText(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        tokenInTableText(this, token);\n        break;\n\n      case InsertionMode.IN_TEMPLATE:\n        eofInTemplate(this, token);\n        break;\n\n      case InsertionMode.AFTER_BODY:\n      case InsertionMode.IN_FRAMESET:\n      case InsertionMode.AFTER_FRAMESET:\n      case InsertionMode.AFTER_AFTER_BODY:\n      case InsertionMode.AFTER_AFTER_FRAMESET:\n        stopParsing(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n  onWhitespaceCharacter(token) {\n    if (this.skipNextNewLine) {\n      this.skipNextNewLine = false;\n\n      if (token.chars.charCodeAt(0) === unicode.CODE_POINTS.LINE_FEED) {\n        if (token.chars.length === 1) {\n          return;\n        }\n\n        token.chars = token.chars.substr(1);\n      }\n    }\n\n    if (this.tokenizer.inForeignNode) {\n      this._insertCharacters(token);\n\n      return;\n    }\n\n    switch (this.insertionMode) {\n      case InsertionMode.IN_HEAD:\n      case InsertionMode.IN_HEAD_NO_SCRIPT:\n      case InsertionMode.AFTER_HEAD:\n      case InsertionMode.TEXT:\n      case InsertionMode.IN_COLUMN_GROUP:\n      case InsertionMode.IN_SELECT:\n      case InsertionMode.IN_SELECT_IN_TABLE:\n      case InsertionMode.IN_FRAMESET:\n      case InsertionMode.AFTER_FRAMESET:\n        this._insertCharacters(token);\n\n        break;\n\n      case InsertionMode.IN_BODY:\n      case InsertionMode.IN_CAPTION:\n      case InsertionMode.IN_CELL:\n      case InsertionMode.IN_TEMPLATE:\n      case InsertionMode.AFTER_BODY:\n      case InsertionMode.AFTER_AFTER_BODY:\n      case InsertionMode.AFTER_AFTER_FRAMESET:\n        whitespaceCharacterInBody(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE:\n      case InsertionMode.IN_TABLE_BODY:\n      case InsertionMode.IN_ROW:\n        characterInTable(this, token);\n        break;\n\n      case InsertionMode.IN_TABLE_TEXT:\n        whitespaceCharacterInTableText(this, token);\n        break;\n\n      default: // Do nothing\n\n    }\n  }\n\n}\n\nexports.Parser = Parser; //Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n//Steps 5-8 of the algorithm\n\nfunction aaObtainFormattingElementEntry(p, token) {\n  let formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n\n  if (formattingElementEntry) {\n    if (!p.openElements.contains(formattingElementEntry.element)) {\n      p.activeFormattingElements.removeEntry(formattingElementEntry);\n      formattingElementEntry = null;\n    } else if (!p.openElements.hasInScope(token.tagID)) {\n      formattingElementEntry = null;\n    }\n  } else {\n    genericEndTagInBody(p, token);\n  }\n\n  return formattingElementEntry;\n} //Steps 9 and 10 of the algorithm\n\n\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n  let furthestBlock = null;\n  let idx = p.openElements.stackTop;\n\n  for (; idx >= 0; idx--) {\n    const element = p.openElements.items[idx];\n\n    if (element === formattingElementEntry.element) {\n      break;\n    }\n\n    if (p._isSpecialElement(element, p.openElements.tagIDs[idx])) {\n      furthestBlock = element;\n    }\n  }\n\n  if (!furthestBlock) {\n    p.openElements.shortenToLength(idx < 0 ? 0 : idx);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n  }\n\n  return furthestBlock;\n} //Step 13 of the algorithm\n\n\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n  let lastElement = furthestBlock;\n  let nextElement = p.openElements.getCommonAncestor(furthestBlock);\n\n  for (let i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\n    //NOTE: store the next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n    nextElement = p.openElements.getCommonAncestor(element);\n    const elementEntry = p.activeFormattingElements.getElementEntry(element);\n    const counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER;\n    const shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\n\n    if (shouldRemoveFromOpenElements) {\n      if (counterOverflow) {\n        p.activeFormattingElements.removeEntry(elementEntry);\n      }\n\n      p.openElements.remove(element);\n    } else {\n      element = aaRecreateElementFromEntry(p, elementEntry);\n\n      if (lastElement === furthestBlock) {\n        p.activeFormattingElements.bookmark = elementEntry;\n      }\n\n      p.treeAdapter.detachNode(lastElement);\n      p.treeAdapter.appendChild(element, lastElement);\n      lastElement = element;\n    }\n  }\n\n  return lastElement;\n} //Step 13.7 of the algorithm\n\n\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n  const ns = p.treeAdapter.getNamespaceURI(elementEntry.element);\n  const newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n  p.openElements.replace(elementEntry.element, newElement);\n  elementEntry.element = newElement;\n  return newElement;\n} //Step 14 of the algorithm\n\n\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n  const tn = p.treeAdapter.getTagName(commonAncestor);\n  const tid = (0, html_js_1.getTagID)(tn);\n\n  if (p._isElementCausesFosterParenting(tid)) {\n    p._fosterParentElement(lastElement);\n  } else {\n    const ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n\n    if (tid === html_js_1.TAG_ID.TEMPLATE && ns === html_js_1.NS.HTML) {\n      commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\n    }\n\n    p.treeAdapter.appendChild(commonAncestor, lastElement);\n  }\n} //Steps 15-19 of the algorithm\n\n\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n  const ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element);\n  const {\n    token\n  } = formattingElementEntry;\n  const newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n\n  p._adoptNodes(furthestBlock, newElement);\n\n  p.treeAdapter.appendChild(furthestBlock, newElement);\n  p.activeFormattingElements.insertElementAfterBookmark(newElement, token);\n  p.activeFormattingElements.removeEntry(formattingElementEntry);\n  p.openElements.remove(formattingElementEntry.element);\n  p.openElements.insertAfter(furthestBlock, newElement, token.tagID);\n} //Algorithm entry point\n\n\nfunction callAdoptionAgency(p, token) {\n  for (let i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n    const formattingElementEntry = aaObtainFormattingElementEntry(p, token);\n\n    if (!formattingElementEntry) {\n      break;\n    }\n\n    const furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n\n    if (!furthestBlock) {\n      break;\n    }\n\n    p.activeFormattingElements.bookmark = formattingElementEntry;\n    const lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element);\n    const commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n    p.treeAdapter.detachNode(lastElement);\n    if (commonAncestor) aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n    aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n  }\n} //Generic token handlers\n//------------------------------------------------------------------\n\n\nfunction appendComment(p, token) {\n  p._appendCommentNode(token, p.openElements.currentTmplContentOrNode);\n}\n\nfunction appendCommentToRootHtmlElement(p, token) {\n  p._appendCommentNode(token, p.openElements.items[0]);\n}\n\nfunction appendCommentToDocument(p, token) {\n  p._appendCommentNode(token, p.document);\n}\n\nfunction stopParsing(p, token) {\n  p.stopped = true; // NOTE: Set end locations for elements that remain on the open element stack.\n\n  if (token.location) {\n    // NOTE: If we are not in a fragment, `html` and `body` will stay on the stack.\n    // This is a problem, as we might overwrite their end position here.\n    const target = p.fragmentContext ? 0 : 2;\n\n    for (let i = p.openElements.stackTop; i >= target; i--) {\n      p._setEndLocation(p.openElements.items[i], token);\n    } // Handle `html` and `body`\n\n\n    if (!p.fragmentContext && p.openElements.stackTop >= 0) {\n      const htmlElement = p.openElements.items[0];\n      const htmlLocation = p.treeAdapter.getNodeSourceCodeLocation(htmlElement);\n\n      if (htmlLocation && !htmlLocation.endTag) {\n        p._setEndLocation(htmlElement, token);\n\n        if (p.openElements.stackTop >= 1) {\n          const bodyElement = p.openElements.items[1];\n          const bodyLocation = p.treeAdapter.getNodeSourceCodeLocation(bodyElement);\n\n          if (bodyLocation && !bodyLocation.endTag) {\n            p._setEndLocation(bodyElement, token);\n          }\n        }\n      }\n    }\n  }\n} // The \"initial\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction doctypeInInitialMode(p, token) {\n  p._setDocumentType(token);\n\n  const mode = token.forceQuirks ? html_js_1.DOCUMENT_MODE.QUIRKS : doctype.getDocumentMode(token);\n\n  if (!doctype.isConforming(token)) {\n    p._err(token, error_codes_js_1.ERR.nonConformingDoctype);\n  }\n\n  p.treeAdapter.setDocumentMode(p.document, mode);\n  p.insertionMode = InsertionMode.BEFORE_HTML;\n}\n\nfunction tokenInInitialMode(p, token) {\n  p._err(token, error_codes_js_1.ERR.missingDoctype, true);\n\n  p.treeAdapter.setDocumentMode(p.document, html_js_1.DOCUMENT_MODE.QUIRKS);\n  p.insertionMode = InsertionMode.BEFORE_HTML;\n\n  p._processToken(token);\n} // The \"before html\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagBeforeHtml(p, token) {\n  if (token.tagID === html_js_1.TAG_ID.HTML) {\n    p._insertElement(token, html_js_1.NS.HTML);\n\n    p.insertionMode = InsertionMode.BEFORE_HEAD;\n  } else {\n    tokenBeforeHtml(p, token);\n  }\n}\n\nfunction endTagBeforeHtml(p, token) {\n  const tn = token.tagID;\n\n  if (tn === html_js_1.TAG_ID.HTML || tn === html_js_1.TAG_ID.HEAD || tn === html_js_1.TAG_ID.BODY || tn === html_js_1.TAG_ID.BR) {\n    tokenBeforeHtml(p, token);\n  }\n}\n\nfunction tokenBeforeHtml(p, token) {\n  p._insertFakeRootElement();\n\n  p.insertionMode = InsertionMode.BEFORE_HEAD;\n\n  p._processToken(token);\n} // The \"before head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagBeforeHead(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.HEAD:\n      {\n        p._insertElement(token, html_js_1.NS.HTML);\n\n        p.headElement = p.openElements.current;\n        p.insertionMode = InsertionMode.IN_HEAD;\n        break;\n      }\n\n    default:\n      {\n        tokenBeforeHead(p, token);\n      }\n  }\n}\n\nfunction endTagBeforeHead(p, token) {\n  const tn = token.tagID;\n\n  if (tn === html_js_1.TAG_ID.HEAD || tn === html_js_1.TAG_ID.BODY || tn === html_js_1.TAG_ID.HTML || tn === html_js_1.TAG_ID.BR) {\n    tokenBeforeHead(p, token);\n  } else {\n    p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n  }\n}\n\nfunction tokenBeforeHead(p, token) {\n  p._insertFakeElement(html_js_1.TAG_NAMES.HEAD, html_js_1.TAG_ID.HEAD);\n\n  p.headElement = p.openElements.current;\n  p.insertionMode = InsertionMode.IN_HEAD;\n\n  p._processToken(token);\n} // The \"in head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInHead(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BASE:\n    case html_js_1.TAG_ID.BASEFONT:\n    case html_js_1.TAG_ID.BGSOUND:\n    case html_js_1.TAG_ID.LINK:\n    case html_js_1.TAG_ID.META:\n      {\n        p._appendElement(token, html_js_1.NS.HTML);\n\n        token.ackSelfClosing = true;\n        break;\n      }\n\n    case html_js_1.TAG_ID.TITLE:\n      {\n        p._switchToTextParsing(token, index_js_1.TokenizerMode.RCDATA);\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOSCRIPT:\n      {\n        if (p.options.scriptingEnabled) {\n          p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n        } else {\n          p._insertElement(token, html_js_1.NS.HTML);\n\n          p.insertionMode = InsertionMode.IN_HEAD_NO_SCRIPT;\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOFRAMES:\n    case html_js_1.TAG_ID.STYLE:\n      {\n        p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.SCRIPT:\n      {\n        p._switchToTextParsing(token, index_js_1.TokenizerMode.SCRIPT_DATA);\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        p._insertTemplate(token);\n\n        p.activeFormattingElements.insertMarker();\n        p.framesetOk = false;\n        p.insertionMode = InsertionMode.IN_TEMPLATE;\n        p.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n        break;\n      }\n\n    case html_js_1.TAG_ID.HEAD:\n      {\n        p._err(token, error_codes_js_1.ERR.misplacedStartTagForHeadElement);\n\n        break;\n      }\n\n    default:\n      {\n        tokenInHead(p, token);\n      }\n  }\n}\n\nfunction endTagInHead(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HEAD:\n      {\n        p.openElements.pop();\n        p.insertionMode = InsertionMode.AFTER_HEAD;\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n    case html_js_1.TAG_ID.BR:\n    case html_js_1.TAG_ID.HTML:\n      {\n        tokenInHead(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    default:\n      {\n        p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n      }\n  }\n}\n\nfunction templateEndTagInHead(p, token) {\n  if (p.openElements.tmplCount > 0) {\n    p.openElements.generateImpliedEndTagsThoroughly();\n\n    if (p.openElements.currentTagId !== html_js_1.TAG_ID.TEMPLATE) {\n      p._err(token, error_codes_js_1.ERR.closingOfElementWithOpenChildElements);\n    }\n\n    p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.TEMPLATE);\n    p.activeFormattingElements.clearToLastMarker();\n    p.tmplInsertionModeStack.shift();\n\n    p._resetInsertionMode();\n  } else {\n    p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n  }\n}\n\nfunction tokenInHead(p, token) {\n  p.openElements.pop();\n  p.insertionMode = InsertionMode.AFTER_HEAD;\n\n  p._processToken(token);\n} // The \"in head no script\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInHeadNoScript(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BASEFONT:\n    case html_js_1.TAG_ID.BGSOUND:\n    case html_js_1.TAG_ID.HEAD:\n    case html_js_1.TAG_ID.LINK:\n    case html_js_1.TAG_ID.META:\n    case html_js_1.TAG_ID.NOFRAMES:\n    case html_js_1.TAG_ID.STYLE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOSCRIPT:\n      {\n        p._err(token, error_codes_js_1.ERR.nestedNoscriptInHead);\n\n        break;\n      }\n\n    default:\n      {\n        tokenInHeadNoScript(p, token);\n      }\n  }\n}\n\nfunction endTagInHeadNoScript(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.NOSCRIPT:\n      {\n        p.openElements.pop();\n        p.insertionMode = InsertionMode.IN_HEAD;\n        break;\n      }\n\n    case html_js_1.TAG_ID.BR:\n      {\n        tokenInHeadNoScript(p, token);\n        break;\n      }\n\n    default:\n      {\n        p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n      }\n  }\n}\n\nfunction tokenInHeadNoScript(p, token) {\n  const errCode = token.type === token_js_1.TokenType.EOF ? error_codes_js_1.ERR.openElementsLeftAfterEof : error_codes_js_1.ERR.disallowedContentInNoscriptInHead;\n\n  p._err(token, errCode);\n\n  p.openElements.pop();\n  p.insertionMode = InsertionMode.IN_HEAD;\n\n  p._processToken(token);\n} // The \"after head\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterHead(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n      {\n        p._insertElement(token, html_js_1.NS.HTML);\n\n        p.framesetOk = false;\n        p.insertionMode = InsertionMode.IN_BODY;\n        break;\n      }\n\n    case html_js_1.TAG_ID.FRAMESET:\n      {\n        p._insertElement(token, html_js_1.NS.HTML);\n\n        p.insertionMode = InsertionMode.IN_FRAMESET;\n        break;\n      }\n\n    case html_js_1.TAG_ID.BASE:\n    case html_js_1.TAG_ID.BASEFONT:\n    case html_js_1.TAG_ID.BGSOUND:\n    case html_js_1.TAG_ID.LINK:\n    case html_js_1.TAG_ID.META:\n    case html_js_1.TAG_ID.NOFRAMES:\n    case html_js_1.TAG_ID.SCRIPT:\n    case html_js_1.TAG_ID.STYLE:\n    case html_js_1.TAG_ID.TEMPLATE:\n    case html_js_1.TAG_ID.TITLE:\n      {\n        p._err(token, error_codes_js_1.ERR.abandonedHeadElementChild);\n\n        p.openElements.push(p.headElement, html_js_1.TAG_ID.HEAD);\n        startTagInHead(p, token);\n        p.openElements.remove(p.headElement);\n        break;\n      }\n\n    case html_js_1.TAG_ID.HEAD:\n      {\n        p._err(token, error_codes_js_1.ERR.misplacedStartTagForHeadElement);\n\n        break;\n      }\n\n    default:\n      {\n        tokenAfterHead(p, token);\n      }\n  }\n}\n\nfunction endTagAfterHead(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.BODY:\n    case html_js_1.TAG_ID.HTML:\n    case html_js_1.TAG_ID.BR:\n      {\n        tokenAfterHead(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    default:\n      {\n        p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n      }\n  }\n}\n\nfunction tokenAfterHead(p, token) {\n  p._insertFakeElement(html_js_1.TAG_NAMES.BODY, html_js_1.TAG_ID.BODY);\n\n  p.insertionMode = InsertionMode.IN_BODY;\n  modeInBody(p, token);\n} // The \"in body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction modeInBody(p, token) {\n  switch (token.type) {\n    case token_js_1.TokenType.CHARACTER:\n      {\n        characterInBody(p, token);\n        break;\n      }\n\n    case token_js_1.TokenType.WHITESPACE_CHARACTER:\n      {\n        whitespaceCharacterInBody(p, token);\n        break;\n      }\n\n    case token_js_1.TokenType.COMMENT:\n      {\n        appendComment(p, token);\n        break;\n      }\n\n    case token_js_1.TokenType.START_TAG:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case token_js_1.TokenType.END_TAG:\n      {\n        endTagInBody(p, token);\n        break;\n      }\n\n    case token_js_1.TokenType.EOF:\n      {\n        eofInBody(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n}\n\nfunction whitespaceCharacterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertCharacters(token);\n}\n\nfunction characterInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertCharacters(token);\n\n  p.framesetOk = false;\n}\n\nfunction htmlStartTagInBody(p, token) {\n  if (p.openElements.tmplCount === 0) {\n    p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n  }\n}\n\nfunction bodyStartTagInBody(p, token) {\n  const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n  if (bodyElement && p.openElements.tmplCount === 0) {\n    p.framesetOk = false;\n    p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n  }\n}\n\nfunction framesetStartTagInBody(p, token) {\n  const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n  if (p.framesetOk && bodyElement) {\n    p.treeAdapter.detachNode(bodyElement);\n    p.openElements.popAllUpToHtmlElement();\n\n    p._insertElement(token, html_js_1.NS.HTML);\n\n    p.insertionMode = InsertionMode.IN_FRAMESET;\n  }\n}\n\nfunction addressStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML);\n}\n\nfunction numberedHeaderStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._closePElement();\n  }\n\n  if ((0, html_js_1.isNumberedHeader)(p.openElements.currentTagId)) {\n    p.openElements.pop();\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML);\n}\n\nfunction preStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML); //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n\n\n  p.skipNextNewLine = true;\n  p.framesetOk = false;\n}\n\nfunction formStartTagInBody(p, token) {\n  const inTemplate = p.openElements.tmplCount > 0;\n\n  if (!p.formElement || inTemplate) {\n    if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n      p._closePElement();\n    }\n\n    p._insertElement(token, html_js_1.NS.HTML);\n\n    if (!inTemplate) {\n      p.formElement = p.openElements.current;\n    }\n  }\n}\n\nfunction listItemStartTagInBody(p, token) {\n  p.framesetOk = false;\n  const tn = token.tagID;\n\n  for (let i = p.openElements.stackTop; i >= 0; i--) {\n    const elementId = p.openElements.tagIDs[i];\n\n    if (tn === html_js_1.TAG_ID.LI && elementId === html_js_1.TAG_ID.LI || (tn === html_js_1.TAG_ID.DD || tn === html_js_1.TAG_ID.DT) && (elementId === html_js_1.TAG_ID.DD || elementId === html_js_1.TAG_ID.DT)) {\n      p.openElements.generateImpliedEndTagsWithExclusion(elementId);\n      p.openElements.popUntilTagNamePopped(elementId);\n      break;\n    }\n\n    if (elementId !== html_js_1.TAG_ID.ADDRESS && elementId !== html_js_1.TAG_ID.DIV && elementId !== html_js_1.TAG_ID.P && p._isSpecialElement(p.openElements.items[i], elementId)) {\n      break;\n    }\n  }\n\n  if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML);\n}\n\nfunction plaintextStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.tokenizer.state = index_js_1.TokenizerMode.PLAINTEXT;\n}\n\nfunction buttonStartTagInBody(p, token) {\n  if (p.openElements.hasInScope(html_js_1.TAG_ID.BUTTON)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.BUTTON);\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.framesetOk = false;\n}\n\nfunction aStartTagInBody(p, token) {\n  const activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(html_js_1.TAG_NAMES.A);\n\n  if (activeElementEntry) {\n    callAdoptionAgency(p, token);\n    p.openElements.remove(activeElementEntry.element);\n    p.activeFormattingElements.removeEntry(activeElementEntry);\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction bStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction nobrStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  if (p.openElements.hasInScope(html_js_1.TAG_ID.NOBR)) {\n    callAdoptionAgency(p, token);\n\n    p._reconstructActiveFormattingElements();\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\n\nfunction appletStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.activeFormattingElements.insertMarker();\n  p.framesetOk = false;\n}\n\nfunction tableStartTagInBody(p, token) {\n  if (p.treeAdapter.getDocumentMode(p.document) !== html_js_1.DOCUMENT_MODE.QUIRKS && p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._closePElement();\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.framesetOk = false;\n  p.insertionMode = InsertionMode.IN_TABLE;\n}\n\nfunction areaStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._appendElement(token, html_js_1.NS.HTML);\n\n  p.framesetOk = false;\n  token.ackSelfClosing = true;\n}\n\nfunction isHiddenInput(token) {\n  const inputType = (0, token_js_1.getTokenAttr)(token, html_js_1.ATTRS.TYPE);\n  return inputType != null && inputType.toLowerCase() === HIDDEN_INPUT_TYPE;\n}\n\nfunction inputStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._appendElement(token, html_js_1.NS.HTML);\n\n  if (!isHiddenInput(token)) {\n    p.framesetOk = false;\n  }\n\n  token.ackSelfClosing = true;\n}\n\nfunction paramStartTagInBody(p, token) {\n  p._appendElement(token, html_js_1.NS.HTML);\n\n  token.ackSelfClosing = true;\n}\n\nfunction hrStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._closePElement();\n  }\n\n  p._appendElement(token, html_js_1.NS.HTML);\n\n  p.framesetOk = false;\n  token.ackSelfClosing = true;\n}\n\nfunction imageStartTagInBody(p, token) {\n  token.tagName = html_js_1.TAG_NAMES.IMG;\n  token.tagID = html_js_1.TAG_ID.IMG;\n  areaStartTagInBody(p, token);\n}\n\nfunction textareaStartTagInBody(p, token) {\n  p._insertElement(token, html_js_1.NS.HTML); //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n  //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n\n\n  p.skipNextNewLine = true;\n  p.tokenizer.state = index_js_1.TokenizerMode.RCDATA;\n  p.originalInsertionMode = p.insertionMode;\n  p.framesetOk = false;\n  p.insertionMode = InsertionMode.TEXT;\n}\n\nfunction xmpStartTagInBody(p, token) {\n  if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._closePElement();\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p.framesetOk = false;\n\n  p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n}\n\nfunction iframeStartTagInBody(p, token) {\n  p.framesetOk = false;\n\n  p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n} //NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\n//<noembed> as rawtext.\n\n\nfunction noembedStartTagInBody(p, token) {\n  p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n}\n\nfunction selectStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.framesetOk = false;\n  p.insertionMode = p.insertionMode === InsertionMode.IN_TABLE || p.insertionMode === InsertionMode.IN_CAPTION || p.insertionMode === InsertionMode.IN_TABLE_BODY || p.insertionMode === InsertionMode.IN_ROW || p.insertionMode === InsertionMode.IN_CELL ? InsertionMode.IN_SELECT_IN_TABLE : InsertionMode.IN_SELECT;\n}\n\nfunction optgroupStartTagInBody(p, token) {\n  if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTION) {\n    p.openElements.pop();\n  }\n\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n}\n\nfunction rbStartTagInBody(p, token) {\n  if (p.openElements.hasInScope(html_js_1.TAG_ID.RUBY)) {\n    p.openElements.generateImpliedEndTags();\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML);\n}\n\nfunction rtStartTagInBody(p, token) {\n  if (p.openElements.hasInScope(html_js_1.TAG_ID.RUBY)) {\n    p.openElements.generateImpliedEndTagsWithExclusion(html_js_1.TAG_ID.RTC);\n  }\n\n  p._insertElement(token, html_js_1.NS.HTML);\n}\n\nfunction mathStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  foreignContent.adjustTokenMathMLAttrs(token);\n  foreignContent.adjustTokenXMLAttrs(token);\n\n  if (token.selfClosing) {\n    p._appendElement(token, html_js_1.NS.MATHML);\n  } else {\n    p._insertElement(token, html_js_1.NS.MATHML);\n  }\n\n  token.ackSelfClosing = true;\n}\n\nfunction svgStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  foreignContent.adjustTokenSVGAttrs(token);\n  foreignContent.adjustTokenXMLAttrs(token);\n\n  if (token.selfClosing) {\n    p._appendElement(token, html_js_1.NS.SVG);\n  } else {\n    p._insertElement(token, html_js_1.NS.SVG);\n  }\n\n  token.ackSelfClosing = true;\n}\n\nfunction genericStartTagInBody(p, token) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n}\n\nfunction startTagInBody(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.I:\n    case html_js_1.TAG_ID.S:\n    case html_js_1.TAG_ID.B:\n    case html_js_1.TAG_ID.U:\n    case html_js_1.TAG_ID.EM:\n    case html_js_1.TAG_ID.TT:\n    case html_js_1.TAG_ID.BIG:\n    case html_js_1.TAG_ID.CODE:\n    case html_js_1.TAG_ID.FONT:\n    case html_js_1.TAG_ID.SMALL:\n    case html_js_1.TAG_ID.STRIKE:\n    case html_js_1.TAG_ID.STRONG:\n      {\n        bStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.A:\n      {\n        aStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.H1:\n    case html_js_1.TAG_ID.H2:\n    case html_js_1.TAG_ID.H3:\n    case html_js_1.TAG_ID.H4:\n    case html_js_1.TAG_ID.H5:\n    case html_js_1.TAG_ID.H6:\n      {\n        numberedHeaderStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.P:\n    case html_js_1.TAG_ID.DL:\n    case html_js_1.TAG_ID.OL:\n    case html_js_1.TAG_ID.UL:\n    case html_js_1.TAG_ID.DIV:\n    case html_js_1.TAG_ID.DIR:\n    case html_js_1.TAG_ID.NAV:\n    case html_js_1.TAG_ID.MAIN:\n    case html_js_1.TAG_ID.MENU:\n    case html_js_1.TAG_ID.ASIDE:\n    case html_js_1.TAG_ID.CENTER:\n    case html_js_1.TAG_ID.FIGURE:\n    case html_js_1.TAG_ID.FOOTER:\n    case html_js_1.TAG_ID.HEADER:\n    case html_js_1.TAG_ID.HGROUP:\n    case html_js_1.TAG_ID.DIALOG:\n    case html_js_1.TAG_ID.DETAILS:\n    case html_js_1.TAG_ID.ADDRESS:\n    case html_js_1.TAG_ID.ARTICLE:\n    case html_js_1.TAG_ID.SECTION:\n    case html_js_1.TAG_ID.SUMMARY:\n    case html_js_1.TAG_ID.FIELDSET:\n    case html_js_1.TAG_ID.BLOCKQUOTE:\n    case html_js_1.TAG_ID.FIGCAPTION:\n      {\n        addressStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.LI:\n    case html_js_1.TAG_ID.DD:\n    case html_js_1.TAG_ID.DT:\n      {\n        listItemStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BR:\n    case html_js_1.TAG_ID.IMG:\n    case html_js_1.TAG_ID.WBR:\n    case html_js_1.TAG_ID.AREA:\n    case html_js_1.TAG_ID.EMBED:\n    case html_js_1.TAG_ID.KEYGEN:\n      {\n        areaStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.HR:\n      {\n        hrStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.RB:\n    case html_js_1.TAG_ID.RTC:\n      {\n        rbStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.RT:\n    case html_js_1.TAG_ID.RP:\n      {\n        rtStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.PRE:\n    case html_js_1.TAG_ID.LISTING:\n      {\n        preStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.XMP:\n      {\n        xmpStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.SVG:\n      {\n        svgStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.HTML:\n      {\n        htmlStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BASE:\n    case html_js_1.TAG_ID.LINK:\n    case html_js_1.TAG_ID.META:\n    case html_js_1.TAG_ID.STYLE:\n    case html_js_1.TAG_ID.TITLE:\n    case html_js_1.TAG_ID.SCRIPT:\n    case html_js_1.TAG_ID.BGSOUND:\n    case html_js_1.TAG_ID.BASEFONT:\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n      {\n        bodyStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.FORM:\n      {\n        formStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOBR:\n      {\n        nobrStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.MATH:\n      {\n        mathStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.TABLE:\n      {\n        tableStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.INPUT:\n      {\n        inputStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.PARAM:\n    case html_js_1.TAG_ID.TRACK:\n    case html_js_1.TAG_ID.SOURCE:\n      {\n        paramStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.IMAGE:\n      {\n        imageStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BUTTON:\n      {\n        buttonStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.APPLET:\n    case html_js_1.TAG_ID.OBJECT:\n    case html_js_1.TAG_ID.MARQUEE:\n      {\n        appletStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.IFRAME:\n      {\n        iframeStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.SELECT:\n      {\n        selectStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.OPTION:\n    case html_js_1.TAG_ID.OPTGROUP:\n      {\n        optgroupStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOEMBED:\n      {\n        noembedStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.FRAMESET:\n      {\n        framesetStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEXTAREA:\n      {\n        textareaStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOSCRIPT:\n      {\n        if (p.options.scriptingEnabled) {\n          noembedStartTagInBody(p, token);\n        } else {\n          genericStartTagInBody(p, token);\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.PLAINTEXT:\n      {\n        plaintextStartTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.COL:\n    case html_js_1.TAG_ID.TH:\n    case html_js_1.TAG_ID.TD:\n    case html_js_1.TAG_ID.TR:\n    case html_js_1.TAG_ID.HEAD:\n    case html_js_1.TAG_ID.FRAME:\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.THEAD:\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.COLGROUP:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        genericStartTagInBody(p, token);\n      }\n  }\n}\n\nfunction bodyEndTagInBody(p, token) {\n  if (p.openElements.hasInScope(html_js_1.TAG_ID.BODY)) {\n    p.insertionMode = InsertionMode.AFTER_BODY; //NOTE: <body> is never popped from the stack, so we need to updated\n    //the end location explicitly.\n\n    if (p.options.sourceCodeLocationInfo) {\n      const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n\n      if (bodyElement) {\n        p._setEndLocation(bodyElement, token);\n      }\n    }\n  }\n}\n\nfunction htmlEndTagInBody(p, token) {\n  if (p.openElements.hasInScope(html_js_1.TAG_ID.BODY)) {\n    p.insertionMode = InsertionMode.AFTER_BODY;\n    endTagAfterBody(p, token);\n  }\n}\n\nfunction addressEndTagInBody(p, token) {\n  const tn = token.tagID;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\n\nfunction formEndTagInBody(p) {\n  const inTemplate = p.openElements.tmplCount > 0;\n  const {\n    formElement\n  } = p;\n\n  if (!inTemplate) {\n    p.formElement = null;\n  }\n\n  if ((formElement || inTemplate) && p.openElements.hasInScope(html_js_1.TAG_ID.FORM)) {\n    p.openElements.generateImpliedEndTags();\n\n    if (inTemplate) {\n      p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.FORM);\n    } else if (formElement) {\n      p.openElements.remove(formElement);\n    }\n  }\n}\n\nfunction pEndTagInBody(p) {\n  if (!p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n    p._insertFakeElement(html_js_1.TAG_NAMES.P, html_js_1.TAG_ID.P);\n  }\n\n  p._closePElement();\n}\n\nfunction liEndTagInBody(p) {\n  if (p.openElements.hasInListItemScope(html_js_1.TAG_ID.LI)) {\n    p.openElements.generateImpliedEndTagsWithExclusion(html_js_1.TAG_ID.LI);\n    p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.LI);\n  }\n}\n\nfunction ddEndTagInBody(p, token) {\n  const tn = token.tagID;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTagsWithExclusion(tn);\n    p.openElements.popUntilTagNamePopped(tn);\n  }\n}\n\nfunction numberedHeaderEndTagInBody(p) {\n  if (p.openElements.hasNumberedHeaderInScope()) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilNumberedHeaderPopped();\n  }\n}\n\nfunction appletEndTagInBody(p, token) {\n  const tn = token.tagID;\n\n  if (p.openElements.hasInScope(tn)) {\n    p.openElements.generateImpliedEndTags();\n    p.openElements.popUntilTagNamePopped(tn);\n    p.activeFormattingElements.clearToLastMarker();\n  }\n}\n\nfunction brEndTagInBody(p) {\n  p._reconstructActiveFormattingElements();\n\n  p._insertFakeElement(html_js_1.TAG_NAMES.BR, html_js_1.TAG_ID.BR);\n\n  p.openElements.pop();\n  p.framesetOk = false;\n}\n\nfunction genericEndTagInBody(p, token) {\n  const tn = token.tagName;\n  const tid = token.tagID;\n\n  for (let i = p.openElements.stackTop; i > 0; i--) {\n    const element = p.openElements.items[i];\n    const elementId = p.openElements.tagIDs[i]; // Compare the tag name here, as the tag might not be a known tag with an ID.\n\n    if (tid === elementId && (tid !== html_js_1.TAG_ID.UNKNOWN || p.treeAdapter.getTagName(element) === tn)) {\n      p.openElements.generateImpliedEndTagsWithExclusion(tid);\n      if (p.openElements.stackTop >= i) p.openElements.shortenToLength(i);\n      break;\n    }\n\n    if (p._isSpecialElement(element, elementId)) {\n      break;\n    }\n  }\n}\n\nfunction endTagInBody(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.A:\n    case html_js_1.TAG_ID.B:\n    case html_js_1.TAG_ID.I:\n    case html_js_1.TAG_ID.S:\n    case html_js_1.TAG_ID.U:\n    case html_js_1.TAG_ID.EM:\n    case html_js_1.TAG_ID.TT:\n    case html_js_1.TAG_ID.BIG:\n    case html_js_1.TAG_ID.CODE:\n    case html_js_1.TAG_ID.FONT:\n    case html_js_1.TAG_ID.NOBR:\n    case html_js_1.TAG_ID.SMALL:\n    case html_js_1.TAG_ID.STRIKE:\n    case html_js_1.TAG_ID.STRONG:\n      {\n        callAdoptionAgency(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.P:\n      {\n        pEndTagInBody(p);\n        break;\n      }\n\n    case html_js_1.TAG_ID.DL:\n    case html_js_1.TAG_ID.UL:\n    case html_js_1.TAG_ID.OL:\n    case html_js_1.TAG_ID.DIR:\n    case html_js_1.TAG_ID.DIV:\n    case html_js_1.TAG_ID.NAV:\n    case html_js_1.TAG_ID.PRE:\n    case html_js_1.TAG_ID.MAIN:\n    case html_js_1.TAG_ID.MENU:\n    case html_js_1.TAG_ID.ASIDE:\n    case html_js_1.TAG_ID.BUTTON:\n    case html_js_1.TAG_ID.CENTER:\n    case html_js_1.TAG_ID.FIGURE:\n    case html_js_1.TAG_ID.FOOTER:\n    case html_js_1.TAG_ID.HEADER:\n    case html_js_1.TAG_ID.HGROUP:\n    case html_js_1.TAG_ID.DIALOG:\n    case html_js_1.TAG_ID.ADDRESS:\n    case html_js_1.TAG_ID.ARTICLE:\n    case html_js_1.TAG_ID.DETAILS:\n    case html_js_1.TAG_ID.SECTION:\n    case html_js_1.TAG_ID.SUMMARY:\n    case html_js_1.TAG_ID.LISTING:\n    case html_js_1.TAG_ID.FIELDSET:\n    case html_js_1.TAG_ID.BLOCKQUOTE:\n    case html_js_1.TAG_ID.FIGCAPTION:\n      {\n        addressEndTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.LI:\n      {\n        liEndTagInBody(p);\n        break;\n      }\n\n    case html_js_1.TAG_ID.DD:\n    case html_js_1.TAG_ID.DT:\n      {\n        ddEndTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.H1:\n    case html_js_1.TAG_ID.H2:\n    case html_js_1.TAG_ID.H3:\n    case html_js_1.TAG_ID.H4:\n    case html_js_1.TAG_ID.H5:\n    case html_js_1.TAG_ID.H6:\n      {\n        numberedHeaderEndTagInBody(p);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BR:\n      {\n        brEndTagInBody(p);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n      {\n        bodyEndTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.HTML:\n      {\n        htmlEndTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.FORM:\n      {\n        formEndTagInBody(p);\n        break;\n      }\n\n    case html_js_1.TAG_ID.APPLET:\n    case html_js_1.TAG_ID.OBJECT:\n    case html_js_1.TAG_ID.MARQUEE:\n      {\n        appletEndTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    default:\n      {\n        genericEndTagInBody(p, token);\n      }\n  }\n}\n\nfunction eofInBody(p, token) {\n  if (p.tmplInsertionModeStack.length > 0) {\n    eofInTemplate(p, token);\n  } else {\n    stopParsing(p, token);\n  }\n} // The \"text\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction endTagInText(p, token) {\n  var _a;\n\n  if (token.tagID === html_js_1.TAG_ID.SCRIPT) {\n    (_a = p.scriptHandler) === null || _a === void 0 ? void 0 : _a.call(p, p.openElements.current);\n  }\n\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n}\n\nfunction eofInText(p, token) {\n  p._err(token, error_codes_js_1.ERR.eofInElementThatCanContainOnlyText);\n\n  p.openElements.pop();\n  p.insertionMode = p.originalInsertionMode;\n  p.onEof(token);\n} // The \"in table\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction characterInTable(p, token) {\n  if (TABLE_STRUCTURE_TAGS.has(p.openElements.currentTagId)) {\n    p.pendingCharacterTokens.length = 0;\n    p.hasNonWhitespacePendingCharacterToken = false;\n    p.originalInsertionMode = p.insertionMode;\n    p.insertionMode = InsertionMode.IN_TABLE_TEXT;\n\n    switch (token.type) {\n      case token_js_1.TokenType.CHARACTER:\n        {\n          characterInTableText(p, token);\n          break;\n        }\n\n      case token_js_1.TokenType.WHITESPACE_CHARACTER:\n        {\n          whitespaceCharacterInTableText(p, token);\n          break;\n        }\n      // Ignore null\n    }\n  } else {\n    tokenInTable(p, token);\n  }\n}\n\nfunction captionStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n  p.activeFormattingElements.insertMarker();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.insertionMode = InsertionMode.IN_CAPTION;\n}\n\nfunction colgroupStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n}\n\nfunction colStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertFakeElement(html_js_1.TAG_NAMES.COLGROUP, html_js_1.TAG_ID.COLGROUP);\n\n  p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n  startTagInColumnGroup(p, token);\n}\n\nfunction tbodyStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertElement(token, html_js_1.NS.HTML);\n\n  p.insertionMode = InsertionMode.IN_TABLE_BODY;\n}\n\nfunction tdStartTagInTable(p, token) {\n  p.openElements.clearBackToTableContext();\n\n  p._insertFakeElement(html_js_1.TAG_NAMES.TBODY, html_js_1.TAG_ID.TBODY);\n\n  p.insertionMode = InsertionMode.IN_TABLE_BODY;\n  startTagInTableBody(p, token);\n}\n\nfunction tableStartTagInTable(p, token) {\n  if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TABLE)) {\n    p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.TABLE);\n\n    p._resetInsertionMode();\n\n    p._processStartTag(token);\n  }\n}\n\nfunction inputStartTagInTable(p, token) {\n  if (isHiddenInput(token)) {\n    p._appendElement(token, html_js_1.NS.HTML);\n  } else {\n    tokenInTable(p, token);\n  }\n\n  token.ackSelfClosing = true;\n}\n\nfunction formStartTagInTable(p, token) {\n  if (!p.formElement && p.openElements.tmplCount === 0) {\n    p._insertElement(token, html_js_1.NS.HTML);\n\n    p.formElement = p.openElements.current;\n    p.openElements.pop();\n  }\n}\n\nfunction startTagInTable(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.TD:\n    case html_js_1.TAG_ID.TH:\n    case html_js_1.TAG_ID.TR:\n      {\n        tdStartTagInTable(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.STYLE:\n    case html_js_1.TAG_ID.SCRIPT:\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.COL:\n      {\n        colStartTagInTable(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.FORM:\n      {\n        formStartTagInTable(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.TABLE:\n      {\n        tableStartTagInTable(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.THEAD:\n      {\n        tbodyStartTagInTable(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.INPUT:\n      {\n        inputStartTagInTable(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.CAPTION:\n      {\n        captionStartTagInTable(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.COLGROUP:\n      {\n        colgroupStartTagInTable(p, token);\n        break;\n      }\n\n    default:\n      {\n        tokenInTable(p, token);\n      }\n  }\n}\n\nfunction endTagInTable(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.TABLE:\n      {\n        if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TABLE)) {\n          p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.TABLE);\n\n          p._resetInsertionMode();\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.COL:\n    case html_js_1.TAG_ID.COLGROUP:\n    case html_js_1.TAG_ID.HTML:\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TD:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.TH:\n    case html_js_1.TAG_ID.THEAD:\n    case html_js_1.TAG_ID.TR:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        tokenInTable(p, token);\n      }\n  }\n}\n\nfunction tokenInTable(p, token) {\n  const savedFosterParentingState = p.fosterParentingEnabled;\n  p.fosterParentingEnabled = true; // Process token in `In Body` mode\n\n  modeInBody(p, token);\n  p.fosterParentingEnabled = savedFosterParentingState;\n} // The \"in table text\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction whitespaceCharacterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n}\n\nfunction characterInTableText(p, token) {\n  p.pendingCharacterTokens.push(token);\n  p.hasNonWhitespacePendingCharacterToken = true;\n}\n\nfunction tokenInTableText(p, token) {\n  let i = 0;\n\n  if (p.hasNonWhitespacePendingCharacterToken) {\n    for (; i < p.pendingCharacterTokens.length; i++) {\n      tokenInTable(p, p.pendingCharacterTokens[i]);\n    }\n  } else {\n    for (; i < p.pendingCharacterTokens.length; i++) {\n      p._insertCharacters(p.pendingCharacterTokens[i]);\n    }\n  }\n\n  p.insertionMode = p.originalInsertionMode;\n\n  p._processToken(token);\n} // The \"in caption\" insertion mode\n//------------------------------------------------------------------\n\n\nconst TABLE_VOID_ELEMENTS = new Set([html_js_1.TAG_ID.CAPTION, html_js_1.TAG_ID.COL, html_js_1.TAG_ID.COLGROUP, html_js_1.TAG_ID.TBODY, html_js_1.TAG_ID.TD, html_js_1.TAG_ID.TFOOT, html_js_1.TAG_ID.TH, html_js_1.TAG_ID.THEAD, html_js_1.TAG_ID.TR]);\n\nfunction startTagInCaption(p, token) {\n  const tn = token.tagID;\n\n  if (TABLE_VOID_ELEMENTS.has(tn)) {\n    if (p.openElements.hasInTableScope(html_js_1.TAG_ID.CAPTION)) {\n      p.openElements.generateImpliedEndTags();\n      p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.CAPTION);\n      p.activeFormattingElements.clearToLastMarker();\n      p.insertionMode = InsertionMode.IN_TABLE;\n      startTagInTable(p, token);\n    }\n  } else {\n    startTagInBody(p, token);\n  }\n}\n\nfunction endTagInCaption(p, token) {\n  const tn = token.tagID;\n\n  switch (tn) {\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.TABLE:\n      {\n        if (p.openElements.hasInTableScope(html_js_1.TAG_ID.CAPTION)) {\n          p.openElements.generateImpliedEndTags();\n          p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.CAPTION);\n          p.activeFormattingElements.clearToLastMarker();\n          p.insertionMode = InsertionMode.IN_TABLE;\n\n          if (tn === html_js_1.TAG_ID.TABLE) {\n            endTagInTable(p, token);\n          }\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n    case html_js_1.TAG_ID.COL:\n    case html_js_1.TAG_ID.COLGROUP:\n    case html_js_1.TAG_ID.HTML:\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TD:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.TH:\n    case html_js_1.TAG_ID.THEAD:\n    case html_js_1.TAG_ID.TR:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        endTagInBody(p, token);\n      }\n  }\n} // The \"in column group\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInColumnGroup(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.COL:\n      {\n        p._appendElement(token, html_js_1.NS.HTML);\n\n        token.ackSelfClosing = true;\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default:\n      {\n        tokenInColumnGroup(p, token);\n      }\n  }\n}\n\nfunction endTagInColumnGroup(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.COLGROUP:\n      {\n        if (p.openElements.currentTagId === html_js_1.TAG_ID.COLGROUP) {\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE;\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.COL:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        tokenInColumnGroup(p, token);\n      }\n  }\n}\n\nfunction tokenInColumnGroup(p, token) {\n  if (p.openElements.currentTagId === html_js_1.TAG_ID.COLGROUP) {\n    p.openElements.pop();\n    p.insertionMode = InsertionMode.IN_TABLE;\n\n    p._processToken(token);\n  }\n} // The \"in table body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInTableBody(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.TR:\n      {\n        p.openElements.clearBackToTableBodyContext();\n\n        p._insertElement(token, html_js_1.NS.HTML);\n\n        p.insertionMode = InsertionMode.IN_ROW;\n        break;\n      }\n\n    case html_js_1.TAG_ID.TH:\n    case html_js_1.TAG_ID.TD:\n      {\n        p.openElements.clearBackToTableBodyContext();\n\n        p._insertFakeElement(html_js_1.TAG_NAMES.TR, html_js_1.TAG_ID.TR);\n\n        p.insertionMode = InsertionMode.IN_ROW;\n        startTagInRow(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.COL:\n    case html_js_1.TAG_ID.COLGROUP:\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.THEAD:\n      {\n        if (p.openElements.hasTableBodyContextInTableScope()) {\n          p.openElements.clearBackToTableBodyContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE;\n          startTagInTable(p, token);\n        }\n\n        break;\n      }\n\n    default:\n      {\n        startTagInTable(p, token);\n      }\n  }\n}\n\nfunction endTagInTableBody(p, token) {\n  const tn = token.tagID;\n\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.THEAD:\n      {\n        if (p.openElements.hasInTableScope(tn)) {\n          p.openElements.clearBackToTableBodyContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE;\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.TABLE:\n      {\n        if (p.openElements.hasTableBodyContextInTableScope()) {\n          p.openElements.clearBackToTableBodyContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE;\n          endTagInTable(p, token);\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.COL:\n    case html_js_1.TAG_ID.COLGROUP:\n    case html_js_1.TAG_ID.HTML:\n    case html_js_1.TAG_ID.TD:\n    case html_js_1.TAG_ID.TH:\n    case html_js_1.TAG_ID.TR:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        endTagInTable(p, token);\n      }\n  }\n} // The \"in row\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInRow(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.TH:\n    case html_js_1.TAG_ID.TD:\n      {\n        p.openElements.clearBackToTableRowContext();\n\n        p._insertElement(token, html_js_1.NS.HTML);\n\n        p.insertionMode = InsertionMode.IN_CELL;\n        p.activeFormattingElements.insertMarker();\n        break;\n      }\n\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.COL:\n    case html_js_1.TAG_ID.COLGROUP:\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.THEAD:\n    case html_js_1.TAG_ID.TR:\n      {\n        if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TR)) {\n          p.openElements.clearBackToTableRowContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE_BODY;\n          startTagInTableBody(p, token);\n        }\n\n        break;\n      }\n\n    default:\n      {\n        startTagInTable(p, token);\n      }\n  }\n}\n\nfunction endTagInRow(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.TR:\n      {\n        if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TR)) {\n          p.openElements.clearBackToTableRowContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE_BODY;\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.TABLE:\n      {\n        if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TR)) {\n          p.openElements.clearBackToTableRowContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE_BODY;\n          endTagInTableBody(p, token);\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.THEAD:\n      {\n        if (p.openElements.hasInTableScope(token.tagID) || p.openElements.hasInTableScope(html_js_1.TAG_ID.TR)) {\n          p.openElements.clearBackToTableRowContext();\n          p.openElements.pop();\n          p.insertionMode = InsertionMode.IN_TABLE_BODY;\n          endTagInTableBody(p, token);\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.COL:\n    case html_js_1.TAG_ID.COLGROUP:\n    case html_js_1.TAG_ID.HTML:\n    case html_js_1.TAG_ID.TD:\n    case html_js_1.TAG_ID.TH:\n      {\n        // Ignore end tag\n        break;\n      }\n\n    default:\n      endTagInTable(p, token);\n  }\n} // The \"in cell\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInCell(p, token) {\n  const tn = token.tagID;\n\n  if (TABLE_VOID_ELEMENTS.has(tn)) {\n    if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TD) || p.openElements.hasInTableScope(html_js_1.TAG_ID.TH)) {\n      p._closeTableCell();\n\n      startTagInRow(p, token);\n    }\n  } else {\n    startTagInBody(p, token);\n  }\n}\n\nfunction endTagInCell(p, token) {\n  const tn = token.tagID;\n\n  switch (tn) {\n    case html_js_1.TAG_ID.TD:\n    case html_js_1.TAG_ID.TH:\n      {\n        if (p.openElements.hasInTableScope(tn)) {\n          p.openElements.generateImpliedEndTags();\n          p.openElements.popUntilTagNamePopped(tn);\n          p.activeFormattingElements.clearToLastMarker();\n          p.insertionMode = InsertionMode.IN_ROW;\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.TABLE:\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.THEAD:\n    case html_js_1.TAG_ID.TR:\n      {\n        if (p.openElements.hasInTableScope(tn)) {\n          p._closeTableCell();\n\n          endTagInRow(p, token);\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.BODY:\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.COL:\n    case html_js_1.TAG_ID.COLGROUP:\n    case html_js_1.TAG_ID.HTML:\n      {\n        // Ignore token\n        break;\n      }\n\n    default:\n      {\n        endTagInBody(p, token);\n      }\n  }\n} // The \"in select\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInSelect(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.OPTION:\n      {\n        if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTION) {\n          p.openElements.pop();\n        }\n\n        p._insertElement(token, html_js_1.NS.HTML);\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.OPTGROUP:\n      {\n        if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTION) {\n          p.openElements.pop();\n        }\n\n        if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTGROUP) {\n          p.openElements.pop();\n        }\n\n        p._insertElement(token, html_js_1.NS.HTML);\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.INPUT:\n    case html_js_1.TAG_ID.KEYGEN:\n    case html_js_1.TAG_ID.TEXTAREA:\n    case html_js_1.TAG_ID.SELECT:\n      {\n        if (p.openElements.hasInSelectScope(html_js_1.TAG_ID.SELECT)) {\n          p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.SELECT);\n\n          p._resetInsertionMode();\n\n          if (token.tagID !== html_js_1.TAG_ID.SELECT) {\n            p._processStartTag(token);\n          }\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.SCRIPT:\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n}\n\nfunction endTagInSelect(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.OPTGROUP:\n      {\n        if (p.openElements.stackTop > 0 && p.openElements.currentTagId === html_js_1.TAG_ID.OPTION && p.openElements.tagIDs[p.openElements.stackTop - 1] === html_js_1.TAG_ID.OPTGROUP) {\n          p.openElements.pop();\n        }\n\n        if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTGROUP) {\n          p.openElements.pop();\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.OPTION:\n      {\n        if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTION) {\n          p.openElements.pop();\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.SELECT:\n      {\n        if (p.openElements.hasInSelectScope(html_js_1.TAG_ID.SELECT)) {\n          p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.SELECT);\n\n          p._resetInsertionMode();\n        }\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.TEMPLATE:\n      {\n        templateEndTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n} // The \"in select in table\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInSelectInTable(p, token) {\n  const tn = token.tagID;\n\n  if (tn === html_js_1.TAG_ID.CAPTION || tn === html_js_1.TAG_ID.TABLE || tn === html_js_1.TAG_ID.TBODY || tn === html_js_1.TAG_ID.TFOOT || tn === html_js_1.TAG_ID.THEAD || tn === html_js_1.TAG_ID.TR || tn === html_js_1.TAG_ID.TD || tn === html_js_1.TAG_ID.TH) {\n    p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.SELECT);\n\n    p._resetInsertionMode();\n\n    p._processStartTag(token);\n  } else {\n    startTagInSelect(p, token);\n  }\n}\n\nfunction endTagInSelectInTable(p, token) {\n  const tn = token.tagID;\n\n  if (tn === html_js_1.TAG_ID.CAPTION || tn === html_js_1.TAG_ID.TABLE || tn === html_js_1.TAG_ID.TBODY || tn === html_js_1.TAG_ID.TFOOT || tn === html_js_1.TAG_ID.THEAD || tn === html_js_1.TAG_ID.TR || tn === html_js_1.TAG_ID.TD || tn === html_js_1.TAG_ID.TH) {\n    if (p.openElements.hasInTableScope(tn)) {\n      p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.SELECT);\n\n      p._resetInsertionMode();\n\n      p.onEndTag(token);\n    }\n  } else {\n    endTagInSelect(p, token);\n  }\n} // The \"in template\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInTemplate(p, token) {\n  switch (token.tagID) {\n    // First, handle tags that can start without a mode change\n    case html_js_1.TAG_ID.BASE:\n    case html_js_1.TAG_ID.BASEFONT:\n    case html_js_1.TAG_ID.BGSOUND:\n    case html_js_1.TAG_ID.LINK:\n    case html_js_1.TAG_ID.META:\n    case html_js_1.TAG_ID.NOFRAMES:\n    case html_js_1.TAG_ID.SCRIPT:\n    case html_js_1.TAG_ID.STYLE:\n    case html_js_1.TAG_ID.TEMPLATE:\n    case html_js_1.TAG_ID.TITLE:\n      startTagInHead(p, token);\n      break;\n    // Re-process the token in the appropriate mode\n\n    case html_js_1.TAG_ID.CAPTION:\n    case html_js_1.TAG_ID.COLGROUP:\n    case html_js_1.TAG_ID.TBODY:\n    case html_js_1.TAG_ID.TFOOT:\n    case html_js_1.TAG_ID.THEAD:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE;\n      p.insertionMode = InsertionMode.IN_TABLE;\n      startTagInTable(p, token);\n      break;\n\n    case html_js_1.TAG_ID.COL:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_COLUMN_GROUP;\n      p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n      startTagInColumnGroup(p, token);\n      break;\n\n    case html_js_1.TAG_ID.TR:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE_BODY;\n      p.insertionMode = InsertionMode.IN_TABLE_BODY;\n      startTagInTableBody(p, token);\n      break;\n\n    case html_js_1.TAG_ID.TD:\n    case html_js_1.TAG_ID.TH:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_ROW;\n      p.insertionMode = InsertionMode.IN_ROW;\n      startTagInRow(p, token);\n      break;\n\n    default:\n      p.tmplInsertionModeStack[0] = InsertionMode.IN_BODY;\n      p.insertionMode = InsertionMode.IN_BODY;\n      startTagInBody(p, token);\n  }\n}\n\nfunction endTagInTemplate(p, token) {\n  if (token.tagID === html_js_1.TAG_ID.TEMPLATE) {\n    templateEndTagInHead(p, token);\n  }\n}\n\nfunction eofInTemplate(p, token) {\n  if (p.openElements.tmplCount > 0) {\n    p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.TEMPLATE);\n    p.activeFormattingElements.clearToLastMarker();\n    p.tmplInsertionModeStack.shift();\n\n    p._resetInsertionMode();\n\n    p.onEof(token);\n  } else {\n    stopParsing(p, token);\n  }\n} // The \"after body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterBody(p, token) {\n  if (token.tagID === html_js_1.TAG_ID.HTML) {\n    startTagInBody(p, token);\n  } else {\n    tokenAfterBody(p, token);\n  }\n}\n\nfunction endTagAfterBody(p, token) {\n  var _a;\n\n  if (token.tagID === html_js_1.TAG_ID.HTML) {\n    if (!p.fragmentContext) {\n      p.insertionMode = InsertionMode.AFTER_AFTER_BODY;\n    } //NOTE: <html> is never popped from the stack, so we need to updated\n    //the end location explicitly.\n\n\n    if (p.options.sourceCodeLocationInfo && p.openElements.tagIDs[0] === html_js_1.TAG_ID.HTML) {\n      p._setEndLocation(p.openElements.items[0], token); // Update the body element, if it doesn't have an end tag\n\n\n      const bodyElement = p.openElements.items[1];\n\n      if (bodyElement && !((_a = p.treeAdapter.getNodeSourceCodeLocation(bodyElement)) === null || _a === void 0 ? void 0 : _a.endTag)) {\n        p._setEndLocation(bodyElement, token);\n      }\n    }\n  } else {\n    tokenAfterBody(p, token);\n  }\n}\n\nfunction tokenAfterBody(p, token) {\n  p.insertionMode = InsertionMode.IN_BODY;\n  modeInBody(p, token);\n} // The \"in frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagInFrameset(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.FRAMESET:\n      {\n        p._insertElement(token, html_js_1.NS.HTML);\n\n        break;\n      }\n\n    case html_js_1.TAG_ID.FRAME:\n      {\n        p._appendElement(token, html_js_1.NS.HTML);\n\n        token.ackSelfClosing = true;\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOFRAMES:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n}\n\nfunction endTagInFrameset(p, token) {\n  if (token.tagID === html_js_1.TAG_ID.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n    p.openElements.pop();\n\n    if (!p.fragmentContext && p.openElements.currentTagId !== html_js_1.TAG_ID.FRAMESET) {\n      p.insertionMode = InsertionMode.AFTER_FRAMESET;\n    }\n  }\n} // The \"after frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterFrameset(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOFRAMES:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n}\n\nfunction endTagAfterFrameset(p, token) {\n  if (token.tagID === html_js_1.TAG_ID.HTML) {\n    p.insertionMode = InsertionMode.AFTER_AFTER_FRAMESET;\n  }\n} // The \"after after body\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterAfterBody(p, token) {\n  if (token.tagID === html_js_1.TAG_ID.HTML) {\n    startTagInBody(p, token);\n  } else {\n    tokenAfterAfterBody(p, token);\n  }\n}\n\nfunction tokenAfterAfterBody(p, token) {\n  p.insertionMode = InsertionMode.IN_BODY;\n  modeInBody(p, token);\n} // The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\n\n\nfunction startTagAfterAfterFrameset(p, token) {\n  switch (token.tagID) {\n    case html_js_1.TAG_ID.HTML:\n      {\n        startTagInBody(p, token);\n        break;\n      }\n\n    case html_js_1.TAG_ID.NOFRAMES:\n      {\n        startTagInHead(p, token);\n        break;\n      }\n\n    default: // Do nothing\n\n  }\n} // The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\n\n\nfunction nullCharacterInForeignContent(p, token) {\n  token.chars = unicode.REPLACEMENT_CHARACTER;\n\n  p._insertCharacters(token);\n}\n\nfunction characterInForeignContent(p, token) {\n  p._insertCharacters(token);\n\n  p.framesetOk = false;\n}\n\nfunction popUntilHtmlOrIntegrationPoint(p) {\n  while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== html_js_1.NS.HTML && !p._isIntegrationPoint(p.openElements.currentTagId, p.openElements.current)) {\n    p.openElements.pop();\n  }\n}\n\nfunction startTagInForeignContent(p, token) {\n  if (foreignContent.causesExit(token)) {\n    popUntilHtmlOrIntegrationPoint(p);\n\n    p._startTagOutsideForeignContent(token);\n  } else {\n    const current = p._getAdjustedCurrentElement();\n\n    const currentNs = p.treeAdapter.getNamespaceURI(current);\n\n    if (currentNs === html_js_1.NS.MATHML) {\n      foreignContent.adjustTokenMathMLAttrs(token);\n    } else if (currentNs === html_js_1.NS.SVG) {\n      foreignContent.adjustTokenSVGTagName(token);\n      foreignContent.adjustTokenSVGAttrs(token);\n    }\n\n    foreignContent.adjustTokenXMLAttrs(token);\n\n    if (token.selfClosing) {\n      p._appendElement(token, currentNs);\n    } else {\n      p._insertElement(token, currentNs);\n    }\n\n    token.ackSelfClosing = true;\n  }\n}\n\nfunction endTagInForeignContent(p, token) {\n  if (token.tagID === html_js_1.TAG_ID.P || token.tagID === html_js_1.TAG_ID.BR) {\n    popUntilHtmlOrIntegrationPoint(p);\n\n    p._endTagOutsideForeignContent(token);\n\n    return;\n  }\n\n  for (let i = p.openElements.stackTop; i > 0; i--) {\n    const element = p.openElements.items[i];\n\n    if (p.treeAdapter.getNamespaceURI(element) === html_js_1.NS.HTML) {\n      p._endTagOutsideForeignContent(token);\n\n      break;\n    }\n\n    const tagName = p.treeAdapter.getTagName(element);\n\n    if (tagName.toLowerCase() === token.tagName) {\n      //NOTE: update the token tag name for `_setEndLocation`.\n      token.tagName = tagName;\n      p.openElements.shortenToLength(i);\n      break;\n    }\n  }\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","Parser","index_js_1","require","open_element_stack_js_1","formatting_element_list_js_1","default_js_1","doctype","foreignContent","error_codes_js_1","unicode","html_js_1","token_js_1","HIDDEN_INPUT_TYPE","AA_OUTER_LOOP_ITER","AA_INNER_LOOP_ITER","InsertionMode","BASE_LOC","startLine","startCol","startOffset","endLine","endCol","endOffset","TABLE_STRUCTURE_TAGS","Set","TAG_ID","TABLE","TBODY","TFOOT","THEAD","TR","defaultParserOptions","scriptingEnabled","sourceCodeLocationInfo","treeAdapter","defaultTreeAdapter","onParseError","constructor","options","document","fragmentContext","scriptHandler","currentToken","stopped","insertionMode","INITIAL","originalInsertionMode","headElement","formElement","currentNotInHTML","tmplInsertionModeStack","pendingCharacterTokens","hasNonWhitespacePendingCharacterToken","framesetOk","skipNextNewLine","fosterParentingEnabled","assign","createDocument","tokenizer","Tokenizer","activeFormattingElements","FormattingElementList","fragmentContextID","getTagID","getTagName","UNKNOWN","_setContextModes","openElements","OpenElementStack","parse","html","parser","write","getFragmentParser","opts","createElement","TAG_NAMES","TEMPLATE","NS","HTML","documentMock","unshift","IN_TEMPLATE","_initTokenizerForFragmentParsing","_insertFakeRootElement","_resetInsertionMode","_findFormInFragmentContext","getFragment","rootElement","getFirstChild","fragment","createDocumentFragment","_adoptNodes","_err","token","code","beforeToken","_a","loc","location","err","onItemPush","node","tid","isTop","_b","call","stackTop","onItemPop","_setEndLocation","current","currentTagId","isHTML","getNamespaceURI","inForeignNode","_isIntegrationPoint","_switchToTextParsing","nextTokenizerState","_insertElement","state","TEXT","switchToPlaintextParsing","IN_BODY","TokenizerMode","PLAINTEXT","_getAdjustedCurrentElement","FORM","getParentNode","TITLE","TEXTAREA","RCDATA","STYLE","XMP","IFRAME","NOEMBED","NOFRAMES","NOSCRIPT","RAWTEXT","SCRIPT","SCRIPT_DATA","_setDocumentType","name","publicId","systemId","setDocumentType","documentChildren","getChildNodes","docTypeNode","find","isDocumentTypeNode","setNodeSourceCodeLocation","_attachElementToTree","element","startTag","_shouldFosterParentOnInsertion","_fosterParentElement","parent","currentTmplContentOrNode","appendChild","_appendElement","namespaceURI","tagName","attrs","push","tagID","_insertFakeElement","_insertTemplate","tmpl","content","setTemplateContent","_appendCommentNode","commentNode","createCommentNode","data","_insertCharacters","beforeElement","_findFosterParentingLocation","insertTextBefore","chars","insertText","siblings","textNodeIdx","lastIndexOf","length","textNode","tnLoc","getNodeSourceCodeLocation","updateNodeSourceCodeLocation","donor","recipient","child","detachNode","closingToken","ctLoc","tn","endLoc","type","TokenType","END_TAG","endTag","shouldProcessStartTagTokenInForeignContent","SVG","ANNOTATION_XML","MATHML","MGLYPH","MALIGNMARK","_processToken","CHARACTER","onCharacter","NULL_CHARACTER","onNullCharacter","COMMENT","onComment","DOCTYPE","onDoctype","START_TAG","_processStartTag","onEndTag","EOF","onEof","WHITESPACE_CHARACTER","onWhitespaceCharacter","foreignNS","ns","getAttrList","isIntegrationPoint","_reconstructActiveFormattingElements","listLength","entries","endIndex","findIndex","entry","EntryType","Marker","contains","unopenIdx","i","_closeTableCell","generateImpliedEndTags","popUntilTableCellPopped","clearToLastMarker","IN_ROW","_closePElement","generateImpliedEndTagsWithExclusion","P","popUntilTagNamePopped","tagIDs","IN_TABLE_BODY","CAPTION","IN_CAPTION","COLGROUP","IN_COLUMN_GROUP","IN_TABLE","BODY","FRAMESET","IN_FRAMESET","SELECT","_resetInsertionModeForSelect","AFTER_HEAD","BEFORE_HEAD","TD","TH","IN_CELL","HEAD","IN_HEAD","selectIdx","IN_SELECT_IN_TABLE","IN_SELECT","_isElementCausesFosterParenting","has","openElement","items","getTemplateContent","insertBefore","_isSpecialElement","id","SPECIAL_ELEMENTS","characterInForeignContent","tokenInInitialMode","BEFORE_HTML","tokenBeforeHtml","tokenBeforeHead","tokenInHead","IN_HEAD_NO_SCRIPT","tokenInHeadNoScript","tokenAfterHead","characterInBody","characterInTable","IN_TABLE_TEXT","characterInTableText","tokenInColumnGroup","AFTER_BODY","tokenAfterBody","AFTER_AFTER_BODY","tokenAfterAfterBody","nullCharacterInForeignContent","appendComment","AFTER_FRAMESET","tokenInTableText","appendCommentToRootHtmlElement","AFTER_AFTER_FRAMESET","appendCommentToDocument","doctypeInInitialMode","ERR","misplacedDoctype","onStartTag","selfClosing","ackSelfClosing","nonVoidHtmlElementStartTagWithTrailingSolidus","startTagInForeignContent","_startTagOutsideForeignContent","startTagBeforeHtml","startTagBeforeHead","startTagInHead","startTagInHeadNoScript","startTagAfterHead","startTagInBody","startTagInTable","startTagInCaption","startTagInColumnGroup","startTagInTableBody","startTagInRow","startTagInCell","startTagInSelect","startTagInSelectInTable","startTagInTemplate","startTagAfterBody","startTagInFrameset","startTagAfterFrameset","startTagAfterAfterBody","startTagAfterAfterFrameset","endTagInForeignContent","_endTagOutsideForeignContent","endTagBeforeHtml","endTagBeforeHead","endTagInHead","endTagInHeadNoScript","endTagAfterHead","endTagInBody","endTagInText","endTagInTable","endTagInCaption","endTagInColumnGroup","endTagInTableBody","endTagInRow","endTagInCell","endTagInSelect","endTagInSelectInTable","endTagInTemplate","endTagAfterBody","endTagInFrameset","endTagAfterFrameset","eofInBody","eofInText","eofInTemplate","stopParsing","charCodeAt","CODE_POINTS","LINE_FEED","substr","whitespaceCharacterInBody","whitespaceCharacterInTableText","aaObtainFormattingElementEntry","p","formattingElementEntry","getElementEntryInScopeWithTagName","removeEntry","hasInScope","genericEndTagInBody","aaObtainFurthestBlock","furthestBlock","idx","shortenToLength","aaInnerLoop","formattingElement","lastElement","nextElement","getCommonAncestor","elementEntry","getElementEntry","counterOverflow","shouldRemoveFromOpenElements","remove","aaRecreateElementFromEntry","bookmark","newElement","replace","aaInsertLastNodeInCommonAncestor","commonAncestor","aaReplaceFormattingElement","insertElementAfterBookmark","insertAfter","callAdoptionAgency","target","htmlElement","htmlLocation","bodyElement","bodyLocation","mode","forceQuirks","DOCUMENT_MODE","QUIRKS","getDocumentMode","isConforming","nonConformingDoctype","setDocumentMode","missingDoctype","BR","endTagWithoutMatchingOpenElement","BASE","BASEFONT","BGSOUND","LINK","META","insertMarker","misplacedStartTagForHeadElement","pop","templateEndTagInHead","tmplCount","generateImpliedEndTagsThoroughly","closingOfElementWithOpenChildElements","shift","nestedNoscriptInHead","errCode","openElementsLeftAfterEof","disallowedContentInNoscriptInHead","abandonedHeadElementChild","modeInBody","htmlStartTagInBody","adoptAttributes","bodyStartTagInBody","tryPeekProperlyNestedBodyElement","framesetStartTagInBody","popAllUpToHtmlElement","addressStartTagInBody","hasInButtonScope","numberedHeaderStartTagInBody","isNumberedHeader","preStartTagInBody","formStartTagInBody","inTemplate","listItemStartTagInBody","elementId","LI","DD","DT","ADDRESS","DIV","plaintextStartTagInBody","buttonStartTagInBody","BUTTON","aStartTagInBody","activeElementEntry","A","pushElement","bStartTagInBody","nobrStartTagInBody","NOBR","appletStartTagInBody","tableStartTagInBody","areaStartTagInBody","isHiddenInput","inputType","getTokenAttr","ATTRS","TYPE","toLowerCase","inputStartTagInBody","paramStartTagInBody","hrStartTagInBody","imageStartTagInBody","IMG","textareaStartTagInBody","xmpStartTagInBody","iframeStartTagInBody","noembedStartTagInBody","selectStartTagInBody","optgroupStartTagInBody","OPTION","rbStartTagInBody","RUBY","rtStartTagInBody","RTC","mathStartTagInBody","adjustTokenMathMLAttrs","adjustTokenXMLAttrs","svgStartTagInBody","adjustTokenSVGAttrs","genericStartTagInBody","I","S","B","U","EM","TT","BIG","CODE","FONT","SMALL","STRIKE","STRONG","H1","H2","H3","H4","H5","H6","DL","OL","UL","DIR","NAV","MAIN","MENU","ASIDE","CENTER","FIGURE","FOOTER","HEADER","HGROUP","DIALOG","DETAILS","ARTICLE","SECTION","SUMMARY","FIELDSET","BLOCKQUOTE","FIGCAPTION","WBR","AREA","EMBED","KEYGEN","HR","RB","RT","RP","PRE","LISTING","MATH","INPUT","PARAM","TRACK","SOURCE","IMAGE","APPLET","OBJECT","MARQUEE","OPTGROUP","COL","FRAME","bodyEndTagInBody","htmlEndTagInBody","addressEndTagInBody","formEndTagInBody","pEndTagInBody","liEndTagInBody","hasInListItemScope","ddEndTagInBody","numberedHeaderEndTagInBody","hasNumberedHeaderInScope","popUntilNumberedHeaderPopped","appletEndTagInBody","brEndTagInBody","eofInElementThatCanContainOnlyText","tokenInTable","captionStartTagInTable","clearBackToTableContext","colgroupStartTagInTable","colStartTagInTable","tbodyStartTagInTable","tdStartTagInTable","tableStartTagInTable","hasInTableScope","inputStartTagInTable","formStartTagInTable","savedFosterParentingState","TABLE_VOID_ELEMENTS","clearBackToTableBodyContext","hasTableBodyContextInTableScope","clearBackToTableRowContext","hasInSelectScope","isRootHtmlElementCurrent","REPLACEMENT_CHARACTER","popUntilHtmlOrIntegrationPoint","causesExit","currentNs","adjustTokenSVGTagName"],"sources":["/Users/tranminhtrung/Desktop/learn_web3/gamble/node_modules/cheerio/node_modules/parse5/dist/cjs/parser/index.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Parser = void 0;\nconst index_js_1 = require(\"../tokenizer/index.js\");\nconst open_element_stack_js_1 = require(\"./open-element-stack.js\");\nconst formatting_element_list_js_1 = require(\"./formatting-element-list.js\");\nconst default_js_1 = require(\"../tree-adapters/default.js\");\nconst doctype = require(\"../common/doctype.js\");\nconst foreignContent = require(\"../common/foreign-content.js\");\nconst error_codes_js_1 = require(\"../common/error-codes.js\");\nconst unicode = require(\"../common/unicode.js\");\nconst html_js_1 = require(\"../common/html.js\");\nconst token_js_1 = require(\"../common/token.js\");\n//Misc constants\nconst HIDDEN_INPUT_TYPE = 'hidden';\n//Adoption agency loops iteration count\nconst AA_OUTER_LOOP_ITER = 8;\nconst AA_INNER_LOOP_ITER = 3;\n//Insertion modes\nvar InsertionMode;\n(function (InsertionMode) {\n    InsertionMode[InsertionMode[\"INITIAL\"] = 0] = \"INITIAL\";\n    InsertionMode[InsertionMode[\"BEFORE_HTML\"] = 1] = \"BEFORE_HTML\";\n    InsertionMode[InsertionMode[\"BEFORE_HEAD\"] = 2] = \"BEFORE_HEAD\";\n    InsertionMode[InsertionMode[\"IN_HEAD\"] = 3] = \"IN_HEAD\";\n    InsertionMode[InsertionMode[\"IN_HEAD_NO_SCRIPT\"] = 4] = \"IN_HEAD_NO_SCRIPT\";\n    InsertionMode[InsertionMode[\"AFTER_HEAD\"] = 5] = \"AFTER_HEAD\";\n    InsertionMode[InsertionMode[\"IN_BODY\"] = 6] = \"IN_BODY\";\n    InsertionMode[InsertionMode[\"TEXT\"] = 7] = \"TEXT\";\n    InsertionMode[InsertionMode[\"IN_TABLE\"] = 8] = \"IN_TABLE\";\n    InsertionMode[InsertionMode[\"IN_TABLE_TEXT\"] = 9] = \"IN_TABLE_TEXT\";\n    InsertionMode[InsertionMode[\"IN_CAPTION\"] = 10] = \"IN_CAPTION\";\n    InsertionMode[InsertionMode[\"IN_COLUMN_GROUP\"] = 11] = \"IN_COLUMN_GROUP\";\n    InsertionMode[InsertionMode[\"IN_TABLE_BODY\"] = 12] = \"IN_TABLE_BODY\";\n    InsertionMode[InsertionMode[\"IN_ROW\"] = 13] = \"IN_ROW\";\n    InsertionMode[InsertionMode[\"IN_CELL\"] = 14] = \"IN_CELL\";\n    InsertionMode[InsertionMode[\"IN_SELECT\"] = 15] = \"IN_SELECT\";\n    InsertionMode[InsertionMode[\"IN_SELECT_IN_TABLE\"] = 16] = \"IN_SELECT_IN_TABLE\";\n    InsertionMode[InsertionMode[\"IN_TEMPLATE\"] = 17] = \"IN_TEMPLATE\";\n    InsertionMode[InsertionMode[\"AFTER_BODY\"] = 18] = \"AFTER_BODY\";\n    InsertionMode[InsertionMode[\"IN_FRAMESET\"] = 19] = \"IN_FRAMESET\";\n    InsertionMode[InsertionMode[\"AFTER_FRAMESET\"] = 20] = \"AFTER_FRAMESET\";\n    InsertionMode[InsertionMode[\"AFTER_AFTER_BODY\"] = 21] = \"AFTER_AFTER_BODY\";\n    InsertionMode[InsertionMode[\"AFTER_AFTER_FRAMESET\"] = 22] = \"AFTER_AFTER_FRAMESET\";\n})(InsertionMode || (InsertionMode = {}));\nconst BASE_LOC = {\n    startLine: -1,\n    startCol: -1,\n    startOffset: -1,\n    endLine: -1,\n    endCol: -1,\n    endOffset: -1,\n};\nconst TABLE_STRUCTURE_TAGS = new Set([html_js_1.TAG_ID.TABLE, html_js_1.TAG_ID.TBODY, html_js_1.TAG_ID.TFOOT, html_js_1.TAG_ID.THEAD, html_js_1.TAG_ID.TR]);\nconst defaultParserOptions = {\n    scriptingEnabled: true,\n    sourceCodeLocationInfo: false,\n    treeAdapter: default_js_1.defaultTreeAdapter,\n    onParseError: null,\n};\n//Parser\nclass Parser {\n    constructor(options, document, fragmentContext = null, scriptHandler = null) {\n        this.fragmentContext = fragmentContext;\n        this.scriptHandler = scriptHandler;\n        this.currentToken = null;\n        this.stopped = false;\n        this.insertionMode = InsertionMode.INITIAL;\n        this.originalInsertionMode = InsertionMode.INITIAL;\n        this.headElement = null;\n        this.formElement = null;\n        /** Indicates that the current node is not an element in the HTML namespace */\n        this.currentNotInHTML = false;\n        /**\n         * The template insertion mode stack is maintained from the left.\n         * Ie. the topmost element will always have index 0.\n         */\n        this.tmplInsertionModeStack = [];\n        this.pendingCharacterTokens = [];\n        this.hasNonWhitespacePendingCharacterToken = false;\n        this.framesetOk = true;\n        this.skipNextNewLine = false;\n        this.fosterParentingEnabled = false;\n        this.options = Object.assign(Object.assign({}, defaultParserOptions), options);\n        this.treeAdapter = this.options.treeAdapter;\n        this.onParseError = this.options.onParseError;\n        // Always enable location info if we report parse errors.\n        if (this.onParseError) {\n            this.options.sourceCodeLocationInfo = true;\n        }\n        this.document = document !== null && document !== void 0 ? document : this.treeAdapter.createDocument();\n        this.tokenizer = new index_js_1.Tokenizer(this.options, this);\n        this.activeFormattingElements = new formatting_element_list_js_1.FormattingElementList(this.treeAdapter);\n        this.fragmentContextID = fragmentContext ? (0, html_js_1.getTagID)(this.treeAdapter.getTagName(fragmentContext)) : html_js_1.TAG_ID.UNKNOWN;\n        this._setContextModes(fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : this.document, this.fragmentContextID);\n        this.openElements = new open_element_stack_js_1.OpenElementStack(this.document, this.treeAdapter, this);\n    }\n    // API\n    static parse(html, options) {\n        const parser = new this(options);\n        parser.tokenizer.write(html, true);\n        return parser.document;\n    }\n    static getFragmentParser(fragmentContext, options) {\n        const opts = Object.assign(Object.assign({}, defaultParserOptions), options);\n        //NOTE: use a <template> element as the fragment context if no context element was provided,\n        //so we will parse in a \"forgiving\" manner\n        fragmentContext !== null && fragmentContext !== void 0 ? fragmentContext : (fragmentContext = opts.treeAdapter.createElement(html_js_1.TAG_NAMES.TEMPLATE, html_js_1.NS.HTML, []));\n        //NOTE: create a fake element which will be used as the `document` for fragment parsing.\n        //This is important for jsdom, where a new `document` cannot be created. This led to\n        //fragment parsing messing with the main `document`.\n        const documentMock = opts.treeAdapter.createElement('documentmock', html_js_1.NS.HTML, []);\n        const parser = new this(opts, documentMock, fragmentContext);\n        if (parser.fragmentContextID === html_js_1.TAG_ID.TEMPLATE) {\n            parser.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n        }\n        parser._initTokenizerForFragmentParsing();\n        parser._insertFakeRootElement();\n        parser._resetInsertionMode();\n        parser._findFormInFragmentContext();\n        return parser;\n    }\n    getFragment() {\n        const rootElement = this.treeAdapter.getFirstChild(this.document);\n        const fragment = this.treeAdapter.createDocumentFragment();\n        this._adoptNodes(rootElement, fragment);\n        return fragment;\n    }\n    //Errors\n    _err(token, code, beforeToken) {\n        var _a;\n        if (!this.onParseError)\n            return;\n        const loc = (_a = token.location) !== null && _a !== void 0 ? _a : BASE_LOC;\n        const err = {\n            code,\n            startLine: loc.startLine,\n            startCol: loc.startCol,\n            startOffset: loc.startOffset,\n            endLine: beforeToken ? loc.startLine : loc.endLine,\n            endCol: beforeToken ? loc.startCol : loc.endCol,\n            endOffset: beforeToken ? loc.startOffset : loc.endOffset,\n        };\n        this.onParseError(err);\n    }\n    //Stack events\n    onItemPush(node, tid, isTop) {\n        var _a, _b;\n        (_b = (_a = this.treeAdapter).onItemPush) === null || _b === void 0 ? void 0 : _b.call(_a, node);\n        if (isTop && this.openElements.stackTop > 0)\n            this._setContextModes(node, tid);\n    }\n    onItemPop(node, isTop) {\n        var _a, _b;\n        if (this.options.sourceCodeLocationInfo) {\n            this._setEndLocation(node, this.currentToken);\n        }\n        (_b = (_a = this.treeAdapter).onItemPop) === null || _b === void 0 ? void 0 : _b.call(_a, node, this.openElements.current);\n        if (isTop) {\n            let current;\n            let currentTagId;\n            if (this.openElements.stackTop === 0 && this.fragmentContext) {\n                current = this.fragmentContext;\n                currentTagId = this.fragmentContextID;\n            }\n            else {\n                ({ current, currentTagId } = this.openElements);\n            }\n            this._setContextModes(current, currentTagId);\n        }\n    }\n    _setContextModes(current, tid) {\n        const isHTML = current === this.document || this.treeAdapter.getNamespaceURI(current) === html_js_1.NS.HTML;\n        this.currentNotInHTML = !isHTML;\n        this.tokenizer.inForeignNode = !isHTML && !this._isIntegrationPoint(tid, current);\n    }\n    _switchToTextParsing(currentToken, nextTokenizerState) {\n        this._insertElement(currentToken, html_js_1.NS.HTML);\n        this.tokenizer.state = nextTokenizerState;\n        this.originalInsertionMode = this.insertionMode;\n        this.insertionMode = InsertionMode.TEXT;\n    }\n    switchToPlaintextParsing() {\n        this.insertionMode = InsertionMode.TEXT;\n        this.originalInsertionMode = InsertionMode.IN_BODY;\n        this.tokenizer.state = index_js_1.TokenizerMode.PLAINTEXT;\n    }\n    //Fragment parsing\n    _getAdjustedCurrentElement() {\n        return this.openElements.stackTop === 0 && this.fragmentContext\n            ? this.fragmentContext\n            : this.openElements.current;\n    }\n    _findFormInFragmentContext() {\n        let node = this.fragmentContext;\n        while (node) {\n            if (this.treeAdapter.getTagName(node) === html_js_1.TAG_NAMES.FORM) {\n                this.formElement = node;\n                break;\n            }\n            node = this.treeAdapter.getParentNode(node);\n        }\n    }\n    _initTokenizerForFragmentParsing() {\n        if (!this.fragmentContext || this.treeAdapter.getNamespaceURI(this.fragmentContext) !== html_js_1.NS.HTML) {\n            return;\n        }\n        switch (this.fragmentContextID) {\n            case html_js_1.TAG_ID.TITLE:\n            case html_js_1.TAG_ID.TEXTAREA: {\n                this.tokenizer.state = index_js_1.TokenizerMode.RCDATA;\n                break;\n            }\n            case html_js_1.TAG_ID.STYLE:\n            case html_js_1.TAG_ID.XMP:\n            case html_js_1.TAG_ID.IFRAME:\n            case html_js_1.TAG_ID.NOEMBED:\n            case html_js_1.TAG_ID.NOFRAMES:\n            case html_js_1.TAG_ID.NOSCRIPT: {\n                this.tokenizer.state = index_js_1.TokenizerMode.RAWTEXT;\n                break;\n            }\n            case html_js_1.TAG_ID.SCRIPT: {\n                this.tokenizer.state = index_js_1.TokenizerMode.SCRIPT_DATA;\n                break;\n            }\n            case html_js_1.TAG_ID.PLAINTEXT: {\n                this.tokenizer.state = index_js_1.TokenizerMode.PLAINTEXT;\n                break;\n            }\n            default:\n            // Do nothing\n        }\n    }\n    //Tree mutation\n    _setDocumentType(token) {\n        const name = token.name || '';\n        const publicId = token.publicId || '';\n        const systemId = token.systemId || '';\n        this.treeAdapter.setDocumentType(this.document, name, publicId, systemId);\n        if (token.location) {\n            const documentChildren = this.treeAdapter.getChildNodes(this.document);\n            const docTypeNode = documentChildren.find((node) => this.treeAdapter.isDocumentTypeNode(node));\n            if (docTypeNode) {\n                this.treeAdapter.setNodeSourceCodeLocation(docTypeNode, token.location);\n            }\n        }\n    }\n    _attachElementToTree(element, location) {\n        if (this.options.sourceCodeLocationInfo) {\n            const loc = location && Object.assign(Object.assign({}, location), { startTag: location });\n            this.treeAdapter.setNodeSourceCodeLocation(element, loc);\n        }\n        if (this._shouldFosterParentOnInsertion()) {\n            this._fosterParentElement(element);\n        }\n        else {\n            const parent = this.openElements.currentTmplContentOrNode;\n            this.treeAdapter.appendChild(parent, element);\n        }\n    }\n    _appendElement(token, namespaceURI) {\n        const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n        this._attachElementToTree(element, token.location);\n    }\n    _insertElement(token, namespaceURI) {\n        const element = this.treeAdapter.createElement(token.tagName, namespaceURI, token.attrs);\n        this._attachElementToTree(element, token.location);\n        this.openElements.push(element, token.tagID);\n    }\n    _insertFakeElement(tagName, tagID) {\n        const element = this.treeAdapter.createElement(tagName, html_js_1.NS.HTML, []);\n        this._attachElementToTree(element, null);\n        this.openElements.push(element, tagID);\n    }\n    _insertTemplate(token) {\n        const tmpl = this.treeAdapter.createElement(token.tagName, html_js_1.NS.HTML, token.attrs);\n        const content = this.treeAdapter.createDocumentFragment();\n        this.treeAdapter.setTemplateContent(tmpl, content);\n        this._attachElementToTree(tmpl, token.location);\n        this.openElements.push(tmpl, token.tagID);\n        if (this.options.sourceCodeLocationInfo)\n            this.treeAdapter.setNodeSourceCodeLocation(content, null);\n    }\n    _insertFakeRootElement() {\n        const element = this.treeAdapter.createElement(html_js_1.TAG_NAMES.HTML, html_js_1.NS.HTML, []);\n        if (this.options.sourceCodeLocationInfo)\n            this.treeAdapter.setNodeSourceCodeLocation(element, null);\n        this.treeAdapter.appendChild(this.openElements.current, element);\n        this.openElements.push(element, html_js_1.TAG_ID.HTML);\n    }\n    _appendCommentNode(token, parent) {\n        const commentNode = this.treeAdapter.createCommentNode(token.data);\n        this.treeAdapter.appendChild(parent, commentNode);\n        if (this.options.sourceCodeLocationInfo) {\n            this.treeAdapter.setNodeSourceCodeLocation(commentNode, token.location);\n        }\n    }\n    _insertCharacters(token) {\n        let parent;\n        let beforeElement;\n        if (this._shouldFosterParentOnInsertion()) {\n            ({ parent, beforeElement } = this._findFosterParentingLocation());\n            if (beforeElement) {\n                this.treeAdapter.insertTextBefore(parent, token.chars, beforeElement);\n            }\n            else {\n                this.treeAdapter.insertText(parent, token.chars);\n            }\n        }\n        else {\n            parent = this.openElements.currentTmplContentOrNode;\n            this.treeAdapter.insertText(parent, token.chars);\n        }\n        if (!token.location)\n            return;\n        const siblings = this.treeAdapter.getChildNodes(parent);\n        const textNodeIdx = beforeElement ? siblings.lastIndexOf(beforeElement) : siblings.length;\n        const textNode = siblings[textNodeIdx - 1];\n        //NOTE: if we have a location assigned by another token, then just update the end position\n        const tnLoc = this.treeAdapter.getNodeSourceCodeLocation(textNode);\n        if (tnLoc) {\n            const { endLine, endCol, endOffset } = token.location;\n            this.treeAdapter.updateNodeSourceCodeLocation(textNode, { endLine, endCol, endOffset });\n        }\n        else if (this.options.sourceCodeLocationInfo) {\n            this.treeAdapter.setNodeSourceCodeLocation(textNode, token.location);\n        }\n    }\n    _adoptNodes(donor, recipient) {\n        for (let child = this.treeAdapter.getFirstChild(donor); child; child = this.treeAdapter.getFirstChild(donor)) {\n            this.treeAdapter.detachNode(child);\n            this.treeAdapter.appendChild(recipient, child);\n        }\n    }\n    _setEndLocation(element, closingToken) {\n        if (this.treeAdapter.getNodeSourceCodeLocation(element) && closingToken.location) {\n            const ctLoc = closingToken.location;\n            const tn = this.treeAdapter.getTagName(element);\n            const endLoc = \n            // NOTE: For cases like <p> <p> </p> - First 'p' closes without a closing\n            // tag and for cases like <td> <p> </td> - 'p' closes without a closing tag.\n            closingToken.type === token_js_1.TokenType.END_TAG && tn === closingToken.tagName\n                ? {\n                    endTag: Object.assign({}, ctLoc),\n                    endLine: ctLoc.endLine,\n                    endCol: ctLoc.endCol,\n                    endOffset: ctLoc.endOffset,\n                }\n                : {\n                    endLine: ctLoc.startLine,\n                    endCol: ctLoc.startCol,\n                    endOffset: ctLoc.startOffset,\n                };\n            this.treeAdapter.updateNodeSourceCodeLocation(element, endLoc);\n        }\n    }\n    //Token processing\n    shouldProcessStartTagTokenInForeignContent(token) {\n        // Check that neither current === document, or ns === NS.HTML\n        if (!this.currentNotInHTML)\n            return false;\n        let current;\n        let currentTagId;\n        if (this.openElements.stackTop === 0 && this.fragmentContext) {\n            current = this.fragmentContext;\n            currentTagId = this.fragmentContextID;\n        }\n        else {\n            ({ current, currentTagId } = this.openElements);\n        }\n        if (token.tagID === html_js_1.TAG_ID.SVG &&\n            this.treeAdapter.getTagName(current) === html_js_1.TAG_NAMES.ANNOTATION_XML &&\n            this.treeAdapter.getNamespaceURI(current) === html_js_1.NS.MATHML) {\n            return false;\n        }\n        return (\n        // Check that `current` is not an integration point for HTML or MathML elements.\n        this.tokenizer.inForeignNode ||\n            // If it _is_ an integration point, then we might have to check that it is not an HTML\n            // integration point.\n            ((token.tagID === html_js_1.TAG_ID.MGLYPH || token.tagID === html_js_1.TAG_ID.MALIGNMARK) &&\n                !this._isIntegrationPoint(currentTagId, current, html_js_1.NS.HTML)));\n    }\n    _processToken(token) {\n        switch (token.type) {\n            case token_js_1.TokenType.CHARACTER: {\n                this.onCharacter(token);\n                break;\n            }\n            case token_js_1.TokenType.NULL_CHARACTER: {\n                this.onNullCharacter(token);\n                break;\n            }\n            case token_js_1.TokenType.COMMENT: {\n                this.onComment(token);\n                break;\n            }\n            case token_js_1.TokenType.DOCTYPE: {\n                this.onDoctype(token);\n                break;\n            }\n            case token_js_1.TokenType.START_TAG: {\n                this._processStartTag(token);\n                break;\n            }\n            case token_js_1.TokenType.END_TAG: {\n                this.onEndTag(token);\n                break;\n            }\n            case token_js_1.TokenType.EOF: {\n                this.onEof(token);\n                break;\n            }\n            case token_js_1.TokenType.WHITESPACE_CHARACTER: {\n                this.onWhitespaceCharacter(token);\n                break;\n            }\n        }\n    }\n    //Integration points\n    _isIntegrationPoint(tid, element, foreignNS) {\n        const ns = this.treeAdapter.getNamespaceURI(element);\n        const attrs = this.treeAdapter.getAttrList(element);\n        return foreignContent.isIntegrationPoint(tid, ns, attrs, foreignNS);\n    }\n    //Active formatting elements reconstruction\n    _reconstructActiveFormattingElements() {\n        const listLength = this.activeFormattingElements.entries.length;\n        if (listLength) {\n            const endIndex = this.activeFormattingElements.entries.findIndex((entry) => entry.type === formatting_element_list_js_1.EntryType.Marker || this.openElements.contains(entry.element));\n            const unopenIdx = endIndex < 0 ? listLength - 1 : endIndex - 1;\n            for (let i = unopenIdx; i >= 0; i--) {\n                const entry = this.activeFormattingElements.entries[i];\n                this._insertElement(entry.token, this.treeAdapter.getNamespaceURI(entry.element));\n                entry.element = this.openElements.current;\n            }\n        }\n    }\n    //Close elements\n    _closeTableCell() {\n        this.openElements.generateImpliedEndTags();\n        this.openElements.popUntilTableCellPopped();\n        this.activeFormattingElements.clearToLastMarker();\n        this.insertionMode = InsertionMode.IN_ROW;\n    }\n    _closePElement() {\n        this.openElements.generateImpliedEndTagsWithExclusion(html_js_1.TAG_ID.P);\n        this.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.P);\n    }\n    //Insertion modes\n    _resetInsertionMode() {\n        for (let i = this.openElements.stackTop; i >= 0; i--) {\n            //Insertion mode reset map\n            switch (i === 0 && this.fragmentContext ? this.fragmentContextID : this.openElements.tagIDs[i]) {\n                case html_js_1.TAG_ID.TR:\n                    this.insertionMode = InsertionMode.IN_ROW;\n                    return;\n                case html_js_1.TAG_ID.TBODY:\n                case html_js_1.TAG_ID.THEAD:\n                case html_js_1.TAG_ID.TFOOT:\n                    this.insertionMode = InsertionMode.IN_TABLE_BODY;\n                    return;\n                case html_js_1.TAG_ID.CAPTION:\n                    this.insertionMode = InsertionMode.IN_CAPTION;\n                    return;\n                case html_js_1.TAG_ID.COLGROUP:\n                    this.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n                    return;\n                case html_js_1.TAG_ID.TABLE:\n                    this.insertionMode = InsertionMode.IN_TABLE;\n                    return;\n                case html_js_1.TAG_ID.BODY:\n                    this.insertionMode = InsertionMode.IN_BODY;\n                    return;\n                case html_js_1.TAG_ID.FRAMESET:\n                    this.insertionMode = InsertionMode.IN_FRAMESET;\n                    return;\n                case html_js_1.TAG_ID.SELECT:\n                    this._resetInsertionModeForSelect(i);\n                    return;\n                case html_js_1.TAG_ID.TEMPLATE:\n                    this.insertionMode = this.tmplInsertionModeStack[0];\n                    return;\n                case html_js_1.TAG_ID.HTML:\n                    this.insertionMode = this.headElement ? InsertionMode.AFTER_HEAD : InsertionMode.BEFORE_HEAD;\n                    return;\n                case html_js_1.TAG_ID.TD:\n                case html_js_1.TAG_ID.TH:\n                    if (i > 0) {\n                        this.insertionMode = InsertionMode.IN_CELL;\n                        return;\n                    }\n                    break;\n                case html_js_1.TAG_ID.HEAD:\n                    if (i > 0) {\n                        this.insertionMode = InsertionMode.IN_HEAD;\n                        return;\n                    }\n                    break;\n            }\n        }\n        this.insertionMode = InsertionMode.IN_BODY;\n    }\n    _resetInsertionModeForSelect(selectIdx) {\n        if (selectIdx > 0) {\n            for (let i = selectIdx - 1; i > 0; i--) {\n                const tn = this.openElements.tagIDs[i];\n                if (tn === html_js_1.TAG_ID.TEMPLATE) {\n                    break;\n                }\n                else if (tn === html_js_1.TAG_ID.TABLE) {\n                    this.insertionMode = InsertionMode.IN_SELECT_IN_TABLE;\n                    return;\n                }\n            }\n        }\n        this.insertionMode = InsertionMode.IN_SELECT;\n    }\n    //Foster parenting\n    _isElementCausesFosterParenting(tn) {\n        return TABLE_STRUCTURE_TAGS.has(tn);\n    }\n    _shouldFosterParentOnInsertion() {\n        return this.fosterParentingEnabled && this._isElementCausesFosterParenting(this.openElements.currentTagId);\n    }\n    _findFosterParentingLocation() {\n        for (let i = this.openElements.stackTop; i >= 0; i--) {\n            const openElement = this.openElements.items[i];\n            switch (this.openElements.tagIDs[i]) {\n                case html_js_1.TAG_ID.TEMPLATE:\n                    if (this.treeAdapter.getNamespaceURI(openElement) === html_js_1.NS.HTML) {\n                        return { parent: this.treeAdapter.getTemplateContent(openElement), beforeElement: null };\n                    }\n                    break;\n                case html_js_1.TAG_ID.TABLE: {\n                    const parent = this.treeAdapter.getParentNode(openElement);\n                    if (parent) {\n                        return { parent, beforeElement: openElement };\n                    }\n                    return { parent: this.openElements.items[i - 1], beforeElement: null };\n                }\n                default:\n                // Do nothing\n            }\n        }\n        return { parent: this.openElements.items[0], beforeElement: null };\n    }\n    _fosterParentElement(element) {\n        const location = this._findFosterParentingLocation();\n        if (location.beforeElement) {\n            this.treeAdapter.insertBefore(location.parent, element, location.beforeElement);\n        }\n        else {\n            this.treeAdapter.appendChild(location.parent, element);\n        }\n    }\n    //Special elements\n    _isSpecialElement(element, id) {\n        const ns = this.treeAdapter.getNamespaceURI(element);\n        return html_js_1.SPECIAL_ELEMENTS[ns].has(id);\n    }\n    onCharacter(token) {\n        this.skipNextNewLine = false;\n        if (this.tokenizer.inForeignNode) {\n            characterInForeignContent(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                tokenBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                tokenBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                tokenInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                tokenInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                tokenAfterHead(this, token);\n                break;\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_TEMPLATE:\n                characterInBody(this, token);\n                break;\n            case InsertionMode.TEXT:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n                this._insertCharacters(token);\n                break;\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n                characterInTable(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                characterInTableText(this, token);\n                break;\n            case InsertionMode.IN_COLUMN_GROUP:\n                tokenInColumnGroup(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                tokenAfterBody(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n                tokenAfterAfterBody(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onNullCharacter(token) {\n        this.skipNextNewLine = false;\n        if (this.tokenizer.inForeignNode) {\n            nullCharacterInForeignContent(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                tokenBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                tokenBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                tokenInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                tokenInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                tokenAfterHead(this, token);\n                break;\n            case InsertionMode.TEXT:\n                this._insertCharacters(token);\n                break;\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n                characterInTable(this, token);\n                break;\n            case InsertionMode.IN_COLUMN_GROUP:\n                tokenInColumnGroup(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                tokenAfterBody(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n                tokenAfterAfterBody(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onComment(token) {\n        this.skipNextNewLine = false;\n        if (this.currentNotInHTML) {\n            appendComment(this, token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n            case InsertionMode.BEFORE_HTML:\n            case InsertionMode.BEFORE_HEAD:\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD:\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n            case InsertionMode.IN_TEMPLATE:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET:\n                appendComment(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                appendCommentToRootHtmlElement(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET:\n                appendCommentToDocument(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onDoctype(token) {\n        this.skipNextNewLine = false;\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                doctypeInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD:\n                this._err(token, error_codes_js_1.ERR.misplacedDoctype);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onStartTag(token) {\n        this.skipNextNewLine = false;\n        this.currentToken = token;\n        this._processStartTag(token);\n        if (token.selfClosing && !token.ackSelfClosing) {\n            this._err(token, error_codes_js_1.ERR.nonVoidHtmlElementStartTagWithTrailingSolidus);\n        }\n    }\n    /**\n     * Processes a given start tag.\n     *\n     * `onStartTag` checks if a self-closing tag was recognized. When a token\n     * is moved inbetween multiple insertion modes, this check for self-closing\n     * could lead to false positives. To avoid this, `_processStartTag` is used\n     * for nested calls.\n     *\n     * @param token The token to process.\n     */\n    _processStartTag(token) {\n        if (this.shouldProcessStartTagTokenInForeignContent(token)) {\n            startTagInForeignContent(this, token);\n        }\n        else {\n            this._startTagOutsideForeignContent(token);\n        }\n    }\n    _startTagOutsideForeignContent(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                startTagBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                startTagBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                startTagInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                startTagInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                startTagAfterHead(this, token);\n                break;\n            case InsertionMode.IN_BODY:\n                startTagInBody(this, token);\n                break;\n            case InsertionMode.IN_TABLE:\n                startTagInTable(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            case InsertionMode.IN_CAPTION:\n                startTagInCaption(this, token);\n                break;\n            case InsertionMode.IN_COLUMN_GROUP:\n                startTagInColumnGroup(this, token);\n                break;\n            case InsertionMode.IN_TABLE_BODY:\n                startTagInTableBody(this, token);\n                break;\n            case InsertionMode.IN_ROW:\n                startTagInRow(this, token);\n                break;\n            case InsertionMode.IN_CELL:\n                startTagInCell(this, token);\n                break;\n            case InsertionMode.IN_SELECT:\n                startTagInSelect(this, token);\n                break;\n            case InsertionMode.IN_SELECT_IN_TABLE:\n                startTagInSelectInTable(this, token);\n                break;\n            case InsertionMode.IN_TEMPLATE:\n                startTagInTemplate(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                startTagAfterBody(this, token);\n                break;\n            case InsertionMode.IN_FRAMESET:\n                startTagInFrameset(this, token);\n                break;\n            case InsertionMode.AFTER_FRAMESET:\n                startTagAfterFrameset(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n                startTagAfterAfterBody(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_FRAMESET:\n                startTagAfterAfterFrameset(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onEndTag(token) {\n        this.skipNextNewLine = false;\n        this.currentToken = token;\n        if (this.currentNotInHTML) {\n            endTagInForeignContent(this, token);\n        }\n        else {\n            this._endTagOutsideForeignContent(token);\n        }\n    }\n    _endTagOutsideForeignContent(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                endTagBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                endTagBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                endTagInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                endTagInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                endTagAfterHead(this, token);\n                break;\n            case InsertionMode.IN_BODY:\n                endTagInBody(this, token);\n                break;\n            case InsertionMode.TEXT:\n                endTagInText(this, token);\n                break;\n            case InsertionMode.IN_TABLE:\n                endTagInTable(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            case InsertionMode.IN_CAPTION:\n                endTagInCaption(this, token);\n                break;\n            case InsertionMode.IN_COLUMN_GROUP:\n                endTagInColumnGroup(this, token);\n                break;\n            case InsertionMode.IN_TABLE_BODY:\n                endTagInTableBody(this, token);\n                break;\n            case InsertionMode.IN_ROW:\n                endTagInRow(this, token);\n                break;\n            case InsertionMode.IN_CELL:\n                endTagInCell(this, token);\n                break;\n            case InsertionMode.IN_SELECT:\n                endTagInSelect(this, token);\n                break;\n            case InsertionMode.IN_SELECT_IN_TABLE:\n                endTagInSelectInTable(this, token);\n                break;\n            case InsertionMode.IN_TEMPLATE:\n                endTagInTemplate(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n                endTagAfterBody(this, token);\n                break;\n            case InsertionMode.IN_FRAMESET:\n                endTagInFrameset(this, token);\n                break;\n            case InsertionMode.AFTER_FRAMESET:\n                endTagAfterFrameset(this, token);\n                break;\n            case InsertionMode.AFTER_AFTER_BODY:\n                tokenAfterAfterBody(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onEof(token) {\n        switch (this.insertionMode) {\n            case InsertionMode.INITIAL:\n                tokenInInitialMode(this, token);\n                break;\n            case InsertionMode.BEFORE_HTML:\n                tokenBeforeHtml(this, token);\n                break;\n            case InsertionMode.BEFORE_HEAD:\n                tokenBeforeHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD:\n                tokenInHead(this, token);\n                break;\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n                tokenInHeadNoScript(this, token);\n                break;\n            case InsertionMode.AFTER_HEAD:\n                tokenAfterHead(this, token);\n                break;\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n                eofInBody(this, token);\n                break;\n            case InsertionMode.TEXT:\n                eofInText(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                tokenInTableText(this, token);\n                break;\n            case InsertionMode.IN_TEMPLATE:\n                eofInTemplate(this, token);\n                break;\n            case InsertionMode.AFTER_BODY:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET:\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET:\n                stopParsing(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n    onWhitespaceCharacter(token) {\n        if (this.skipNextNewLine) {\n            this.skipNextNewLine = false;\n            if (token.chars.charCodeAt(0) === unicode.CODE_POINTS.LINE_FEED) {\n                if (token.chars.length === 1) {\n                    return;\n                }\n                token.chars = token.chars.substr(1);\n            }\n        }\n        if (this.tokenizer.inForeignNode) {\n            this._insertCharacters(token);\n            return;\n        }\n        switch (this.insertionMode) {\n            case InsertionMode.IN_HEAD:\n            case InsertionMode.IN_HEAD_NO_SCRIPT:\n            case InsertionMode.AFTER_HEAD:\n            case InsertionMode.TEXT:\n            case InsertionMode.IN_COLUMN_GROUP:\n            case InsertionMode.IN_SELECT:\n            case InsertionMode.IN_SELECT_IN_TABLE:\n            case InsertionMode.IN_FRAMESET:\n            case InsertionMode.AFTER_FRAMESET:\n                this._insertCharacters(token);\n                break;\n            case InsertionMode.IN_BODY:\n            case InsertionMode.IN_CAPTION:\n            case InsertionMode.IN_CELL:\n            case InsertionMode.IN_TEMPLATE:\n            case InsertionMode.AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_BODY:\n            case InsertionMode.AFTER_AFTER_FRAMESET:\n                whitespaceCharacterInBody(this, token);\n                break;\n            case InsertionMode.IN_TABLE:\n            case InsertionMode.IN_TABLE_BODY:\n            case InsertionMode.IN_ROW:\n                characterInTable(this, token);\n                break;\n            case InsertionMode.IN_TABLE_TEXT:\n                whitespaceCharacterInTableText(this, token);\n                break;\n            default:\n            // Do nothing\n        }\n    }\n}\nexports.Parser = Parser;\n//Adoption agency algorithm\n//(see: http://www.whatwg.org/specs/web-apps/current-work/multipage/tree-construction.html#adoptionAgency)\n//------------------------------------------------------------------\n//Steps 5-8 of the algorithm\nfunction aaObtainFormattingElementEntry(p, token) {\n    let formattingElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(token.tagName);\n    if (formattingElementEntry) {\n        if (!p.openElements.contains(formattingElementEntry.element)) {\n            p.activeFormattingElements.removeEntry(formattingElementEntry);\n            formattingElementEntry = null;\n        }\n        else if (!p.openElements.hasInScope(token.tagID)) {\n            formattingElementEntry = null;\n        }\n    }\n    else {\n        genericEndTagInBody(p, token);\n    }\n    return formattingElementEntry;\n}\n//Steps 9 and 10 of the algorithm\nfunction aaObtainFurthestBlock(p, formattingElementEntry) {\n    let furthestBlock = null;\n    let idx = p.openElements.stackTop;\n    for (; idx >= 0; idx--) {\n        const element = p.openElements.items[idx];\n        if (element === formattingElementEntry.element) {\n            break;\n        }\n        if (p._isSpecialElement(element, p.openElements.tagIDs[idx])) {\n            furthestBlock = element;\n        }\n    }\n    if (!furthestBlock) {\n        p.openElements.shortenToLength(idx < 0 ? 0 : idx);\n        p.activeFormattingElements.removeEntry(formattingElementEntry);\n    }\n    return furthestBlock;\n}\n//Step 13 of the algorithm\nfunction aaInnerLoop(p, furthestBlock, formattingElement) {\n    let lastElement = furthestBlock;\n    let nextElement = p.openElements.getCommonAncestor(furthestBlock);\n    for (let i = 0, element = nextElement; element !== formattingElement; i++, element = nextElement) {\n        //NOTE: store the next element for the next loop iteration (it may be deleted from the stack by step 9.5)\n        nextElement = p.openElements.getCommonAncestor(element);\n        const elementEntry = p.activeFormattingElements.getElementEntry(element);\n        const counterOverflow = elementEntry && i >= AA_INNER_LOOP_ITER;\n        const shouldRemoveFromOpenElements = !elementEntry || counterOverflow;\n        if (shouldRemoveFromOpenElements) {\n            if (counterOverflow) {\n                p.activeFormattingElements.removeEntry(elementEntry);\n            }\n            p.openElements.remove(element);\n        }\n        else {\n            element = aaRecreateElementFromEntry(p, elementEntry);\n            if (lastElement === furthestBlock) {\n                p.activeFormattingElements.bookmark = elementEntry;\n            }\n            p.treeAdapter.detachNode(lastElement);\n            p.treeAdapter.appendChild(element, lastElement);\n            lastElement = element;\n        }\n    }\n    return lastElement;\n}\n//Step 13.7 of the algorithm\nfunction aaRecreateElementFromEntry(p, elementEntry) {\n    const ns = p.treeAdapter.getNamespaceURI(elementEntry.element);\n    const newElement = p.treeAdapter.createElement(elementEntry.token.tagName, ns, elementEntry.token.attrs);\n    p.openElements.replace(elementEntry.element, newElement);\n    elementEntry.element = newElement;\n    return newElement;\n}\n//Step 14 of the algorithm\nfunction aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement) {\n    const tn = p.treeAdapter.getTagName(commonAncestor);\n    const tid = (0, html_js_1.getTagID)(tn);\n    if (p._isElementCausesFosterParenting(tid)) {\n        p._fosterParentElement(lastElement);\n    }\n    else {\n        const ns = p.treeAdapter.getNamespaceURI(commonAncestor);\n        if (tid === html_js_1.TAG_ID.TEMPLATE && ns === html_js_1.NS.HTML) {\n            commonAncestor = p.treeAdapter.getTemplateContent(commonAncestor);\n        }\n        p.treeAdapter.appendChild(commonAncestor, lastElement);\n    }\n}\n//Steps 15-19 of the algorithm\nfunction aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry) {\n    const ns = p.treeAdapter.getNamespaceURI(formattingElementEntry.element);\n    const { token } = formattingElementEntry;\n    const newElement = p.treeAdapter.createElement(token.tagName, ns, token.attrs);\n    p._adoptNodes(furthestBlock, newElement);\n    p.treeAdapter.appendChild(furthestBlock, newElement);\n    p.activeFormattingElements.insertElementAfterBookmark(newElement, token);\n    p.activeFormattingElements.removeEntry(formattingElementEntry);\n    p.openElements.remove(formattingElementEntry.element);\n    p.openElements.insertAfter(furthestBlock, newElement, token.tagID);\n}\n//Algorithm entry point\nfunction callAdoptionAgency(p, token) {\n    for (let i = 0; i < AA_OUTER_LOOP_ITER; i++) {\n        const formattingElementEntry = aaObtainFormattingElementEntry(p, token);\n        if (!formattingElementEntry) {\n            break;\n        }\n        const furthestBlock = aaObtainFurthestBlock(p, formattingElementEntry);\n        if (!furthestBlock) {\n            break;\n        }\n        p.activeFormattingElements.bookmark = formattingElementEntry;\n        const lastElement = aaInnerLoop(p, furthestBlock, formattingElementEntry.element);\n        const commonAncestor = p.openElements.getCommonAncestor(formattingElementEntry.element);\n        p.treeAdapter.detachNode(lastElement);\n        if (commonAncestor)\n            aaInsertLastNodeInCommonAncestor(p, commonAncestor, lastElement);\n        aaReplaceFormattingElement(p, furthestBlock, formattingElementEntry);\n    }\n}\n//Generic token handlers\n//------------------------------------------------------------------\nfunction appendComment(p, token) {\n    p._appendCommentNode(token, p.openElements.currentTmplContentOrNode);\n}\nfunction appendCommentToRootHtmlElement(p, token) {\n    p._appendCommentNode(token, p.openElements.items[0]);\n}\nfunction appendCommentToDocument(p, token) {\n    p._appendCommentNode(token, p.document);\n}\nfunction stopParsing(p, token) {\n    p.stopped = true;\n    // NOTE: Set end locations for elements that remain on the open element stack.\n    if (token.location) {\n        // NOTE: If we are not in a fragment, `html` and `body` will stay on the stack.\n        // This is a problem, as we might overwrite their end position here.\n        const target = p.fragmentContext ? 0 : 2;\n        for (let i = p.openElements.stackTop; i >= target; i--) {\n            p._setEndLocation(p.openElements.items[i], token);\n        }\n        // Handle `html` and `body`\n        if (!p.fragmentContext && p.openElements.stackTop >= 0) {\n            const htmlElement = p.openElements.items[0];\n            const htmlLocation = p.treeAdapter.getNodeSourceCodeLocation(htmlElement);\n            if (htmlLocation && !htmlLocation.endTag) {\n                p._setEndLocation(htmlElement, token);\n                if (p.openElements.stackTop >= 1) {\n                    const bodyElement = p.openElements.items[1];\n                    const bodyLocation = p.treeAdapter.getNodeSourceCodeLocation(bodyElement);\n                    if (bodyLocation && !bodyLocation.endTag) {\n                        p._setEndLocation(bodyElement, token);\n                    }\n                }\n            }\n        }\n    }\n}\n// The \"initial\" insertion mode\n//------------------------------------------------------------------\nfunction doctypeInInitialMode(p, token) {\n    p._setDocumentType(token);\n    const mode = token.forceQuirks ? html_js_1.DOCUMENT_MODE.QUIRKS : doctype.getDocumentMode(token);\n    if (!doctype.isConforming(token)) {\n        p._err(token, error_codes_js_1.ERR.nonConformingDoctype);\n    }\n    p.treeAdapter.setDocumentMode(p.document, mode);\n    p.insertionMode = InsertionMode.BEFORE_HTML;\n}\nfunction tokenInInitialMode(p, token) {\n    p._err(token, error_codes_js_1.ERR.missingDoctype, true);\n    p.treeAdapter.setDocumentMode(p.document, html_js_1.DOCUMENT_MODE.QUIRKS);\n    p.insertionMode = InsertionMode.BEFORE_HTML;\n    p._processToken(token);\n}\n// The \"before html\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHtml(p, token) {\n    if (token.tagID === html_js_1.TAG_ID.HTML) {\n        p._insertElement(token, html_js_1.NS.HTML);\n        p.insertionMode = InsertionMode.BEFORE_HEAD;\n    }\n    else {\n        tokenBeforeHtml(p, token);\n    }\n}\nfunction endTagBeforeHtml(p, token) {\n    const tn = token.tagID;\n    if (tn === html_js_1.TAG_ID.HTML || tn === html_js_1.TAG_ID.HEAD || tn === html_js_1.TAG_ID.BODY || tn === html_js_1.TAG_ID.BR) {\n        tokenBeforeHtml(p, token);\n    }\n}\nfunction tokenBeforeHtml(p, token) {\n    p._insertFakeRootElement();\n    p.insertionMode = InsertionMode.BEFORE_HEAD;\n    p._processToken(token);\n}\n// The \"before head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagBeforeHead(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.HEAD: {\n            p._insertElement(token, html_js_1.NS.HTML);\n            p.headElement = p.openElements.current;\n            p.insertionMode = InsertionMode.IN_HEAD;\n            break;\n        }\n        default: {\n            tokenBeforeHead(p, token);\n        }\n    }\n}\nfunction endTagBeforeHead(p, token) {\n    const tn = token.tagID;\n    if (tn === html_js_1.TAG_ID.HEAD || tn === html_js_1.TAG_ID.BODY || tn === html_js_1.TAG_ID.HTML || tn === html_js_1.TAG_ID.BR) {\n        tokenBeforeHead(p, token);\n    }\n    else {\n        p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n    }\n}\nfunction tokenBeforeHead(p, token) {\n    p._insertFakeElement(html_js_1.TAG_NAMES.HEAD, html_js_1.TAG_ID.HEAD);\n    p.headElement = p.openElements.current;\n    p.insertionMode = InsertionMode.IN_HEAD;\n    p._processToken(token);\n}\n// The \"in head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHead(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.BASE:\n        case html_js_1.TAG_ID.BASEFONT:\n        case html_js_1.TAG_ID.BGSOUND:\n        case html_js_1.TAG_ID.LINK:\n        case html_js_1.TAG_ID.META: {\n            p._appendElement(token, html_js_1.NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case html_js_1.TAG_ID.TITLE: {\n            p._switchToTextParsing(token, index_js_1.TokenizerMode.RCDATA);\n            break;\n        }\n        case html_js_1.TAG_ID.NOSCRIPT: {\n            if (p.options.scriptingEnabled) {\n                p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n            }\n            else {\n                p._insertElement(token, html_js_1.NS.HTML);\n                p.insertionMode = InsertionMode.IN_HEAD_NO_SCRIPT;\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.NOFRAMES:\n        case html_js_1.TAG_ID.STYLE: {\n            p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n            break;\n        }\n        case html_js_1.TAG_ID.SCRIPT: {\n            p._switchToTextParsing(token, index_js_1.TokenizerMode.SCRIPT_DATA);\n            break;\n        }\n        case html_js_1.TAG_ID.TEMPLATE: {\n            p._insertTemplate(token);\n            p.activeFormattingElements.insertMarker();\n            p.framesetOk = false;\n            p.insertionMode = InsertionMode.IN_TEMPLATE;\n            p.tmplInsertionModeStack.unshift(InsertionMode.IN_TEMPLATE);\n            break;\n        }\n        case html_js_1.TAG_ID.HEAD: {\n            p._err(token, error_codes_js_1.ERR.misplacedStartTagForHeadElement);\n            break;\n        }\n        default: {\n            tokenInHead(p, token);\n        }\n    }\n}\nfunction endTagInHead(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HEAD: {\n            p.openElements.pop();\n            p.insertionMode = InsertionMode.AFTER_HEAD;\n            break;\n        }\n        case html_js_1.TAG_ID.BODY:\n        case html_js_1.TAG_ID.BR:\n        case html_js_1.TAG_ID.HTML: {\n            tokenInHead(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction templateEndTagInHead(p, token) {\n    if (p.openElements.tmplCount > 0) {\n        p.openElements.generateImpliedEndTagsThoroughly();\n        if (p.openElements.currentTagId !== html_js_1.TAG_ID.TEMPLATE) {\n            p._err(token, error_codes_js_1.ERR.closingOfElementWithOpenChildElements);\n        }\n        p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.TEMPLATE);\n        p.activeFormattingElements.clearToLastMarker();\n        p.tmplInsertionModeStack.shift();\n        p._resetInsertionMode();\n    }\n    else {\n        p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n    }\n}\nfunction tokenInHead(p, token) {\n    p.openElements.pop();\n    p.insertionMode = InsertionMode.AFTER_HEAD;\n    p._processToken(token);\n}\n// The \"in head no script\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInHeadNoScript(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.BASEFONT:\n        case html_js_1.TAG_ID.BGSOUND:\n        case html_js_1.TAG_ID.HEAD:\n        case html_js_1.TAG_ID.LINK:\n        case html_js_1.TAG_ID.META:\n        case html_js_1.TAG_ID.NOFRAMES:\n        case html_js_1.TAG_ID.STYLE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.NOSCRIPT: {\n            p._err(token, error_codes_js_1.ERR.nestedNoscriptInHead);\n            break;\n        }\n        default: {\n            tokenInHeadNoScript(p, token);\n        }\n    }\n}\nfunction endTagInHeadNoScript(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.NOSCRIPT: {\n            p.openElements.pop();\n            p.insertionMode = InsertionMode.IN_HEAD;\n            break;\n        }\n        case html_js_1.TAG_ID.BR: {\n            tokenInHeadNoScript(p, token);\n            break;\n        }\n        default: {\n            p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction tokenInHeadNoScript(p, token) {\n    const errCode = token.type === token_js_1.TokenType.EOF ? error_codes_js_1.ERR.openElementsLeftAfterEof : error_codes_js_1.ERR.disallowedContentInNoscriptInHead;\n    p._err(token, errCode);\n    p.openElements.pop();\n    p.insertionMode = InsertionMode.IN_HEAD;\n    p._processToken(token);\n}\n// The \"after head\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterHead(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.BODY: {\n            p._insertElement(token, html_js_1.NS.HTML);\n            p.framesetOk = false;\n            p.insertionMode = InsertionMode.IN_BODY;\n            break;\n        }\n        case html_js_1.TAG_ID.FRAMESET: {\n            p._insertElement(token, html_js_1.NS.HTML);\n            p.insertionMode = InsertionMode.IN_FRAMESET;\n            break;\n        }\n        case html_js_1.TAG_ID.BASE:\n        case html_js_1.TAG_ID.BASEFONT:\n        case html_js_1.TAG_ID.BGSOUND:\n        case html_js_1.TAG_ID.LINK:\n        case html_js_1.TAG_ID.META:\n        case html_js_1.TAG_ID.NOFRAMES:\n        case html_js_1.TAG_ID.SCRIPT:\n        case html_js_1.TAG_ID.STYLE:\n        case html_js_1.TAG_ID.TEMPLATE:\n        case html_js_1.TAG_ID.TITLE: {\n            p._err(token, error_codes_js_1.ERR.abandonedHeadElementChild);\n            p.openElements.push(p.headElement, html_js_1.TAG_ID.HEAD);\n            startTagInHead(p, token);\n            p.openElements.remove(p.headElement);\n            break;\n        }\n        case html_js_1.TAG_ID.HEAD: {\n            p._err(token, error_codes_js_1.ERR.misplacedStartTagForHeadElement);\n            break;\n        }\n        default: {\n            tokenAfterHead(p, token);\n        }\n    }\n}\nfunction endTagAfterHead(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.BODY:\n        case html_js_1.TAG_ID.HTML:\n        case html_js_1.TAG_ID.BR: {\n            tokenAfterHead(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            p._err(token, error_codes_js_1.ERR.endTagWithoutMatchingOpenElement);\n        }\n    }\n}\nfunction tokenAfterHead(p, token) {\n    p._insertFakeElement(html_js_1.TAG_NAMES.BODY, html_js_1.TAG_ID.BODY);\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"in body\" insertion mode\n//------------------------------------------------------------------\nfunction modeInBody(p, token) {\n    switch (token.type) {\n        case token_js_1.TokenType.CHARACTER: {\n            characterInBody(p, token);\n            break;\n        }\n        case token_js_1.TokenType.WHITESPACE_CHARACTER: {\n            whitespaceCharacterInBody(p, token);\n            break;\n        }\n        case token_js_1.TokenType.COMMENT: {\n            appendComment(p, token);\n            break;\n        }\n        case token_js_1.TokenType.START_TAG: {\n            startTagInBody(p, token);\n            break;\n        }\n        case token_js_1.TokenType.END_TAG: {\n            endTagInBody(p, token);\n            break;\n        }\n        case token_js_1.TokenType.EOF: {\n            eofInBody(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction whitespaceCharacterInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertCharacters(token);\n}\nfunction characterInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertCharacters(token);\n    p.framesetOk = false;\n}\nfunction htmlStartTagInBody(p, token) {\n    if (p.openElements.tmplCount === 0) {\n        p.treeAdapter.adoptAttributes(p.openElements.items[0], token.attrs);\n    }\n}\nfunction bodyStartTagInBody(p, token) {\n    const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n    if (bodyElement && p.openElements.tmplCount === 0) {\n        p.framesetOk = false;\n        p.treeAdapter.adoptAttributes(bodyElement, token.attrs);\n    }\n}\nfunction framesetStartTagInBody(p, token) {\n    const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n    if (p.framesetOk && bodyElement) {\n        p.treeAdapter.detachNode(bodyElement);\n        p.openElements.popAllUpToHtmlElement();\n        p._insertElement(token, html_js_1.NS.HTML);\n        p.insertionMode = InsertionMode.IN_FRAMESET;\n    }\n}\nfunction addressStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n}\nfunction numberedHeaderStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._closePElement();\n    }\n    if ((0, html_js_1.isNumberedHeader)(p.openElements.currentTagId)) {\n        p.openElements.pop();\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n}\nfunction preStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n    //on to the next one. (Newlines at the start of pre blocks are ignored as an authoring convenience.)\n    p.skipNextNewLine = true;\n    p.framesetOk = false;\n}\nfunction formStartTagInBody(p, token) {\n    const inTemplate = p.openElements.tmplCount > 0;\n    if (!p.formElement || inTemplate) {\n        if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n            p._closePElement();\n        }\n        p._insertElement(token, html_js_1.NS.HTML);\n        if (!inTemplate) {\n            p.formElement = p.openElements.current;\n        }\n    }\n}\nfunction listItemStartTagInBody(p, token) {\n    p.framesetOk = false;\n    const tn = token.tagID;\n    for (let i = p.openElements.stackTop; i >= 0; i--) {\n        const elementId = p.openElements.tagIDs[i];\n        if ((tn === html_js_1.TAG_ID.LI && elementId === html_js_1.TAG_ID.LI) ||\n            ((tn === html_js_1.TAG_ID.DD || tn === html_js_1.TAG_ID.DT) && (elementId === html_js_1.TAG_ID.DD || elementId === html_js_1.TAG_ID.DT))) {\n            p.openElements.generateImpliedEndTagsWithExclusion(elementId);\n            p.openElements.popUntilTagNamePopped(elementId);\n            break;\n        }\n        if (elementId !== html_js_1.TAG_ID.ADDRESS &&\n            elementId !== html_js_1.TAG_ID.DIV &&\n            elementId !== html_js_1.TAG_ID.P &&\n            p._isSpecialElement(p.openElements.items[i], elementId)) {\n            break;\n        }\n    }\n    if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n}\nfunction plaintextStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.tokenizer.state = index_js_1.TokenizerMode.PLAINTEXT;\n}\nfunction buttonStartTagInBody(p, token) {\n    if (p.openElements.hasInScope(html_js_1.TAG_ID.BUTTON)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.BUTTON);\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.framesetOk = false;\n}\nfunction aStartTagInBody(p, token) {\n    const activeElementEntry = p.activeFormattingElements.getElementEntryInScopeWithTagName(html_js_1.TAG_NAMES.A);\n    if (activeElementEntry) {\n        callAdoptionAgency(p, token);\n        p.openElements.remove(activeElementEntry.element);\n        p.activeFormattingElements.removeEntry(activeElementEntry);\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction bStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction nobrStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    if (p.openElements.hasInScope(html_js_1.TAG_ID.NOBR)) {\n        callAdoptionAgency(p, token);\n        p._reconstructActiveFormattingElements();\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.activeFormattingElements.pushElement(p.openElements.current, token);\n}\nfunction appletStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.activeFormattingElements.insertMarker();\n    p.framesetOk = false;\n}\nfunction tableStartTagInBody(p, token) {\n    if (p.treeAdapter.getDocumentMode(p.document) !== html_js_1.DOCUMENT_MODE.QUIRKS && p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._closePElement();\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.framesetOk = false;\n    p.insertionMode = InsertionMode.IN_TABLE;\n}\nfunction areaStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._appendElement(token, html_js_1.NS.HTML);\n    p.framesetOk = false;\n    token.ackSelfClosing = true;\n}\nfunction isHiddenInput(token) {\n    const inputType = (0, token_js_1.getTokenAttr)(token, html_js_1.ATTRS.TYPE);\n    return inputType != null && inputType.toLowerCase() === HIDDEN_INPUT_TYPE;\n}\nfunction inputStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._appendElement(token, html_js_1.NS.HTML);\n    if (!isHiddenInput(token)) {\n        p.framesetOk = false;\n    }\n    token.ackSelfClosing = true;\n}\nfunction paramStartTagInBody(p, token) {\n    p._appendElement(token, html_js_1.NS.HTML);\n    token.ackSelfClosing = true;\n}\nfunction hrStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._closePElement();\n    }\n    p._appendElement(token, html_js_1.NS.HTML);\n    p.framesetOk = false;\n    token.ackSelfClosing = true;\n}\nfunction imageStartTagInBody(p, token) {\n    token.tagName = html_js_1.TAG_NAMES.IMG;\n    token.tagID = html_js_1.TAG_ID.IMG;\n    areaStartTagInBody(p, token);\n}\nfunction textareaStartTagInBody(p, token) {\n    p._insertElement(token, html_js_1.NS.HTML);\n    //NOTE: If the next token is a U+000A LINE FEED (LF) character token, then ignore that token and move\n    //on to the next one. (Newlines at the start of textarea elements are ignored as an authoring convenience.)\n    p.skipNextNewLine = true;\n    p.tokenizer.state = index_js_1.TokenizerMode.RCDATA;\n    p.originalInsertionMode = p.insertionMode;\n    p.framesetOk = false;\n    p.insertionMode = InsertionMode.TEXT;\n}\nfunction xmpStartTagInBody(p, token) {\n    if (p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._closePElement();\n    }\n    p._reconstructActiveFormattingElements();\n    p.framesetOk = false;\n    p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n}\nfunction iframeStartTagInBody(p, token) {\n    p.framesetOk = false;\n    p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n}\n//NOTE: here we assume that we always act as an user agent with enabled plugins, so we parse\n//<noembed> as rawtext.\nfunction noembedStartTagInBody(p, token) {\n    p._switchToTextParsing(token, index_js_1.TokenizerMode.RAWTEXT);\n}\nfunction selectStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.framesetOk = false;\n    p.insertionMode =\n        p.insertionMode === InsertionMode.IN_TABLE ||\n            p.insertionMode === InsertionMode.IN_CAPTION ||\n            p.insertionMode === InsertionMode.IN_TABLE_BODY ||\n            p.insertionMode === InsertionMode.IN_ROW ||\n            p.insertionMode === InsertionMode.IN_CELL\n            ? InsertionMode.IN_SELECT_IN_TABLE\n            : InsertionMode.IN_SELECT;\n}\nfunction optgroupStartTagInBody(p, token) {\n    if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTION) {\n        p.openElements.pop();\n    }\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, html_js_1.NS.HTML);\n}\nfunction rbStartTagInBody(p, token) {\n    if (p.openElements.hasInScope(html_js_1.TAG_ID.RUBY)) {\n        p.openElements.generateImpliedEndTags();\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n}\nfunction rtStartTagInBody(p, token) {\n    if (p.openElements.hasInScope(html_js_1.TAG_ID.RUBY)) {\n        p.openElements.generateImpliedEndTagsWithExclusion(html_js_1.TAG_ID.RTC);\n    }\n    p._insertElement(token, html_js_1.NS.HTML);\n}\nfunction mathStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    foreignContent.adjustTokenMathMLAttrs(token);\n    foreignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) {\n        p._appendElement(token, html_js_1.NS.MATHML);\n    }\n    else {\n        p._insertElement(token, html_js_1.NS.MATHML);\n    }\n    token.ackSelfClosing = true;\n}\nfunction svgStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    foreignContent.adjustTokenSVGAttrs(token);\n    foreignContent.adjustTokenXMLAttrs(token);\n    if (token.selfClosing) {\n        p._appendElement(token, html_js_1.NS.SVG);\n    }\n    else {\n        p._insertElement(token, html_js_1.NS.SVG);\n    }\n    token.ackSelfClosing = true;\n}\nfunction genericStartTagInBody(p, token) {\n    p._reconstructActiveFormattingElements();\n    p._insertElement(token, html_js_1.NS.HTML);\n}\nfunction startTagInBody(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.I:\n        case html_js_1.TAG_ID.S:\n        case html_js_1.TAG_ID.B:\n        case html_js_1.TAG_ID.U:\n        case html_js_1.TAG_ID.EM:\n        case html_js_1.TAG_ID.TT:\n        case html_js_1.TAG_ID.BIG:\n        case html_js_1.TAG_ID.CODE:\n        case html_js_1.TAG_ID.FONT:\n        case html_js_1.TAG_ID.SMALL:\n        case html_js_1.TAG_ID.STRIKE:\n        case html_js_1.TAG_ID.STRONG: {\n            bStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.A: {\n            aStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.H1:\n        case html_js_1.TAG_ID.H2:\n        case html_js_1.TAG_ID.H3:\n        case html_js_1.TAG_ID.H4:\n        case html_js_1.TAG_ID.H5:\n        case html_js_1.TAG_ID.H6: {\n            numberedHeaderStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.P:\n        case html_js_1.TAG_ID.DL:\n        case html_js_1.TAG_ID.OL:\n        case html_js_1.TAG_ID.UL:\n        case html_js_1.TAG_ID.DIV:\n        case html_js_1.TAG_ID.DIR:\n        case html_js_1.TAG_ID.NAV:\n        case html_js_1.TAG_ID.MAIN:\n        case html_js_1.TAG_ID.MENU:\n        case html_js_1.TAG_ID.ASIDE:\n        case html_js_1.TAG_ID.CENTER:\n        case html_js_1.TAG_ID.FIGURE:\n        case html_js_1.TAG_ID.FOOTER:\n        case html_js_1.TAG_ID.HEADER:\n        case html_js_1.TAG_ID.HGROUP:\n        case html_js_1.TAG_ID.DIALOG:\n        case html_js_1.TAG_ID.DETAILS:\n        case html_js_1.TAG_ID.ADDRESS:\n        case html_js_1.TAG_ID.ARTICLE:\n        case html_js_1.TAG_ID.SECTION:\n        case html_js_1.TAG_ID.SUMMARY:\n        case html_js_1.TAG_ID.FIELDSET:\n        case html_js_1.TAG_ID.BLOCKQUOTE:\n        case html_js_1.TAG_ID.FIGCAPTION: {\n            addressStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.LI:\n        case html_js_1.TAG_ID.DD:\n        case html_js_1.TAG_ID.DT: {\n            listItemStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.BR:\n        case html_js_1.TAG_ID.IMG:\n        case html_js_1.TAG_ID.WBR:\n        case html_js_1.TAG_ID.AREA:\n        case html_js_1.TAG_ID.EMBED:\n        case html_js_1.TAG_ID.KEYGEN: {\n            areaStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.HR: {\n            hrStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.RB:\n        case html_js_1.TAG_ID.RTC: {\n            rbStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.RT:\n        case html_js_1.TAG_ID.RP: {\n            rtStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.PRE:\n        case html_js_1.TAG_ID.LISTING: {\n            preStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.XMP: {\n            xmpStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.SVG: {\n            svgStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.HTML: {\n            htmlStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.BASE:\n        case html_js_1.TAG_ID.LINK:\n        case html_js_1.TAG_ID.META:\n        case html_js_1.TAG_ID.STYLE:\n        case html_js_1.TAG_ID.TITLE:\n        case html_js_1.TAG_ID.SCRIPT:\n        case html_js_1.TAG_ID.BGSOUND:\n        case html_js_1.TAG_ID.BASEFONT:\n        case html_js_1.TAG_ID.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.BODY: {\n            bodyStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.FORM: {\n            formStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.NOBR: {\n            nobrStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.MATH: {\n            mathStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.TABLE: {\n            tableStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.INPUT: {\n            inputStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.PARAM:\n        case html_js_1.TAG_ID.TRACK:\n        case html_js_1.TAG_ID.SOURCE: {\n            paramStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.IMAGE: {\n            imageStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.BUTTON: {\n            buttonStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.APPLET:\n        case html_js_1.TAG_ID.OBJECT:\n        case html_js_1.TAG_ID.MARQUEE: {\n            appletStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.IFRAME: {\n            iframeStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.SELECT: {\n            selectStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.OPTION:\n        case html_js_1.TAG_ID.OPTGROUP: {\n            optgroupStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.NOEMBED: {\n            noembedStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.FRAMESET: {\n            framesetStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.TEXTAREA: {\n            textareaStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.NOSCRIPT: {\n            if (p.options.scriptingEnabled) {\n                noembedStartTagInBody(p, token);\n            }\n            else {\n                genericStartTagInBody(p, token);\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.PLAINTEXT: {\n            plaintextStartTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.COL:\n        case html_js_1.TAG_ID.TH:\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TR:\n        case html_js_1.TAG_ID.HEAD:\n        case html_js_1.TAG_ID.FRAME:\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.THEAD:\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.COLGROUP: {\n            // Ignore token\n            break;\n        }\n        default: {\n            genericStartTagInBody(p, token);\n        }\n    }\n}\nfunction bodyEndTagInBody(p, token) {\n    if (p.openElements.hasInScope(html_js_1.TAG_ID.BODY)) {\n        p.insertionMode = InsertionMode.AFTER_BODY;\n        //NOTE: <body> is never popped from the stack, so we need to updated\n        //the end location explicitly.\n        if (p.options.sourceCodeLocationInfo) {\n            const bodyElement = p.openElements.tryPeekProperlyNestedBodyElement();\n            if (bodyElement) {\n                p._setEndLocation(bodyElement, token);\n            }\n        }\n    }\n}\nfunction htmlEndTagInBody(p, token) {\n    if (p.openElements.hasInScope(html_js_1.TAG_ID.BODY)) {\n        p.insertionMode = InsertionMode.AFTER_BODY;\n        endTagAfterBody(p, token);\n    }\n}\nfunction addressEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(tn);\n    }\n}\nfunction formEndTagInBody(p) {\n    const inTemplate = p.openElements.tmplCount > 0;\n    const { formElement } = p;\n    if (!inTemplate) {\n        p.formElement = null;\n    }\n    if ((formElement || inTemplate) && p.openElements.hasInScope(html_js_1.TAG_ID.FORM)) {\n        p.openElements.generateImpliedEndTags();\n        if (inTemplate) {\n            p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.FORM);\n        }\n        else if (formElement) {\n            p.openElements.remove(formElement);\n        }\n    }\n}\nfunction pEndTagInBody(p) {\n    if (!p.openElements.hasInButtonScope(html_js_1.TAG_ID.P)) {\n        p._insertFakeElement(html_js_1.TAG_NAMES.P, html_js_1.TAG_ID.P);\n    }\n    p._closePElement();\n}\nfunction liEndTagInBody(p) {\n    if (p.openElements.hasInListItemScope(html_js_1.TAG_ID.LI)) {\n        p.openElements.generateImpliedEndTagsWithExclusion(html_js_1.TAG_ID.LI);\n        p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.LI);\n    }\n}\nfunction ddEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTagsWithExclusion(tn);\n        p.openElements.popUntilTagNamePopped(tn);\n    }\n}\nfunction numberedHeaderEndTagInBody(p) {\n    if (p.openElements.hasNumberedHeaderInScope()) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilNumberedHeaderPopped();\n    }\n}\nfunction appletEndTagInBody(p, token) {\n    const tn = token.tagID;\n    if (p.openElements.hasInScope(tn)) {\n        p.openElements.generateImpliedEndTags();\n        p.openElements.popUntilTagNamePopped(tn);\n        p.activeFormattingElements.clearToLastMarker();\n    }\n}\nfunction brEndTagInBody(p) {\n    p._reconstructActiveFormattingElements();\n    p._insertFakeElement(html_js_1.TAG_NAMES.BR, html_js_1.TAG_ID.BR);\n    p.openElements.pop();\n    p.framesetOk = false;\n}\nfunction genericEndTagInBody(p, token) {\n    const tn = token.tagName;\n    const tid = token.tagID;\n    for (let i = p.openElements.stackTop; i > 0; i--) {\n        const element = p.openElements.items[i];\n        const elementId = p.openElements.tagIDs[i];\n        // Compare the tag name here, as the tag might not be a known tag with an ID.\n        if (tid === elementId && (tid !== html_js_1.TAG_ID.UNKNOWN || p.treeAdapter.getTagName(element) === tn)) {\n            p.openElements.generateImpliedEndTagsWithExclusion(tid);\n            if (p.openElements.stackTop >= i)\n                p.openElements.shortenToLength(i);\n            break;\n        }\n        if (p._isSpecialElement(element, elementId)) {\n            break;\n        }\n    }\n}\nfunction endTagInBody(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.A:\n        case html_js_1.TAG_ID.B:\n        case html_js_1.TAG_ID.I:\n        case html_js_1.TAG_ID.S:\n        case html_js_1.TAG_ID.U:\n        case html_js_1.TAG_ID.EM:\n        case html_js_1.TAG_ID.TT:\n        case html_js_1.TAG_ID.BIG:\n        case html_js_1.TAG_ID.CODE:\n        case html_js_1.TAG_ID.FONT:\n        case html_js_1.TAG_ID.NOBR:\n        case html_js_1.TAG_ID.SMALL:\n        case html_js_1.TAG_ID.STRIKE:\n        case html_js_1.TAG_ID.STRONG: {\n            callAdoptionAgency(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.P: {\n            pEndTagInBody(p);\n            break;\n        }\n        case html_js_1.TAG_ID.DL:\n        case html_js_1.TAG_ID.UL:\n        case html_js_1.TAG_ID.OL:\n        case html_js_1.TAG_ID.DIR:\n        case html_js_1.TAG_ID.DIV:\n        case html_js_1.TAG_ID.NAV:\n        case html_js_1.TAG_ID.PRE:\n        case html_js_1.TAG_ID.MAIN:\n        case html_js_1.TAG_ID.MENU:\n        case html_js_1.TAG_ID.ASIDE:\n        case html_js_1.TAG_ID.BUTTON:\n        case html_js_1.TAG_ID.CENTER:\n        case html_js_1.TAG_ID.FIGURE:\n        case html_js_1.TAG_ID.FOOTER:\n        case html_js_1.TAG_ID.HEADER:\n        case html_js_1.TAG_ID.HGROUP:\n        case html_js_1.TAG_ID.DIALOG:\n        case html_js_1.TAG_ID.ADDRESS:\n        case html_js_1.TAG_ID.ARTICLE:\n        case html_js_1.TAG_ID.DETAILS:\n        case html_js_1.TAG_ID.SECTION:\n        case html_js_1.TAG_ID.SUMMARY:\n        case html_js_1.TAG_ID.LISTING:\n        case html_js_1.TAG_ID.FIELDSET:\n        case html_js_1.TAG_ID.BLOCKQUOTE:\n        case html_js_1.TAG_ID.FIGCAPTION: {\n            addressEndTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.LI: {\n            liEndTagInBody(p);\n            break;\n        }\n        case html_js_1.TAG_ID.DD:\n        case html_js_1.TAG_ID.DT: {\n            ddEndTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.H1:\n        case html_js_1.TAG_ID.H2:\n        case html_js_1.TAG_ID.H3:\n        case html_js_1.TAG_ID.H4:\n        case html_js_1.TAG_ID.H5:\n        case html_js_1.TAG_ID.H6: {\n            numberedHeaderEndTagInBody(p);\n            break;\n        }\n        case html_js_1.TAG_ID.BR: {\n            brEndTagInBody(p);\n            break;\n        }\n        case html_js_1.TAG_ID.BODY: {\n            bodyEndTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.HTML: {\n            htmlEndTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.FORM: {\n            formEndTagInBody(p);\n            break;\n        }\n        case html_js_1.TAG_ID.APPLET:\n        case html_js_1.TAG_ID.OBJECT:\n        case html_js_1.TAG_ID.MARQUEE: {\n            appletEndTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default: {\n            genericEndTagInBody(p, token);\n        }\n    }\n}\nfunction eofInBody(p, token) {\n    if (p.tmplInsertionModeStack.length > 0) {\n        eofInTemplate(p, token);\n    }\n    else {\n        stopParsing(p, token);\n    }\n}\n// The \"text\" insertion mode\n//------------------------------------------------------------------\nfunction endTagInText(p, token) {\n    var _a;\n    if (token.tagID === html_js_1.TAG_ID.SCRIPT) {\n        (_a = p.scriptHandler) === null || _a === void 0 ? void 0 : _a.call(p, p.openElements.current);\n    }\n    p.openElements.pop();\n    p.insertionMode = p.originalInsertionMode;\n}\nfunction eofInText(p, token) {\n    p._err(token, error_codes_js_1.ERR.eofInElementThatCanContainOnlyText);\n    p.openElements.pop();\n    p.insertionMode = p.originalInsertionMode;\n    p.onEof(token);\n}\n// The \"in table\" insertion mode\n//------------------------------------------------------------------\nfunction characterInTable(p, token) {\n    if (TABLE_STRUCTURE_TAGS.has(p.openElements.currentTagId)) {\n        p.pendingCharacterTokens.length = 0;\n        p.hasNonWhitespacePendingCharacterToken = false;\n        p.originalInsertionMode = p.insertionMode;\n        p.insertionMode = InsertionMode.IN_TABLE_TEXT;\n        switch (token.type) {\n            case token_js_1.TokenType.CHARACTER: {\n                characterInTableText(p, token);\n                break;\n            }\n            case token_js_1.TokenType.WHITESPACE_CHARACTER: {\n                whitespaceCharacterInTableText(p, token);\n                break;\n            }\n            // Ignore null\n        }\n    }\n    else {\n        tokenInTable(p, token);\n    }\n}\nfunction captionStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p.activeFormattingElements.insertMarker();\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.insertionMode = InsertionMode.IN_CAPTION;\n}\nfunction colgroupStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n}\nfunction colStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertFakeElement(html_js_1.TAG_NAMES.COLGROUP, html_js_1.TAG_ID.COLGROUP);\n    p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n    startTagInColumnGroup(p, token);\n}\nfunction tbodyStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertElement(token, html_js_1.NS.HTML);\n    p.insertionMode = InsertionMode.IN_TABLE_BODY;\n}\nfunction tdStartTagInTable(p, token) {\n    p.openElements.clearBackToTableContext();\n    p._insertFakeElement(html_js_1.TAG_NAMES.TBODY, html_js_1.TAG_ID.TBODY);\n    p.insertionMode = InsertionMode.IN_TABLE_BODY;\n    startTagInTableBody(p, token);\n}\nfunction tableStartTagInTable(p, token) {\n    if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TABLE)) {\n        p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.TABLE);\n        p._resetInsertionMode();\n        p._processStartTag(token);\n    }\n}\nfunction inputStartTagInTable(p, token) {\n    if (isHiddenInput(token)) {\n        p._appendElement(token, html_js_1.NS.HTML);\n    }\n    else {\n        tokenInTable(p, token);\n    }\n    token.ackSelfClosing = true;\n}\nfunction formStartTagInTable(p, token) {\n    if (!p.formElement && p.openElements.tmplCount === 0) {\n        p._insertElement(token, html_js_1.NS.HTML);\n        p.formElement = p.openElements.current;\n        p.openElements.pop();\n    }\n}\nfunction startTagInTable(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TH:\n        case html_js_1.TAG_ID.TR: {\n            tdStartTagInTable(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.STYLE:\n        case html_js_1.TAG_ID.SCRIPT:\n        case html_js_1.TAG_ID.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.COL: {\n            colStartTagInTable(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.FORM: {\n            formStartTagInTable(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.TABLE: {\n            tableStartTagInTable(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.THEAD: {\n            tbodyStartTagInTable(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.INPUT: {\n            inputStartTagInTable(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.CAPTION: {\n            captionStartTagInTable(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.COLGROUP: {\n            colgroupStartTagInTable(p, token);\n            break;\n        }\n        default: {\n            tokenInTable(p, token);\n        }\n    }\n}\nfunction endTagInTable(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.TABLE: {\n            if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TABLE)) {\n                p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.TABLE);\n                p._resetInsertionMode();\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.BODY:\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.COL:\n        case html_js_1.TAG_ID.COLGROUP:\n        case html_js_1.TAG_ID.HTML:\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.TH:\n        case html_js_1.TAG_ID.THEAD:\n        case html_js_1.TAG_ID.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            tokenInTable(p, token);\n        }\n    }\n}\nfunction tokenInTable(p, token) {\n    const savedFosterParentingState = p.fosterParentingEnabled;\n    p.fosterParentingEnabled = true;\n    // Process token in `In Body` mode\n    modeInBody(p, token);\n    p.fosterParentingEnabled = savedFosterParentingState;\n}\n// The \"in table text\" insertion mode\n//------------------------------------------------------------------\nfunction whitespaceCharacterInTableText(p, token) {\n    p.pendingCharacterTokens.push(token);\n}\nfunction characterInTableText(p, token) {\n    p.pendingCharacterTokens.push(token);\n    p.hasNonWhitespacePendingCharacterToken = true;\n}\nfunction tokenInTableText(p, token) {\n    let i = 0;\n    if (p.hasNonWhitespacePendingCharacterToken) {\n        for (; i < p.pendingCharacterTokens.length; i++) {\n            tokenInTable(p, p.pendingCharacterTokens[i]);\n        }\n    }\n    else {\n        for (; i < p.pendingCharacterTokens.length; i++) {\n            p._insertCharacters(p.pendingCharacterTokens[i]);\n        }\n    }\n    p.insertionMode = p.originalInsertionMode;\n    p._processToken(token);\n}\n// The \"in caption\" insertion mode\n//------------------------------------------------------------------\nconst TABLE_VOID_ELEMENTS = new Set([html_js_1.TAG_ID.CAPTION, html_js_1.TAG_ID.COL, html_js_1.TAG_ID.COLGROUP, html_js_1.TAG_ID.TBODY, html_js_1.TAG_ID.TD, html_js_1.TAG_ID.TFOOT, html_js_1.TAG_ID.TH, html_js_1.TAG_ID.THEAD, html_js_1.TAG_ID.TR]);\nfunction startTagInCaption(p, token) {\n    const tn = token.tagID;\n    if (TABLE_VOID_ELEMENTS.has(tn)) {\n        if (p.openElements.hasInTableScope(html_js_1.TAG_ID.CAPTION)) {\n            p.openElements.generateImpliedEndTags();\n            p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.CAPTION);\n            p.activeFormattingElements.clearToLastMarker();\n            p.insertionMode = InsertionMode.IN_TABLE;\n            startTagInTable(p, token);\n        }\n    }\n    else {\n        startTagInBody(p, token);\n    }\n}\nfunction endTagInCaption(p, token) {\n    const tn = token.tagID;\n    switch (tn) {\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.TABLE: {\n            if (p.openElements.hasInTableScope(html_js_1.TAG_ID.CAPTION)) {\n                p.openElements.generateImpliedEndTags();\n                p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.CAPTION);\n                p.activeFormattingElements.clearToLastMarker();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                if (tn === html_js_1.TAG_ID.TABLE) {\n                    endTagInTable(p, token);\n                }\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.BODY:\n        case html_js_1.TAG_ID.COL:\n        case html_js_1.TAG_ID.COLGROUP:\n        case html_js_1.TAG_ID.HTML:\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.TH:\n        case html_js_1.TAG_ID.THEAD:\n        case html_js_1.TAG_ID.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInBody(p, token);\n        }\n    }\n}\n// The \"in column group\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInColumnGroup(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.COL: {\n            p._appendElement(token, html_js_1.NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case html_js_1.TAG_ID.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        default: {\n            tokenInColumnGroup(p, token);\n        }\n    }\n}\nfunction endTagInColumnGroup(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.COLGROUP: {\n            if (p.openElements.currentTagId === html_js_1.TAG_ID.COLGROUP) {\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.COL: {\n            // Ignore token\n            break;\n        }\n        default: {\n            tokenInColumnGroup(p, token);\n        }\n    }\n}\nfunction tokenInColumnGroup(p, token) {\n    if (p.openElements.currentTagId === html_js_1.TAG_ID.COLGROUP) {\n        p.openElements.pop();\n        p.insertionMode = InsertionMode.IN_TABLE;\n        p._processToken(token);\n    }\n}\n// The \"in table body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTableBody(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.TR: {\n            p.openElements.clearBackToTableBodyContext();\n            p._insertElement(token, html_js_1.NS.HTML);\n            p.insertionMode = InsertionMode.IN_ROW;\n            break;\n        }\n        case html_js_1.TAG_ID.TH:\n        case html_js_1.TAG_ID.TD: {\n            p.openElements.clearBackToTableBodyContext();\n            p._insertFakeElement(html_js_1.TAG_NAMES.TR, html_js_1.TAG_ID.TR);\n            p.insertionMode = InsertionMode.IN_ROW;\n            startTagInRow(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.COL:\n        case html_js_1.TAG_ID.COLGROUP:\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.THEAD: {\n            if (p.openElements.hasTableBodyContextInTableScope()) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                startTagInTable(p, token);\n            }\n            break;\n        }\n        default: {\n            startTagInTable(p, token);\n        }\n    }\n}\nfunction endTagInTableBody(p, token) {\n    const tn = token.tagID;\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.THEAD: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.TABLE: {\n            if (p.openElements.hasTableBodyContextInTableScope()) {\n                p.openElements.clearBackToTableBodyContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE;\n                endTagInTable(p, token);\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.BODY:\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.COL:\n        case html_js_1.TAG_ID.COLGROUP:\n        case html_js_1.TAG_ID.HTML:\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TH:\n        case html_js_1.TAG_ID.TR: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInTable(p, token);\n        }\n    }\n}\n// The \"in row\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInRow(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.TH:\n        case html_js_1.TAG_ID.TD: {\n            p.openElements.clearBackToTableRowContext();\n            p._insertElement(token, html_js_1.NS.HTML);\n            p.insertionMode = InsertionMode.IN_CELL;\n            p.activeFormattingElements.insertMarker();\n            break;\n        }\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.COL:\n        case html_js_1.TAG_ID.COLGROUP:\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.THEAD:\n        case html_js_1.TAG_ID.TR: {\n            if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                startTagInTableBody(p, token);\n            }\n            break;\n        }\n        default: {\n            startTagInTable(p, token);\n        }\n    }\n}\nfunction endTagInRow(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.TR: {\n            if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.TABLE: {\n            if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                endTagInTableBody(p, token);\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.THEAD: {\n            if (p.openElements.hasInTableScope(token.tagID) || p.openElements.hasInTableScope(html_js_1.TAG_ID.TR)) {\n                p.openElements.clearBackToTableRowContext();\n                p.openElements.pop();\n                p.insertionMode = InsertionMode.IN_TABLE_BODY;\n                endTagInTableBody(p, token);\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.BODY:\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.COL:\n        case html_js_1.TAG_ID.COLGROUP:\n        case html_js_1.TAG_ID.HTML:\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TH: {\n            // Ignore end tag\n            break;\n        }\n        default:\n            endTagInTable(p, token);\n    }\n}\n// The \"in cell\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInCell(p, token) {\n    const tn = token.tagID;\n    if (TABLE_VOID_ELEMENTS.has(tn)) {\n        if (p.openElements.hasInTableScope(html_js_1.TAG_ID.TD) || p.openElements.hasInTableScope(html_js_1.TAG_ID.TH)) {\n            p._closeTableCell();\n            startTagInRow(p, token);\n        }\n    }\n    else {\n        startTagInBody(p, token);\n    }\n}\nfunction endTagInCell(p, token) {\n    const tn = token.tagID;\n    switch (tn) {\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TH: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p.openElements.generateImpliedEndTags();\n                p.openElements.popUntilTagNamePopped(tn);\n                p.activeFormattingElements.clearToLastMarker();\n                p.insertionMode = InsertionMode.IN_ROW;\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.TABLE:\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.THEAD:\n        case html_js_1.TAG_ID.TR: {\n            if (p.openElements.hasInTableScope(tn)) {\n                p._closeTableCell();\n                endTagInRow(p, token);\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.BODY:\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.COL:\n        case html_js_1.TAG_ID.COLGROUP:\n        case html_js_1.TAG_ID.HTML: {\n            // Ignore token\n            break;\n        }\n        default: {\n            endTagInBody(p, token);\n        }\n    }\n}\n// The \"in select\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelect(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.OPTION: {\n            if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTION) {\n                p.openElements.pop();\n            }\n            p._insertElement(token, html_js_1.NS.HTML);\n            break;\n        }\n        case html_js_1.TAG_ID.OPTGROUP: {\n            if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTION) {\n                p.openElements.pop();\n            }\n            if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTGROUP) {\n                p.openElements.pop();\n            }\n            p._insertElement(token, html_js_1.NS.HTML);\n            break;\n        }\n        case html_js_1.TAG_ID.INPUT:\n        case html_js_1.TAG_ID.KEYGEN:\n        case html_js_1.TAG_ID.TEXTAREA:\n        case html_js_1.TAG_ID.SELECT: {\n            if (p.openElements.hasInSelectScope(html_js_1.TAG_ID.SELECT)) {\n                p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.SELECT);\n                p._resetInsertionMode();\n                if (token.tagID !== html_js_1.TAG_ID.SELECT) {\n                    p._processStartTag(token);\n                }\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.SCRIPT:\n        case html_js_1.TAG_ID.TEMPLATE: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagInSelect(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.OPTGROUP: {\n            if (p.openElements.stackTop > 0 &&\n                p.openElements.currentTagId === html_js_1.TAG_ID.OPTION &&\n                p.openElements.tagIDs[p.openElements.stackTop - 1] === html_js_1.TAG_ID.OPTGROUP) {\n                p.openElements.pop();\n            }\n            if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTGROUP) {\n                p.openElements.pop();\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.OPTION: {\n            if (p.openElements.currentTagId === html_js_1.TAG_ID.OPTION) {\n                p.openElements.pop();\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.SELECT: {\n            if (p.openElements.hasInSelectScope(html_js_1.TAG_ID.SELECT)) {\n                p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.SELECT);\n                p._resetInsertionMode();\n            }\n            break;\n        }\n        case html_js_1.TAG_ID.TEMPLATE: {\n            templateEndTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\n// The \"in select in table\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInSelectInTable(p, token) {\n    const tn = token.tagID;\n    if (tn === html_js_1.TAG_ID.CAPTION ||\n        tn === html_js_1.TAG_ID.TABLE ||\n        tn === html_js_1.TAG_ID.TBODY ||\n        tn === html_js_1.TAG_ID.TFOOT ||\n        tn === html_js_1.TAG_ID.THEAD ||\n        tn === html_js_1.TAG_ID.TR ||\n        tn === html_js_1.TAG_ID.TD ||\n        tn === html_js_1.TAG_ID.TH) {\n        p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.SELECT);\n        p._resetInsertionMode();\n        p._processStartTag(token);\n    }\n    else {\n        startTagInSelect(p, token);\n    }\n}\nfunction endTagInSelectInTable(p, token) {\n    const tn = token.tagID;\n    if (tn === html_js_1.TAG_ID.CAPTION ||\n        tn === html_js_1.TAG_ID.TABLE ||\n        tn === html_js_1.TAG_ID.TBODY ||\n        tn === html_js_1.TAG_ID.TFOOT ||\n        tn === html_js_1.TAG_ID.THEAD ||\n        tn === html_js_1.TAG_ID.TR ||\n        tn === html_js_1.TAG_ID.TD ||\n        tn === html_js_1.TAG_ID.TH) {\n        if (p.openElements.hasInTableScope(tn)) {\n            p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.SELECT);\n            p._resetInsertionMode();\n            p.onEndTag(token);\n        }\n    }\n    else {\n        endTagInSelect(p, token);\n    }\n}\n// The \"in template\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInTemplate(p, token) {\n    switch (token.tagID) {\n        // First, handle tags that can start without a mode change\n        case html_js_1.TAG_ID.BASE:\n        case html_js_1.TAG_ID.BASEFONT:\n        case html_js_1.TAG_ID.BGSOUND:\n        case html_js_1.TAG_ID.LINK:\n        case html_js_1.TAG_ID.META:\n        case html_js_1.TAG_ID.NOFRAMES:\n        case html_js_1.TAG_ID.SCRIPT:\n        case html_js_1.TAG_ID.STYLE:\n        case html_js_1.TAG_ID.TEMPLATE:\n        case html_js_1.TAG_ID.TITLE:\n            startTagInHead(p, token);\n            break;\n        // Re-process the token in the appropriate mode\n        case html_js_1.TAG_ID.CAPTION:\n        case html_js_1.TAG_ID.COLGROUP:\n        case html_js_1.TAG_ID.TBODY:\n        case html_js_1.TAG_ID.TFOOT:\n        case html_js_1.TAG_ID.THEAD:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE;\n            p.insertionMode = InsertionMode.IN_TABLE;\n            startTagInTable(p, token);\n            break;\n        case html_js_1.TAG_ID.COL:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_COLUMN_GROUP;\n            p.insertionMode = InsertionMode.IN_COLUMN_GROUP;\n            startTagInColumnGroup(p, token);\n            break;\n        case html_js_1.TAG_ID.TR:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_TABLE_BODY;\n            p.insertionMode = InsertionMode.IN_TABLE_BODY;\n            startTagInTableBody(p, token);\n            break;\n        case html_js_1.TAG_ID.TD:\n        case html_js_1.TAG_ID.TH:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_ROW;\n            p.insertionMode = InsertionMode.IN_ROW;\n            startTagInRow(p, token);\n            break;\n        default:\n            p.tmplInsertionModeStack[0] = InsertionMode.IN_BODY;\n            p.insertionMode = InsertionMode.IN_BODY;\n            startTagInBody(p, token);\n    }\n}\nfunction endTagInTemplate(p, token) {\n    if (token.tagID === html_js_1.TAG_ID.TEMPLATE) {\n        templateEndTagInHead(p, token);\n    }\n}\nfunction eofInTemplate(p, token) {\n    if (p.openElements.tmplCount > 0) {\n        p.openElements.popUntilTagNamePopped(html_js_1.TAG_ID.TEMPLATE);\n        p.activeFormattingElements.clearToLastMarker();\n        p.tmplInsertionModeStack.shift();\n        p._resetInsertionMode();\n        p.onEof(token);\n    }\n    else {\n        stopParsing(p, token);\n    }\n}\n// The \"after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterBody(p, token) {\n    if (token.tagID === html_js_1.TAG_ID.HTML) {\n        startTagInBody(p, token);\n    }\n    else {\n        tokenAfterBody(p, token);\n    }\n}\nfunction endTagAfterBody(p, token) {\n    var _a;\n    if (token.tagID === html_js_1.TAG_ID.HTML) {\n        if (!p.fragmentContext) {\n            p.insertionMode = InsertionMode.AFTER_AFTER_BODY;\n        }\n        //NOTE: <html> is never popped from the stack, so we need to updated\n        //the end location explicitly.\n        if (p.options.sourceCodeLocationInfo && p.openElements.tagIDs[0] === html_js_1.TAG_ID.HTML) {\n            p._setEndLocation(p.openElements.items[0], token);\n            // Update the body element, if it doesn't have an end tag\n            const bodyElement = p.openElements.items[1];\n            if (bodyElement && !((_a = p.treeAdapter.getNodeSourceCodeLocation(bodyElement)) === null || _a === void 0 ? void 0 : _a.endTag)) {\n                p._setEndLocation(bodyElement, token);\n            }\n        }\n    }\n    else {\n        tokenAfterBody(p, token);\n    }\n}\nfunction tokenAfterBody(p, token) {\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"in frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagInFrameset(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.FRAMESET: {\n            p._insertElement(token, html_js_1.NS.HTML);\n            break;\n        }\n        case html_js_1.TAG_ID.FRAME: {\n            p._appendElement(token, html_js_1.NS.HTML);\n            token.ackSelfClosing = true;\n            break;\n        }\n        case html_js_1.TAG_ID.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagInFrameset(p, token) {\n    if (token.tagID === html_js_1.TAG_ID.FRAMESET && !p.openElements.isRootHtmlElementCurrent()) {\n        p.openElements.pop();\n        if (!p.fragmentContext && p.openElements.currentTagId !== html_js_1.TAG_ID.FRAMESET) {\n            p.insertionMode = InsertionMode.AFTER_FRAMESET;\n        }\n    }\n}\n// The \"after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterFrameset(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\nfunction endTagAfterFrameset(p, token) {\n    if (token.tagID === html_js_1.TAG_ID.HTML) {\n        p.insertionMode = InsertionMode.AFTER_AFTER_FRAMESET;\n    }\n}\n// The \"after after body\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterBody(p, token) {\n    if (token.tagID === html_js_1.TAG_ID.HTML) {\n        startTagInBody(p, token);\n    }\n    else {\n        tokenAfterAfterBody(p, token);\n    }\n}\nfunction tokenAfterAfterBody(p, token) {\n    p.insertionMode = InsertionMode.IN_BODY;\n    modeInBody(p, token);\n}\n// The \"after after frameset\" insertion mode\n//------------------------------------------------------------------\nfunction startTagAfterAfterFrameset(p, token) {\n    switch (token.tagID) {\n        case html_js_1.TAG_ID.HTML: {\n            startTagInBody(p, token);\n            break;\n        }\n        case html_js_1.TAG_ID.NOFRAMES: {\n            startTagInHead(p, token);\n            break;\n        }\n        default:\n        // Do nothing\n    }\n}\n// The rules for parsing tokens in foreign content\n//------------------------------------------------------------------\nfunction nullCharacterInForeignContent(p, token) {\n    token.chars = unicode.REPLACEMENT_CHARACTER;\n    p._insertCharacters(token);\n}\nfunction characterInForeignContent(p, token) {\n    p._insertCharacters(token);\n    p.framesetOk = false;\n}\nfunction popUntilHtmlOrIntegrationPoint(p) {\n    while (p.treeAdapter.getNamespaceURI(p.openElements.current) !== html_js_1.NS.HTML &&\n        !p._isIntegrationPoint(p.openElements.currentTagId, p.openElements.current)) {\n        p.openElements.pop();\n    }\n}\nfunction startTagInForeignContent(p, token) {\n    if (foreignContent.causesExit(token)) {\n        popUntilHtmlOrIntegrationPoint(p);\n        p._startTagOutsideForeignContent(token);\n    }\n    else {\n        const current = p._getAdjustedCurrentElement();\n        const currentNs = p.treeAdapter.getNamespaceURI(current);\n        if (currentNs === html_js_1.NS.MATHML) {\n            foreignContent.adjustTokenMathMLAttrs(token);\n        }\n        else if (currentNs === html_js_1.NS.SVG) {\n            foreignContent.adjustTokenSVGTagName(token);\n            foreignContent.adjustTokenSVGAttrs(token);\n        }\n        foreignContent.adjustTokenXMLAttrs(token);\n        if (token.selfClosing) {\n            p._appendElement(token, currentNs);\n        }\n        else {\n            p._insertElement(token, currentNs);\n        }\n        token.ackSelfClosing = true;\n    }\n}\nfunction endTagInForeignContent(p, token) {\n    if (token.tagID === html_js_1.TAG_ID.P || token.tagID === html_js_1.TAG_ID.BR) {\n        popUntilHtmlOrIntegrationPoint(p);\n        p._endTagOutsideForeignContent(token);\n        return;\n    }\n    for (let i = p.openElements.stackTop; i > 0; i--) {\n        const element = p.openElements.items[i];\n        if (p.treeAdapter.getNamespaceURI(element) === html_js_1.NS.HTML) {\n            p._endTagOutsideForeignContent(token);\n            break;\n        }\n        const tagName = p.treeAdapter.getTagName(element);\n        if (tagName.toLowerCase() === token.tagName) {\n            //NOTE: update the token tag name for `_setEndLocation`.\n            token.tagName = tagName;\n            p.openElements.shortenToLength(i);\n            break;\n        }\n    }\n}\n//# sourceMappingURL=index.js.map"],"mappings":"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"},"metadata":{},"sourceType":"script"}
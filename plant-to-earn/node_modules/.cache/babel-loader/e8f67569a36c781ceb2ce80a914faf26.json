{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getFeed = void 0;\n\nvar stringify_js_1 = require(\"./stringify.js\");\n\nvar legacy_js_1 = require(\"./legacy.js\");\n/**\n * Get the feed object from the root of a DOM tree.\n *\n * @category Feeds\n * @param doc - The DOM to to extract the feed from.\n * @returns The feed.\n */\n\n\nfunction getFeed(doc) {\n  var feedRoot = getOneElement(isValidFeed, doc);\n  return !feedRoot ? null : feedRoot.name === \"feed\" ? getAtomFeed(feedRoot) : getRssFeed(feedRoot);\n}\n\nexports.getFeed = getFeed;\n/**\n * Parse an Atom feed.\n *\n * @param feedRoot The root of the feed.\n * @returns The parsed feed.\n */\n\nfunction getAtomFeed(feedRoot) {\n  var _a;\n\n  var childs = feedRoot.children;\n  var feed = {\n    type: \"atom\",\n    items: (0, legacy_js_1.getElementsByTagName)(\"entry\", childs).map(function (item) {\n      var _a;\n\n      var children = item.children;\n      var entry = {\n        media: getMediaElements(children)\n      };\n      addConditionally(entry, \"id\", \"id\", children);\n      addConditionally(entry, \"title\", \"title\", children);\n      var href = (_a = getOneElement(\"link\", children)) === null || _a === void 0 ? void 0 : _a.attribs[\"href\"];\n\n      if (href) {\n        entry.link = href;\n      }\n\n      var description = fetch(\"summary\", children) || fetch(\"content\", children);\n\n      if (description) {\n        entry.description = description;\n      }\n\n      var pubDate = fetch(\"updated\", children);\n\n      if (pubDate) {\n        entry.pubDate = new Date(pubDate);\n      }\n\n      return entry;\n    })\n  };\n  addConditionally(feed, \"id\", \"id\", childs);\n  addConditionally(feed, \"title\", \"title\", childs);\n  var href = (_a = getOneElement(\"link\", childs)) === null || _a === void 0 ? void 0 : _a.attribs[\"href\"];\n\n  if (href) {\n    feed.link = href;\n  }\n\n  addConditionally(feed, \"description\", \"subtitle\", childs);\n  var updated = fetch(\"updated\", childs);\n\n  if (updated) {\n    feed.updated = new Date(updated);\n  }\n\n  addConditionally(feed, \"author\", \"email\", childs, true);\n  return feed;\n}\n/**\n * Parse a RSS feed.\n *\n * @param feedRoot The root of the feed.\n * @returns The parsed feed.\n */\n\n\nfunction getRssFeed(feedRoot) {\n  var _a, _b;\n\n  var childs = (_b = (_a = getOneElement(\"channel\", feedRoot.children)) === null || _a === void 0 ? void 0 : _a.children) !== null && _b !== void 0 ? _b : [];\n  var feed = {\n    type: feedRoot.name.substr(0, 3),\n    id: \"\",\n    items: (0, legacy_js_1.getElementsByTagName)(\"item\", feedRoot.children).map(function (item) {\n      var children = item.children;\n      var entry = {\n        media: getMediaElements(children)\n      };\n      addConditionally(entry, \"id\", \"guid\", children);\n      addConditionally(entry, \"title\", \"title\", children);\n      addConditionally(entry, \"link\", \"link\", children);\n      addConditionally(entry, \"description\", \"description\", children);\n      var pubDate = fetch(\"pubDate\", children);\n      if (pubDate) entry.pubDate = new Date(pubDate);\n      return entry;\n    })\n  };\n  addConditionally(feed, \"title\", \"title\", childs);\n  addConditionally(feed, \"link\", \"link\", childs);\n  addConditionally(feed, \"description\", \"description\", childs);\n  var updated = fetch(\"lastBuildDate\", childs);\n\n  if (updated) {\n    feed.updated = new Date(updated);\n  }\n\n  addConditionally(feed, \"author\", \"managingEditor\", childs, true);\n  return feed;\n}\n\nvar MEDIA_KEYS_STRING = [\"url\", \"type\", \"lang\"];\nvar MEDIA_KEYS_INT = [\"fileSize\", \"bitrate\", \"framerate\", \"samplingrate\", \"channels\", \"duration\", \"height\", \"width\"];\n/**\n * Get all media elements of a feed item.\n *\n * @param where Nodes to search in.\n * @returns Media elements.\n */\n\nfunction getMediaElements(where) {\n  return (0, legacy_js_1.getElementsByTagName)(\"media:content\", where).map(function (elem) {\n    var attribs = elem.attribs;\n    var media = {\n      medium: attribs[\"medium\"],\n      isDefault: !!attribs[\"isDefault\"]\n    };\n\n    for (var _i = 0, MEDIA_KEYS_STRING_1 = MEDIA_KEYS_STRING; _i < MEDIA_KEYS_STRING_1.length; _i++) {\n      var attrib = MEDIA_KEYS_STRING_1[_i];\n\n      if (attribs[attrib]) {\n        media[attrib] = attribs[attrib];\n      }\n    }\n\n    for (var _a = 0, MEDIA_KEYS_INT_1 = MEDIA_KEYS_INT; _a < MEDIA_KEYS_INT_1.length; _a++) {\n      var attrib = MEDIA_KEYS_INT_1[_a];\n\n      if (attribs[attrib]) {\n        media[attrib] = parseInt(attribs[attrib], 10);\n      }\n    }\n\n    if (attribs[\"expression\"]) {\n      media.expression = attribs[\"expression\"];\n    }\n\n    return media;\n  });\n}\n/**\n * Get one element by tag name.\n *\n * @param tagName Tag name to look for\n * @param node Node to search in\n * @returns The element or null\n */\n\n\nfunction getOneElement(tagName, node) {\n  return (0, legacy_js_1.getElementsByTagName)(tagName, node, true, 1)[0];\n}\n/**\n * Get the text content of an element with a certain tag name.\n *\n * @param tagName Tag name to look for.\n * @param where Node to search in.\n * @param recurse Whether to recurse into child nodes.\n * @returns The text content of the element.\n */\n\n\nfunction fetch(tagName, where, recurse) {\n  if (recurse === void 0) {\n    recurse = false;\n  }\n\n  return (0, stringify_js_1.textContent)((0, legacy_js_1.getElementsByTagName)(tagName, where, recurse, 1)).trim();\n}\n/**\n * Adds a property to an object if it has a value.\n *\n * @param obj Object to be extended\n * @param prop Property name\n * @param tagName Tag name that contains the conditionally added property\n * @param where Element to search for the property\n * @param recurse Whether to recurse into child nodes.\n */\n\n\nfunction addConditionally(obj, prop, tagName, where, recurse) {\n  if (recurse === void 0) {\n    recurse = false;\n  }\n\n  var val = fetch(tagName, where, recurse);\n  if (val) obj[prop] = val;\n}\n/**\n * Checks if an element is a feed root node.\n *\n * @param value The name of the element to check.\n * @returns Whether an element is a feed root node.\n */\n\n\nfunction isValidFeed(value) {\n  return value === \"rss\" || value === \"feed\" || value === \"rdf:RDF\";\n}","map":{"version":3,"mappings":"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","names":["getFeed","doc","feedRoot","getOneElement","isValidFeed","name","getAtomFeed","getRssFeed","exports","childs","children","feed","type","items","map","item","entry","media","getMediaElements","addConditionally","href","_a","attribs","link","description","fetch","pubDate","Date","updated","_b","substr","id","MEDIA_KEYS_STRING","MEDIA_KEYS_INT","where","elem","medium","isDefault","_i","attrib","parseInt","expression","tagName","node","recurse","trim","obj","prop","val","value"],"sources":["feeds.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}